<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 9.0.1" />
    <title>ModelController API documentation</title>
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2264%22%20height%3D%2264%22%20viewBox%3D%2244.5%202.5%2015%2015%22%3E%3Cpath%20d%3D%22M49.351%2021.041c-.233-.721-.546-2.408-.772-4.076-.042-.09-.067-.187-.046-.288-.166-1.347-.277-2.625-.241-3.351-1.378-1.008-2.271-2.586-2.271-4.362%200-.976.272-1.935.788-2.774.057-.094.122-.18.184-.268-.033-.167-.052-.339-.052-.516%200-1.477%201.202-2.679%202.679-2.679.791%200%201.496.352%201.987.9a6.3%206.3%200%200%201%201.001.029c.492-.564%201.207-.929%202.012-.929%201.477%200%202.679%201.202%202.679%202.679a2.65%202.65%200%200%201-.269%201.148c.383.747.595%201.572.595%202.41%200%202.311-1.507%204.29-3.635%205.107.037.699.147%202.27.423%203.294l.137.461c.156%202.136-4.612%205.166-5.199%203.215zm.127-4.919a4.78%204.78%200%200%200%20.775-.584c-.172-.115-.505-.254-.88-.378zm.331%202.302l.828-.502c-.202-.143-.576-.328-.984-.49zm.45%202.157l.701-.403c-.214-.115-.536-.249-.891-.376l.19.779zM49.13%204.141c0%20.152.123.276.276.276s.275-.124.275-.276-.123-.276-.276-.276-.275.124-.275.276zm.735-.389a1.15%201.15%200%200%201%20.314.783%201.16%201.16%200%200%201-1.162%201.162c-.457%200-.842-.27-1.032-.653-.026.117-.042.238-.042.362a1.68%201.68%200%200%200%201.679%201.679%201.68%201.68%200%200%200%201.679-1.679c0-.843-.626-1.535-1.436-1.654zm3.076%201.654a1.68%201.68%200%200%200%201.679%201.679%201.68%201.68%200%200%200%201.679-1.679c0-.037-.009-.072-.011-.109-.21.3-.541.508-.935.508a1.16%201.16%200%200%201-1.162-1.162%201.14%201.14%200%200%201%20.474-.912c-.015%200-.03-.005-.045-.005-.926.001-1.679.754-1.679%201.68zm1.861-1.265c0%20.152.123.276.276.276s.275-.124.275-.276-.123-.276-.276-.276-.275.124-.275.276zm1.823%204.823c0-.52-.103-1.035-.288-1.52-.466.394-1.06.64-1.717.64-1.144%200-2.116-.725-2.499-1.738-.383%201.012-1.355%201.738-2.499%201.738-.867%200-1.631-.421-2.121-1.062-.307.605-.478%201.267-.478%201.942%200%202.486%202.153%204.51%204.801%204.51s4.801-2.023%204.801-4.51zm-3.032%209.156l-.146-.492c-.276-1.02-.395-2.457-.444-3.268a6.11%206.11%200%200%201-1.18.115%206.01%206.01%200%200%201-2.536-.562l.006.175c.802.215%201.848.612%202.021%201.25.079.295-.021.601-.274.837l-.598.501c.667.304%201.243.698%201.311%201.179.02.144.022.507-.393.787l-.564.365c1.285.521%201.361.96%201.381%201.126.018.142.011.496-.427.746l-.854.489c.064-1.19%201.985-2.585%202.697-3.248zM49.34%209.925c0-.667%201-.667%201%200%200%20.653.818%201.205%201.787%201.205s1.787-.552%201.787-1.205c0-.667%201-.667%201%200%200%201.216-1.25%202.205-2.787%202.205s-2.787-.989-2.787-2.205zm-.887-7.633c-.093.077-.205.114-.317.114a.5.5%200%200%201-.318-.886L49.183.397a.5.5%200%200%201%20.703.068.5.5%200%200%201-.069.703zm7.661-.065c-.086%200-.173-.022-.253-.068l-1.523-.893c-.575-.337-.069-1.2.506-.863l1.523.892a.5.5%200%200%201%20.179.685c-.094.158-.261.247-.432.247z%22%20fill%3D%22%233bb300%22/%3E%3C/svg%3E"/>


<style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
<style>/*! pygments syntax highlighting */pre{line-height:125%;}td.linenos pre{color:#000000; background-color:#f0f0f0; padding-left:5px; padding-right:5px;}span.linenos{color:#000000; background-color:#f0f0f0; padding-left:5px; padding-right:5px;}td.linenos pre.special{color:#000000; background-color:#ffffc0; padding-left:5px; padding-right:5px;}span.linenos.special{color:#000000; background-color:#ffffc0; padding-left:5px; padding-right:5px;}.pdoc .hll{background-color:#ffffcc}.pdoc{background:#f8f8f8;}.pdoc .c{color:#408080; font-style:italic}.pdoc .err{border:1px solid #FF0000}.pdoc .k{color:#008000; font-weight:bold}.pdoc .o{color:#666666}.pdoc .ch{color:#408080; font-style:italic}.pdoc .cm{color:#408080; font-style:italic}.pdoc .cp{color:#BC7A00}.pdoc .cpf{color:#408080; font-style:italic}.pdoc .c1{color:#408080; font-style:italic}.pdoc .cs{color:#408080; font-style:italic}.pdoc .gd{color:#A00000}.pdoc .ge{font-style:italic}.pdoc .gr{color:#FF0000}.pdoc .gh{color:#000080; font-weight:bold}.pdoc .gi{color:#00A000}.pdoc .go{color:#888888}.pdoc .gp{color:#000080; font-weight:bold}.pdoc .gs{font-weight:bold}.pdoc .gu{color:#800080; font-weight:bold}.pdoc .gt{color:#0044DD}.pdoc .kc{color:#008000; font-weight:bold}.pdoc .kd{color:#008000; font-weight:bold}.pdoc .kn{color:#008000; font-weight:bold}.pdoc .kp{color:#008000}.pdoc .kr{color:#008000; font-weight:bold}.pdoc .kt{color:#B00040}.pdoc .m{color:#666666}.pdoc .s{color:#BA2121}.pdoc .na{color:#7D9029}.pdoc .nb{color:#008000}.pdoc .nc{color:#0000FF; font-weight:bold}.pdoc .no{color:#880000}.pdoc .nd{color:#AA22FF}.pdoc .ni{color:#999999; font-weight:bold}.pdoc .ne{color:#D2413A; font-weight:bold}.pdoc .nf{color:#0000FF}.pdoc .nl{color:#A0A000}.pdoc .nn{color:#0000FF; font-weight:bold}.pdoc .nt{color:#008000; font-weight:bold}.pdoc .nv{color:#19177C}.pdoc .ow{color:#AA22FF; font-weight:bold}.pdoc .w{color:#bbbbbb}.pdoc .mb{color:#666666}.pdoc .mf{color:#666666}.pdoc .mh{color:#666666}.pdoc .mi{color:#666666}.pdoc .mo{color:#666666}.pdoc .sa{color:#BA2121}.pdoc .sb{color:#BA2121}.pdoc .sc{color:#BA2121}.pdoc .dl{color:#BA2121}.pdoc .sd{color:#BA2121; font-style:italic}.pdoc .s2{color:#BA2121}.pdoc .se{color:#BB6622; font-weight:bold}.pdoc .sh{color:#BA2121}.pdoc .si{color:#BB6688; font-weight:bold}.pdoc .sx{color:#008000}.pdoc .sr{color:#BB6688}.pdoc .s1{color:#BA2121}.pdoc .ss{color:#19177C}.pdoc .bp{color:#008000}.pdoc .fm{color:#0000FF}.pdoc .vc{color:#19177C}.pdoc .vg{color:#19177C}.pdoc .vi{color:#19177C}.pdoc .vm{color:#19177C}.pdoc .il{color:#666666}</style>
<style>/*! pdoc */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f7f7f7;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}body{background-color:var(--pdoc-background);}html, body{width:100%;height:100%;}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;}nav.pdoc{--pad:1.75rem;--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent }nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc li{display:block;margin:0;padding:.2rem 0 .2rem var(--indent);transition:all 100ms;}nav.pdoc > div > ul > li{padding-left:0;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}html, main{scroll-behavior:smooth;}.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{background-color:var(--code);border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--code);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.pdoc details{filter:opacity(1);}.pdoc details:not([open]){height:0;}.pdoc details > summary{position:absolute;top:-35px;right:0;font-size:.75rem;color:var(--muted);padding:0 .7em;user-select:none;}.pdoc details > summary:focus{outline:0;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc > section:first-of-type > .docstring{margin-bottom:2.5rem;}.pdoc .docstring pre{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc .headerlink{position:absolute;width:0;margin-left:-1.5rem;line-height:1.4rem;font-size:1.5rem;font-weight:normal;transition:all 100ms ease-in-out;opacity:0;user-select:none;}.pdoc .attr > .headerlink{margin-left:-2.5rem;}.pdoc *:hover > .headerlink,.pdoc *:target > .attr > .headerlink{opacity:1;}.pdoc .attr{display:block;color:var(--text);margin:.5rem 0 .5rem;padding:.4rem 5rem .4rem 1rem;background-color:var(--accent);}.pdoc .classattr{margin-left:2rem;}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{white-space:pre-wrap;}.pdoc .annotation{color:var(--annotation);}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
</head>
<body>        <nav class="pdoc">
            <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
            <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
            <div>





                    <h2>API Documentation</h2>
                        <ul class="memberlist">
            <li>
                    <a class="class" href="#MCConfiguration">MCConfiguration</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#MCConfiguration.__init__">MCConfiguration</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#EDMCore">EDMCore</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#EDMCore.__init__">EDMCore</a>
                        </li>
                        <li>
                                <a class="function" href="#EDMCore.get_sim_start_time">get_sim_start_time</a>
                        </li>
                        <li>
                                <a class="function" href="#EDMCore.get_line_mrid">get_line_mrid</a>
                        </li>
                        <li>
                                <a class="function" href="#EDMCore.sim_start_up_process">sim_start_up_process</a>
                        </li>
                        <li>
                                <a class="function" href="#EDMCore.load_config_from_file">load_config_from_file</a>
                        </li>
                        <li>
                                <a class="function" href="#EDMCore.connect_to_gridapps">connect_to_gridapps</a>
                        </li>
                        <li>
                                <a class="function" href="#EDMCore.initialize_sim_mrid">initialize_sim_mrid</a>
                        </li>
                        <li>
                                <a class="function" href="#EDMCore.initialize_line_mrid">initialize_line_mrid</a>
                        </li>
                        <li>
                                <a class="function" href="#EDMCore.initialize_sim_start_time">initialize_sim_start_time</a>
                        </li>
                        <li>
                                <a class="function" href="#EDMCore.connect_to_simulation">connect_to_simulation</a>
                        </li>
                        <li>
                                <a class="function" href="#EDMCore.create_objects">create_objects</a>
                        </li>
                        <li>
                                <a class="function" href="#EDMCore.initialize_all_der_s">initialize_all_der_s</a>
                        </li>
                        <li>
                                <a class="function" href="#EDMCore.start_simulation">start_simulation</a>
                        </li>
                        <li>
                                <a class="function" href="#EDMCore.establish_mrid_name_lookup_table">establish_mrid_name_lookup_table</a>
                        </li>
                        <li>
                                <a class="function" href="#EDMCore.get_mrid_name_lookup_table">get_mrid_name_lookup_table</a>
                        </li>
                        <li>
                                <a class="function" href="#EDMCore.get_cim_measurement_dict">get_cim_measurement_dict</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#EDMTimeKeeper">EDMTimeKeeper</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#EDMTimeKeeper.__init__">EDMTimeKeeper</a>
                        </li>
                        <li>
                                <a class="function" href="#EDMTimeKeeper.on_message">on_message</a>
                        </li>
                        <li>
                                <a class="function" href="#EDMTimeKeeper.increment_sim_current_time">increment_sim_current_time</a>
                        </li>
                        <li>
                                <a class="function" href="#EDMTimeKeeper.get_sim_current_time">get_sim_current_time</a>
                        </li>
                        <li>
                                <a class="function" href="#EDMTimeKeeper.perform_all_on_timestep_updates">perform_all_on_timestep_updates</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#EDMMeasurementProcessor">EDMMeasurementProcessor</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#EDMMeasurementProcessor.__init__">EDMMeasurementProcessor</a>
                        </li>
                        <li>
                                <a class="function" href="#EDMMeasurementProcessor.on_message">on_message</a>
                        </li>
                        <li>
                                <a class="function" href="#EDMMeasurementProcessor.get_current_measurements">get_current_measurements</a>
                        </li>
                        <li>
                                <a class="function" href="#EDMMeasurementProcessor.parse_message_into_current_measurements">parse_message_into_current_measurements</a>
                        </li>
                        <li>
                                <a class="function" href="#EDMMeasurementProcessor.append_names">append_names</a>
                        </li>
                        <li>
                                <a class="function" href="#EDMMeasurementProcessor.append_association_data">append_association_data</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#RWHDERS">RWHDERS</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#RWHDERS.__init__">RWHDERS</a>
                        </li>
                        <li>
                                <a class="function" href="#RWHDERS.initialize_der_s">initialize_der_s</a>
                        </li>
                        <li>
                                <a class="function" href="#RWHDERS.assign_der_s_to_der_em">assign_der_s_to_der_em</a>
                        </li>
                        <li>
                                <a class="function" href="#RWHDERS.parse_input_file_names_for_assignment">parse_input_file_names_for_assignment</a>
                        </li>
                        <li>
                                <a class="function" href="#RWHDERS.update_der_em_input_request">update_der_em_input_request</a>
                        </li>
                        <li>
                                <a class="function" href="#RWHDERS.get_input_request">get_input_request</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#DERSHistoricalDataInput">DERSHistoricalDataInput</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#DERSHistoricalDataInput.__init__">DERSHistoricalDataInput</a>
                        </li>
                        <li>
                                <a class="function" href="#DERSHistoricalDataInput.initialize_der_s">initialize_der_s</a>
                        </li>
                        <li>
                                <a class="function" href="#DERSHistoricalDataInput.get_input_request">get_input_request</a>
                        </li>
                        <li>
                                <a class="function" href="#DERSHistoricalDataInput.assign_der_s_to_der_em">assign_der_s_to_der_em</a>
                        </li>
                        <li>
                                <a class="function" href="#DERSHistoricalDataInput.open_input_file">open_input_file</a>
                        </li>
                        <li>
                                <a class="function" href="#DERSHistoricalDataInput.read_input_file">read_input_file</a>
                        </li>
                        <li>
                                <a class="function" href="#DERSHistoricalDataInput.update_der_em_input_request">update_der_em_input_request</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#DERIdentificationManager">DERIdentificationManager</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#DERIdentificationManager.__init__">DERIdentificationManager</a>
                        </li>
                        <li>
                                <a class="function" href="#DERIdentificationManager.get_meas_name">get_meas_name</a>
                        </li>
                        <li>
                                <a class="function" href="#DERIdentificationManager.get_der_em_mrid">get_der_em_mrid</a>
                        </li>
                        <li>
                                <a class="function" href="#DERIdentificationManager.initialize_association_lookup_table">initialize_association_lookup_table</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#DERAssignmentHandler">DERAssignmentHandler</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#DERAssignmentHandler.__init__">DERAssignmentHandler</a>
                        </li>
                        <li>
                                <a class="function" href="#DERAssignmentHandler.get_assignment_lookup_table">get_assignment_lookup_table</a>
                        </li>
                        <li>
                                <a class="function" href="#DERAssignmentHandler.create_assignment_lookup_table">create_assignment_lookup_table</a>
                        </li>
                        <li>
                                <a class="function" href="#DERAssignmentHandler.assign_all_ders">assign_all_ders</a>
                        </li>
                        <li>
                                <a class="function" href="#DERAssignmentHandler.get_mRID_for_der_on_bus">get_mRID_for_der_on_bus</a>
                        </li>
                        <li>
                                <a class="function" href="#DERAssignmentHandler.append_new_values_to_association_table">append_new_values_to_association_table</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#MCInputInterface">MCInputInterface</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#MCInputInterface.__init__">MCInputInterface</a>
                        </li>
                        <li>
                                <a class="function" href="#MCInputInterface.update_all_der_em_status">update_all_der_em_status</a>
                        </li>
                        <li>
                                <a class="function" href="#MCInputInterface.update_all_der_s_status">update_all_der_s_status</a>
                        </li>
                        <li>
                                <a class="function" href="#MCInputInterface.get_all_der_s_input_requests">get_all_der_s_input_requests</a>
                        </li>
                        <li>
                                <a class="function" href="#MCInputInterface.update_der_ems">update_der_ems</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#GOTopologyProcessor">GOTopologyProcessor</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#GOTopologyProcessor.__init__">GOTopologyProcessor</a>
                        </li>
                        <li>
                                <a class="function" href="#GOTopologyProcessor.import_topology_from_file">import_topology_from_file</a>
                        </li>
                        <li>
                                <a class="function" href="#GOTopologyProcessor.reverse_topology_dict">reverse_topology_dict</a>
                        </li>
                        <li>
                                <a class="function" href="#GOTopologyProcessor.get_group_members">get_group_members</a>
                        </li>
                        <li>
                                <a class="function" href="#GOTopologyProcessor.get_groups_bus_is_in">get_groups_bus_is_in</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#GOSensor">GOSensor</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#GOSensor.__init__">GOSensor</a>
                        </li>
                        <li>
                                <a class="function" href="#GOSensor.update_sensor_states">update_sensor_states</a>
                        </li>
                        <li>
                                <a class="function" href="#GOSensor.make_service_request_decision">make_service_request_decision</a>
                        </li>
                        <li>
                                <a class="function" href="#GOSensor.load_manual_service_file">load_manual_service_file</a>
                        </li>
                        <li>
                                <a class="function" href="#GOSensor.manually_post_service">manually_post_service</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#GOOutputInterface">GOOutputInterface</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#GOOutputInterface.__init__">GOOutputInterface</a>
                        </li>
                        <li>
                                <a class="variable" href="#GOOutputInterface.current_service_requests">current_service_requests</a>
                        </li>
                        <li>
                                <a class="function" href="#GOOutputInterface.get_all_posted_service_requests">get_all_posted_service_requests</a>
                        </li>
                        <li>
                                <a class="function" href="#GOOutputInterface.generate_service_messages">generate_service_messages</a>
                        </li>
                        <li>
                                <a class="function" href="#GOOutputInterface.send_service_request_messages">send_service_request_messages</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#MCOutputLog">MCOutputLog</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#MCOutputLog.__init__">MCOutputLog</a>
                        </li>
                        <li>
                                <a class="function" href="#MCOutputLog.update_logs">update_logs</a>
                        </li>
                        <li>
                                <a class="function" href="#MCOutputLog.open_csv_file">open_csv_file</a>
                        </li>
                        <li>
                                <a class="function" href="#MCOutputLog.open_csv_dict_writer">open_csv_dict_writer</a>
                        </li>
                        <li>
                                <a class="function" href="#MCOutputLog.close_out_logs">close_out_logs</a>
                        </li>
                        <li>
                                <a class="function" href="#MCOutputLog.translate_header_names">translate_header_names</a>
                        </li>
                        <li>
                                <a class="function" href="#MCOutputLog.write_header">write_header</a>
                        </li>
                        <li>
                                <a class="function" href="#MCOutputLog.write_row">write_row</a>
                        </li>
                        <li>
                                <a class="function" href="#MCOutputLog.set_log_name">set_log_name</a>
                        </li>
                        <li>
                                <a class="function" href="#MCOutputLog.append_timestamps">append_timestamps</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#GOPostedService">GOPostedService</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#GOPostedService.__init__">GOPostedService</a>
                        </li>
                        <li>
                                <a class="function" href="#GOPostedService.get_service_name">get_service_name</a>
                        </li>
                        <li>
                                <a class="function" href="#GOPostedService.get_group_id">get_group_id</a>
                        </li>
                        <li>
                                <a class="function" href="#GOPostedService.get_service_type">get_service_type</a>
                        </li>
                        <li>
                                <a class="function" href="#GOPostedService.get_interval_start">get_interval_start</a>
                        </li>
                        <li>
                                <a class="function" href="#GOPostedService.get_interval_duration">get_interval_duration</a>
                        </li>
                        <li>
                                <a class="function" href="#GOPostedService.get_power">get_power</a>
                        </li>
                        <li>
                                <a class="function" href="#GOPostedService.get_price">get_price</a>
                        </li>
                        <li>
                                <a class="function" href="#GOPostedService.get_status">get_status</a>
                        </li>
                        <li>
                                <a class="function" href="#GOPostedService.set_status">set_status</a>
                        </li>
                        <li>
                                <a class="function" href="#GOPostedService.get_service_message_data">get_service_message_data</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="function" href="#instantiate_callback_classes">instantiate_callback_classes</a>
            </li>
    </ul>



                    <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev">
                        built with <span class="visually-hidden">pdoc</span><img
                            alt="pdoc logo"
                            src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>
                    </a>
            </div>
        </nav>
    <main class="pdoc">
            <section>
                    <h1 class="modulename">
ModelController    </h1>

                        <div class="docstring"><p>model controller</p>
</div>

                        <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">model controller</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">ast</span>
<span class="kn">import</span> <span class="nn">csv</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">gridappsd</span> <span class="kn">import</span> <span class="n">GridAPPSD</span><span class="p">,</span> <span class="n">DifferenceBuilder</span>
<span class="kn">from</span> <span class="nn">gridappsd</span> <span class="kn">import</span> <span class="n">topics</span> <span class="k">as</span> <span class="n">t</span>
<span class="kn">from</span> <span class="nn">gridappsd.simulation</span> <span class="kn">import</span> <span class="n">Simulation</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">xml.etree.ElementTree</span> <span class="k">as</span> <span class="nn">ET</span>
<span class="kn">import</span> <span class="nn">xmltodict</span>
<span class="kn">from</span> <span class="nn">dict2xml</span> <span class="kn">import</span> <span class="n">dict2xml</span>

<span class="n">end_program</span> <span class="o">=</span> <span class="kc">False</span>

<span class="c1"># ------------------------------------------------ Class Definitions ------------------------------------------------</span>


<span class="k">class</span> <span class="nc">MCConfiguration</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Provides user configurability of the MC when appropriate. Not to be confused with the GridAPPS-D configuration</span>
<span class="sd">    process, this provides global configuration for the MC as a whole. DER-S configuration should be handled within</span>
<span class="sd">    the DER-S Class definition, and not here.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        ATTRIBUTES:</span>

<span class="sd">            .mc_file_directory: The root folder where the ME is located.</span>

<span class="sd">            .config_file_path: The text file containing the GridAPPS-D configuration info.</span>

<span class="sd">            .ders_obj_list: A dictionary containing the DER-S classes and objects *that will be used in the current</span>
<span class="sd">                simulation*. Add or comment out as appropriate for new DER-Ss or for different tests.</span>

<span class="sd">            .go_sensor_decision_making_manual_override: Set to True to use manual GOSensor decision making (That is,</span>
<span class="sd">                grid services are called by a text file rather than based on grid conditions.</span>
<span class="sd">                NOTE: Automatic mode is not currently implemented, so this should ALWAYS be set to True.</span>

<span class="sd">            .manual_service_filename: the .xml filename of the GOSensor manual service input file. Should be in MC root.</span>

<span class="sd">            .output_log_name: The name and location of the output logs. Rename before simulation with date/time, for example.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mc_file_directory</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;C:/Users/stant/PycharmProjects/doe-egot-me/&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config_file_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mc_file_directory</span> <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot;Configuration/Config.txt&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ders_obj_list</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;DERSHistoricalDataInput&#39;</span><span class="p">:</span> <span class="s1">&#39;dersHistoricalDataInput&#39;</span><span class="p">,</span>
            <span class="s1">&#39;RWHDERS&#39;</span><span class="p">:</span> <span class="s1">&#39;rwhDERS&#39;</span>
            <span class="c1"># ,</span>
            <span class="c1"># &#39;EXAMPLEDERClassName&#39;: &#39;exampleDERObjectName&#39;</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">go_sensor_decision_making_manual_override</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">manual_service_filename</span> <span class="o">=</span> <span class="s2">&quot;manually_posted_service_input.xml&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output_log_name</span> <span class="o">=</span> <span class="s1">&#39;Logged Grid State Data/MeasOutputLogs.csv&#39;</span>


<span class="k">class</span> <span class="nc">EDMCore</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Provides central, core functionality to the MC. Responsible for the startup process and storing the GridAPPS-D</span>
<span class="sd">    connection and simulation mRIDs and objects.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gapps_session</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sim_session</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sim_start_time</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sim_current_time</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sim_mrid</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">line_mrid</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config_parameters</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mrid_name_lookup_table</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cim_measurement_dict</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">get_sim_start_time</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        ACCESSOR METHOD: returns the simulation start time (per the configuration file, not realtime)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim_start_time</span>

    <span class="k">def</span> <span class="nf">get_line_mrid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        ACCESSOR METHOD: Returns the mRID for the current model (I.E. the IEEE 13-node test feeder).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">line_mrid</span>

    <span class="k">def</span> <span class="nf">sim_start_up_process</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        ENCAPSULATION METHOD: calls all methods required to set up the simulation process. Does not start the simulation</span>
<span class="sd">        itself, but performs the &quot;startup checklist&quot;. This includes connecting to GridAPPS-D and the simulation, loading</span>
<span class="sd">        configuration from the file, instantiating all the (non-callback) objects, initializing DER-Ss, assigning</span>
<span class="sd">        DER-EMs and creating the association table, and connecting to the aggregator among others. See each method&#39;s</span>
<span class="sd">        docstring for more details.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect_to_gridapps</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_config_from_file</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initialize_line_mrid</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">establish_mrid_name_lookup_table</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect_to_simulation</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initialize_sim_start_time</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initialize_sim_mrid</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">create_objects</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initialize_all_der_s</span><span class="p">()</span>
        <span class="n">derAssignmentHandler</span><span class="o">.</span><span class="n">create_assignment_lookup_table</span><span class="p">()</span>
        <span class="n">derAssignmentHandler</span><span class="o">.</span><span class="n">assign_all_ders</span><span class="p">()</span>
        <span class="n">derIdentificationManager</span><span class="o">.</span><span class="n">initialize_association_lookup_table</span><span class="p">()</span>
        <span class="n">mcOutputLog</span><span class="o">.</span><span class="n">set_log_name</span><span class="p">()</span>
        <span class="n">goSensor</span><span class="o">.</span><span class="n">load_manual_service_file</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">load_config_from_file</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Loads the GridAPPS-D configuration string from a file and places the parameters in a variable for later use.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">mcConfiguration</span><span class="o">.</span><span class="n">config_file_path</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">config_string</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">config_parameters</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">literal_eval</span><span class="p">(</span><span class="n">config_string</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">connect_to_gridapps</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Connects to GridAPPS-D and creates the gridapps session object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gapps_session</span> <span class="o">=</span> <span class="n">GridAPPSD</span><span class="p">(</span><span class="s2">&quot;(&#39;localhost&#39;, 61613)&quot;</span><span class="p">,</span> <span class="n">username</span><span class="o">=</span><span class="s1">&#39;system&#39;</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s1">&#39;manager&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">initialize_sim_mrid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieves the simulation mRID from the simulation object. The mRID is used to connect to messaging topics,</span>
<span class="sd">        while the object contains methods to, for example, start the simulation.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sim_mrid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim_session</span><span class="o">.</span><span class="n">simulation_id</span>
        <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sim_mrid</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">initialize_line_mrid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieves the model mRID from the config parameters.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">line_mrid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config_parameters</span><span class="p">[</span><span class="s2">&quot;power_system_config&quot;</span><span class="p">][</span><span class="s2">&quot;Line_name&quot;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">initialize_sim_start_time</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieves the simulation start timestamp from the config parameters. Note: this is a setting, not the real</span>
<span class="sd">        current time.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sim_start_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config_parameters</span><span class="p">[</span><span class="s2">&quot;simulation_config&quot;</span><span class="p">][</span><span class="s2">&quot;start_time&quot;</span><span class="p">]</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Simulation start time is:&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sim_start_time</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">connect_to_simulation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Connects to the GridAPPS-D simulation (as opposed to the GridAPPS-D program) and creates the simulation object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sim_session</span> <span class="o">=</span> <span class="n">Simulation</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gapps_session</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config_parameters</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">create_objects</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Instantiates all non-callback classes. All objects are global to simplify arguments and facilitate decoupling.</span>
<span class="sd">        (Note: EDMCore is manually instantiated first, in the main loop function. This is part of the startup process.</span>
<span class="sd">        The callback classes need to be instantiated separately to ensure the callback methods work properly.)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">global</span> <span class="n">mcOutputLog</span>
        <span class="n">mcOutputLog</span> <span class="o">=</span> <span class="n">MCOutputLog</span><span class="p">()</span>
        <span class="k">global</span> <span class="n">mcInputInterface</span>
        <span class="n">mcInputInterface</span> <span class="o">=</span> <span class="n">MCInputInterface</span><span class="p">()</span>
        <span class="k">global</span> <span class="n">dersHistoricalDataInput</span>
        <span class="n">dersHistoricalDataInput</span> <span class="o">=</span> <span class="n">DERSHistoricalDataInput</span><span class="p">(</span><span class="n">mcConfiguration</span><span class="p">)</span>
        <span class="k">global</span> <span class="n">rwhDERS</span>
        <span class="n">rwhDERS</span> <span class="o">=</span> <span class="n">RWHDERS</span><span class="p">(</span><span class="n">mcConfiguration</span><span class="p">)</span>
        <span class="k">global</span> <span class="n">derAssignmentHandler</span>
        <span class="n">derAssignmentHandler</span> <span class="o">=</span> <span class="n">DERAssignmentHandler</span><span class="p">()</span>
        <span class="k">global</span> <span class="n">derIdentificationManager</span>
        <span class="n">derIdentificationManager</span> <span class="o">=</span> <span class="n">DERIdentificationManager</span><span class="p">()</span>
        <span class="k">global</span> <span class="n">goSensor</span>
        <span class="n">goSensor</span> <span class="o">=</span> <span class="n">GOSensor</span><span class="p">()</span>
        <span class="k">global</span> <span class="n">goOutputInterface</span>
        <span class="n">goOutputInterface</span> <span class="o">=</span> <span class="n">GOOutputInterface</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">initialize_all_der_s</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calls the initialize_der_s() method for each DER-S listed in mcConfiguration.ders_obj_list.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">mcConfiguration</span><span class="o">.</span><span class="n">ders_obj_list</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="nb">eval</span><span class="p">(</span><span class="n">value</span><span class="p">)</span><span class="o">.</span><span class="n">initialize_der_s</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">start_simulation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Performs one final initialization of the simulation start time (fixes a bug related to our use of the logging</span>
<span class="sd">        API tricking the timekeeper into thinking it&#39;s later than it is) and calls the method to start the actual</span>
<span class="sd">        simulation.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initialize_sim_start_time</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sim_session</span><span class="o">.</span><span class="n">start_simulation</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">establish_mrid_name_lookup_table</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This currently creates two lookup dictionaries. mrid_name_lookup_table gets the real names of measurements for</span>
<span class="sd">        the measurement processor/logger. cim_measurement_dict gives a more fully fleshed out dictionary containing</span>
<span class="sd">        several parameters related to measurements that are appended to the measurement processor&#39;s current readings.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">topic</span> <span class="o">=</span> <span class="s2">&quot;goss.gridappsd.process.request.data.powergridmodel&quot;</span>
        <span class="n">message</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;modelId&quot;</span><span class="p">:</span> <span class="n">edmCore</span><span class="o">.</span><span class="n">get_line_mrid</span><span class="p">(),</span>
            <span class="s2">&quot;requestType&quot;</span><span class="p">:</span> <span class="s2">&quot;QUERY_OBJECT_MEASUREMENTS&quot;</span><span class="p">,</span>
            <span class="s2">&quot;resultFormat&quot;</span><span class="p">:</span> <span class="s2">&quot;JSON&quot;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">object_meas</span> <span class="o">=</span> <span class="n">edmCore</span><span class="o">.</span><span class="n">gapps_session</span><span class="o">.</span><span class="n">get_response</span><span class="p">(</span><span class="n">topic</span><span class="p">,</span> <span class="n">message</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mrid_name_lookup_table</span> <span class="o">=</span> <span class="n">object_meas</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span>

        <span class="n">config_api_topic</span> <span class="o">=</span> <span class="s1">&#39;goss.gridappsd.process.request.config&#39;</span>
        <span class="n">message</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;configurationType&#39;</span><span class="p">:</span> <span class="s1">&#39;CIM Dictionary&#39;</span><span class="p">,</span>
            <span class="s1">&#39;parameters&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;model_id&#39;</span><span class="p">:</span> <span class="n">edmCore</span><span class="o">.</span><span class="n">line_mrid</span><span class="p">}</span>
        <span class="p">}</span>
        <span class="n">cim_dict</span> <span class="o">=</span> <span class="n">edmCore</span><span class="o">.</span><span class="n">gapps_session</span><span class="o">.</span><span class="n">get_response</span><span class="p">(</span><span class="n">config_api_topic</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
        <span class="n">measdict</span> <span class="o">=</span> <span class="n">cim_dict</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;feeders&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;measurements&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cim_measurement_dict</span> <span class="o">=</span> <span class="n">measdict</span>

    <span class="k">def</span> <span class="nf">get_mrid_name_lookup_table</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        ACCESSOR METHOD: Returns the mrid_name_lookup_table.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">mrid_name_lookup_table</span>

    <span class="k">def</span> <span class="nf">get_cim_measurement_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        ACCESSOR METHOD: Returns the cim_measurement.dict.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cim_measurement_dict</span>


<span class="k">class</span> <span class="nc">EDMTimeKeeper</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    CALLBACK CLASS. GridAPPS-D provides logging messages to this callback class. on_message() filters these down</span>
<span class="sd">    to exclude everything except simulation timestep &quot;incrementing to...&quot; messages and simulation ending messages.</span>
<span class="sd">    Each time an incrementation message is received from GridAPPS-D, one second has elapsed. The Timekeeper increments</span>
<span class="sd">    the time each timestep; more importantly, it also calls all methods that are intended to run continuously during</span>
<span class="sd">    simulation runtime. perform_all_on_timestep_updates() updates the MC once per second, including receiving DER-S</span>
<span class="sd">    inputs, updating the DER-EMs, and updating the logs.</span>

<span class="sd">    Note: this does not include updating the grid state measurements. GridAPPS-D retrieves grid states for the</span>
<span class="sd">    measurement callbacks once every three seconds using a completely different communications pathway. As such,</span>
<span class="sd">    measurements and their processing are not handled by this class in any way.</span>

<span class="sd">    ATTRIBUTES:</span>

<span class="sd">        .sim_start_time: The (from config) simulation start timecode.</span>

<span class="sd">        .sim_current_time: The current timestamp. Initialized to the sim start time.</span>

<span class="sd">        .previous_log_message: A buffer containing the previous log message. Necessary to fix a double incrementation</span>
<span class="sd">               glitch caused by GridAPPS-D providing the same log multiple times.</span>

<span class="sd">        .edmCoreObj: edmCore is fed through an argument directly since it doesn&#39;t function properly as a global object.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">edmCoreObj</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sim_start_time</span> <span class="o">=</span> <span class="n">edmCoreObj</span><span class="o">.</span><span class="n">get_sim_start_time</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sim_current_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim_start_time</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">previous_log_message</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">edmCoreObj</span> <span class="o">=</span> <span class="n">edmCoreObj</span>

    <span class="k">def</span> <span class="nf">on_message</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sim</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        CALLBACK METHOD: the &quot;message&quot; argument contains the full text of the Log messages provided by GridAPPS-D. This</span>
<span class="sd">        occurs for many reasons, including startup messages, errors, etc. We are only concerned with two types of</span>
<span class="sd">        messages: if the message contains the text &quot;incrementing to &quot;, that means one second (and thus one timestep) has</span>
<span class="sd">        elapsed, and if the message process status is &quot;complete&quot; or &quot;closed&quot;, we know the simulation is complete and</span>
<span class="sd">        the MC should close out.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># on_message function definitions:</span>

        <span class="k">def</span> <span class="nf">end_program</span><span class="p">():</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Ends the program by closing out the logs and setting the global end program flag to true, breaking the</span>
<span class="sd">            main loop.</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="n">mcOutputLog</span><span class="o">.</span><span class="n">close_out_logs</span><span class="p">()</span>
            <span class="k">global</span> <span class="n">end_program</span>
            <span class="n">end_program</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">def</span> <span class="nf">update_and_increment_timestep</span><span class="p">(</span><span class="n">log_message</span><span class="p">,</span> <span class="bp">self</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Increments the timestep only if &quot;incrementing to &quot; is within the log_message; otherwise does nothing.</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="k">if</span> <span class="s2">&quot;incrementing to &quot;</span> <span class="ow">in</span> <span class="n">log_message</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">log_message</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">previous_log_message</span><span class="p">:</span>  <span class="c1"># Msgs get spit out twice for some reason. Only reads one.</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">increment_sim_current_time</span><span class="p">()</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Current timestep: &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim_current_time</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">perform_all_on_timestep_updates</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">previous_log_message</span> <span class="o">=</span> <span class="n">log_message</span>

        <span class="c1"># on_message() function body:</span>

        <span class="n">log_message</span> <span class="o">=</span> <span class="n">message</span><span class="p">[</span><span class="s2">&quot;logMessage&quot;</span><span class="p">]</span>
        <span class="n">process_status</span> <span class="o">=</span> <span class="n">message</span><span class="p">[</span><span class="s1">&#39;processStatus&#39;</span><span class="p">]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">process_status</span> <span class="o">==</span> <span class="s1">&#39;COMPLETE&#39;</span> <span class="ow">or</span> <span class="n">process_status</span> <span class="o">==</span> <span class="s1">&#39;CLOSED&#39;</span><span class="p">:</span>
                <span class="n">end_program</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">update_and_increment_timestep</span><span class="p">(</span><span class="n">log_message</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">KeyError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>   <span class="c1"># Spits out the log message for troubleshooting if something weird happens.</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;KeyError!&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">increment_sim_current_time</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Increments the current simulation time by 1.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">current_int_time</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sim_current_time</span><span class="p">)</span>
        <span class="n">current_int_time</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sim_current_time</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">current_int_time</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_sim_current_time</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        ACCESSOR: Returns the current simulation time. (Not real time.)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim_current_time</span>

    <span class="k">def</span> <span class="nf">perform_all_on_timestep_updates</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        ENCAPSULATION: Calls all methods that update the system each timestep (second). New processes should be added</span>
<span class="sd">        here if they need to be ongoing, I.E. once per second through the simulation.</span>

<span class="sd">        NOTE: DOES NOT INCLUDE MEASUREMENT READING/PROCESSING. Those are done once every three seconds due to the way</span>
<span class="sd">        GridAPPS-D is designed and are independent of the simulation timekeeper processes. See EDMMeasurementProcessor.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Performing on-timestep updates:&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">edmCoreObj</span><span class="o">.</span><span class="n">sim_current_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim_current_time</span>
        <span class="n">mcInputInterface</span><span class="o">.</span><span class="n">update_all_der_s_status</span><span class="p">()</span>
        <span class="n">mcInputInterface</span><span class="o">.</span><span class="n">update_all_der_em_status</span><span class="p">()</span>
        <span class="n">mcOutputLog</span><span class="o">.</span><span class="n">update_logs</span><span class="p">()</span>
        <span class="n">goSensor</span><span class="o">.</span><span class="n">make_service_request_decision</span><span class="p">()</span>
        <span class="n">goOutputInterface</span><span class="o">.</span><span class="n">get_all_posted_service_requests</span><span class="p">()</span>
        <span class="n">goOutputInterface</span><span class="o">.</span><span class="n">send_service_request_messages</span><span class="p">()</span>


<span class="k">class</span> <span class="nc">EDMMeasurementProcessor</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    CALLBACK CLASS: once per three seconds (roughly), GridAPPS-D provides a dictionary to the on_message() method</span>
<span class="sd">    containing all of the simulation measurements by mRID including the magnitude, angle, etc. The measurement processor</span>
<span class="sd">    parses that dictionary into something more useful to the MC, draws more valuable information from the model, gets</span>
<span class="sd">    association and location data from the input branch, and appends it to the dictionary to produce something usable</span>
<span class="sd">    by the GO and the logging class.</span>

<span class="sd">    NOTE: the API for measurements and timekeeping are completely separate. The MC as a whole is synchronized with the</span>
<span class="sd">    timekeeping class, but measurement processes are done separately. This is why logs will have repeated values: the</span>
<span class="sd">    logs are part of the MC and thus update once per second, but the grid states going IN to the logs are only updated</span>
<span class="sd">    once per three seconds.</span>

<span class="sd">    ATTRIBUTES:</span>
<span class="sd">        .measurement_timestamp: The timestamp of the most recent set of measurements as read from the GridAPPS-D</span>
<span class="sd">            message. NOTE: Currently unused, but might be useful for future log revisions.</span>

<span class="sd">        .current_measurements: Contains the measurements taken from the GridAPPS-D message. Written in the function</span>
<span class="sd">            parse_message_into_current_measurements.</span>

<span class="sd">        .mrid_name_lookup_table: Read from EDMCore. Used to append informative data to each measurement.</span>

<span class="sd">        .measurement_lookup_table: Read from EDMCore. Used to append (different) information to each measurement.</span>

<span class="sd">        .measurement_mrids: Measurement dictionaries provided by GridAPPS-D use mRIDs as keys for each measurement.</span>
<span class="sd">            This contains a list of those keys and is used to replace those mRIDs with human-readable names.</span>

<span class="sd">        .measurement_names: A list of human-readable measurement names. See measurement_mrids.</span>

<span class="sd">        .assignment_lookup_table: Read from DERAssignmentHandler. Used to append DER-S to DER-EM association data to</span>
<span class="sd">            each measurement for logging and troubleshooting purposes.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">measurement_timestamp</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_measurements</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mrid_name_lookup_table</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">measurement_lookup_table</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">measurement_mrids</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">measurement_names</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assignment_lookup_table</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">on_message</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">headers</span><span class="p">,</span> <span class="n">measurements</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        CALLBACK METHOD: receives the measurements once every three seconds, and passes them to the parsing method.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parse_message_into_current_measurements</span><span class="p">(</span><span class="n">measurements</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_current_measurements</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        ACCESSOR: Returns the current fully processed measurement dictionary.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_measurements</span>

    <span class="k">def</span> <span class="nf">parse_message_into_current_measurements</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">measurement_message</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The measurement message from GridAPPS-D is pretty ugly. This method pulls out just the stuff we need, and then</span>
<span class="sd">        calls methods to append names, association/location info, etc. Basically, this turns the raw input data into</span>
<span class="sd">        the fully formatted edmMeasurementProcessor.current_measurements dictionary which is passed to the logger and GO</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_measurements</span> <span class="o">=</span> <span class="n">measurement_message</span><span class="p">[</span><span class="s1">&#39;message&#39;</span><span class="p">][</span><span class="s1">&#39;measurements&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">measurement_timestamp</span> <span class="o">=</span> <span class="n">measurement_message</span><span class="p">[</span><span class="s1">&#39;message&#39;</span><span class="p">][</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">append_names</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">append_association_data</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">append_names</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds a bunch of extra important information to each measurement&#39;s value dictionary.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mrid_name_lookup_table</span> <span class="o">=</span> <span class="n">edmCore</span><span class="o">.</span><span class="n">get_mrid_name_lookup_table</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">measurement_lookup_table</span> <span class="o">=</span> <span class="n">edmCore</span><span class="o">.</span><span class="n">get_cim_measurement_dict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">measurement_mrids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_measurements</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">measurement_mrids</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">lookup_mrid</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">item</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mrid_name_lookup_table</span> <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;measid&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">i</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">StopIteration</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">lookup_mrid</span><span class="p">)</span>
            <span class="n">lookup_name</span> <span class="o">=</span> <span class="n">lookup_mrid</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">measurement_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lookup_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">measurement_mrids</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">measurement_mrids</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">measurement_names</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">measurement_mrids</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">current_measurements</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;Measurement name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
                <span class="n">measurement_table_dict_containing_mrid</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">item</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">measurement_lookup_table</span>
                                                              <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;mRID&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">key</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">current_measurements</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;Meas Name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">measurement_table_dict_containing_mrid</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">current_measurements</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;Conducting Equipment Name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">measurement_table_dict_containing_mrid</span><span class="p">[</span>
                    <span class="s1">&#39;ConductingEquipment_name&#39;</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">current_measurements</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;Bus&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">measurement_table_dict_containing_mrid</span><span class="p">[</span>
                    <span class="s1">&#39;ConnectivityNode&#39;</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">current_measurements</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;Phases&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">measurement_table_dict_containing_mrid</span><span class="p">[</span>
                    <span class="s1">&#39;phases&#39;</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">current_measurements</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;MeasType&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">measurement_table_dict_containing_mrid</span><span class="p">[</span>
                    <span class="s1">&#39;measurementType&#39;</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">StopIteration</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Measurements updated with amplifying information.&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">append_association_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Appends association data.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assignment_lookup_table</span> <span class="o">=</span> <span class="n">derAssignmentHandler</span><span class="o">.</span><span class="n">get_assignment_lookup_table</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">assignment_lookup_table</span><span class="p">:</span>
            <span class="n">original_name</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;Name&#39;</span><span class="p">]</span>
            <span class="n">formatted_name</span> <span class="o">=</span> <span class="n">original_name</span><span class="p">[:</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="s1">&#39;_Battery&#39;</span><span class="p">)]</span>
            <span class="n">item</span><span class="p">[</span><span class="s1">&#39;DER-EM Name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">formatted_name</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_measurements</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">assignment_dict_with_given_name</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">item</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">assignment_lookup_table</span> <span class="k">if</span>
                                                       <span class="n">item</span><span class="p">[</span><span class="s1">&#39;DER-EM Name&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_measurements</span><span class="p">[</span><span class="n">key</span><span class="p">][</span>
                                                           <span class="s1">&#39;Conducting Equipment Name&#39;</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">current_measurements</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;Inverter Control mRID&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">assignment_dict_with_given_name</span><span class="p">[</span><span class="s1">&#39;mRID&#39;</span><span class="p">]</span>
                <span class="n">input_name</span> <span class="o">=</span> <span class="n">derIdentificationManager</span><span class="o">.</span><span class="n">get_meas_name</span><span class="p">(</span><span class="n">assignment_dict_with_given_name</span><span class="p">[</span><span class="s1">&#39;mRID&#39;</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">current_measurements</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;Input Unique ID&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">input_name</span>
            <span class="k">except</span> <span class="ne">StopIteration</span><span class="p">:</span>
                <span class="k">pass</span>


<span class="k">class</span> <span class="nc">RWHDERS</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The Resistive Water Heater DER-S. This DER-S is designed to build on prior work by the Portland State Univerity</span>
<span class="sd">    Power Engineering Group. RWHDERS is designed to provide a means for resistive water heaters to be modeled and</span>
<span class="sd">    simulated in the Modeling Environment.</span>

<span class="sd">    The input to RWHDERS is information from water heater emulators that are/will be provided by the GSP (via the EGoT</span>
<span class="sd">    server/client system). These emulators function over time as a resistive water heater, turning on and off based on</span>
<span class="sd">    current tank temperature, ambient losses, usage profiles, etc. These functions are handled externally to the ME,</span>
<span class="sd">    however: the end result is a series of .csv files contained in the RWHDERS Inputs folder.</span>

<span class="sd">    The ME uses these .csv files as follows. Each file is named &quot;DER#####_Bus###.csv&quot;. The first set of numbers is a</span>
<span class="sd">    serial number used as each emulated DER input&#39;s &#39;unique identifier&#39;. The second set is the &#39;locational information&#39;,</span>
<span class="sd">    in this case the Bus the DER should be located on in the model. The contents of the .csv file are a single pair of</span>
<span class="sd">    values: &quot;P&quot;, for power, and a number corresponding to what the power should be set to. This is by agreement with</span>
<span class="sd">    the GSP designer; in the future, the file could contain voltages, or more complex information such as usage profiles</span>
<span class="sd">    that would require modification to the RWHDERS class to parse.</span>

<span class="sd">    At the beginning of each simulation, the DERAssignmentHandler class calls the assign_der_s_to_der_em() function for</span>
<span class="sd">    each DER-S, including RWHDERS. This function associates each unique identifier with the mRID of a DER-EM. These</span>
<span class="sd">    DER-EMs already exist in the model and do nothing unless associated with a DER-S unit.</span>

<span class="sd">    During the simulation, each time step RWHDERS reads the .csv files for updates. The power levels for each DER are</span>
<span class="sd">    processed into a standard message format used by MCInputInterface. The association data is used to ensure each</span>
<span class="sd">    input is being sent to the proper DER-EM by MCInputInterface. Then, again on each timestep, MCInputInterface updates</span>
<span class="sd">    the DER-EMs in the model with the new power data, which is reflected in the logs.</span>

<span class="sd">    In this way, changes to water heater states are converted to time-valued power changes, which are sent to RWHDERS,</span>
<span class="sd">    processed by the MC, and written into the simulation so that grid states reflect the changes.</span>

<span class="sd">    ATTRIBUTES:</span>
<span class="sd">        .der_em_input_request: Contains the new DER-EM states for this timestep, already parsed and put into list</span>
<span class="sd">            format by RWHDERS. The list is so multiple DER-EMs can be updated per timestep.</span>

<span class="sd">        .input_file_path: The folder in which the RWHDERS input files are located.</span>

<span class="sd">        .input_identification_dict: a dictionary of identification information for each DER input. The keys are the</span>
<span class="sd">           serial numbers parsed from each file name, and the values include the buys and the filename. Used during</span>
<span class="sd">           assignment, and also on time step to get the right data from the right file for each DER&#39;s unique ID.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mcConfiguration</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">der_em_input_request</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">input_file_path</span> <span class="o">=</span> <span class="n">mcConfiguration</span><span class="o">.</span><span class="n">mc_file_directory</span> <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot;/RWHDERS Inputs/&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">input_identification_dict</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="nf">initialize_der_s</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function (with this specific name) is required in each DER-S used by the ME. The EDMCore&#39;s initialization</span>
<span class="sd">        process calls this function for each DER-S activated in MCConfig to perform initialization tasks. This does not</span>
<span class="sd">        include DER-EM assignment (see assign_der_s_to_der_em). In this case, all this function does is call</span>
<span class="sd">        the parse_input_file_names_for_assignment() function. See below.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parse_input_file_names_for_assignment</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">assign_der_s_to_der_em</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function (with this specific name) is required in each DER-S used by the ME. The DERAssignmentHandler</span>
<span class="sd">        calls this function for each DER-S activated in MCConfig. This function&#39;s purpose is to take unique identifiers</span>
<span class="sd">        from each &quot;DER input&quot; for a given DER-S and &quot;associate&quot; them with the mRIDs for DER-EMs in the model. This is</span>
<span class="sd">        done using locational data: I.E. a specific DER input should be associated with the mRID of a DER-EM on a given</span>
<span class="sd">        bus. This function does those tasks using the input_identification_dict generated in the initialization process</span>
<span class="sd">        (see self.parse_input_file_names_for_assignment())</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;iid&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">input_identification_dict</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_identification_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">der_id</span> <span class="o">=</span> <span class="n">key</span>
            <span class="n">der_bus</span> <span class="o">=</span> <span class="n">value</span><span class="p">[</span><span class="s1">&#39;Bus&#39;</span><span class="p">]</span>
            <span class="n">der_mrid</span> <span class="o">=</span> <span class="n">derAssignmentHandler</span><span class="o">.</span><span class="n">get_mRID_for_der_on_bus</span><span class="p">(</span><span class="n">der_bus</span><span class="p">)</span>
            <span class="n">der_being_assigned</span> <span class="o">=</span> <span class="p">{</span><span class="n">der_id</span><span class="p">:</span> <span class="n">der_mrid</span><span class="p">}</span>
            <span class="n">derAssignmentHandler</span><span class="o">.</span><span class="n">append_new_values_to_association_table</span><span class="p">(</span><span class="n">der_being_assigned</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">parse_input_file_names_for_assignment</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function is called during the DER-S initialization process. It reads all the files in the RWHDERS Inputs</span>
<span class="sd">        folder and parses them into an input dictionary containing the unique ID, file name, and Bus location for each.</span>
<span class="sd">        These are used during assignment and each time step to &quot;connect the dots&quot; between the input file and the</span>
<span class="sd">        DER-EM which represents its data.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">filename_list</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">input_file_path</span><span class="p">)</span>
        <span class="n">parsed_filename_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">filename_list</span><span class="p">:</span>
            <span class="n">g</span> <span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)</span>
            <span class="n">g</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">g</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">5</span><span class="p">:]</span>
            <span class="n">g</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">g</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">3</span><span class="p">:</span><span class="mi">6</span><span class="p">]</span>
            <span class="n">parsed_filename_list</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="n">g</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span> <span class="p">{</span><span class="s2">&quot;Filepath&quot;</span><span class="p">:</span> <span class="n">i</span><span class="p">,</span> <span class="s2">&quot;Bus&quot;</span><span class="p">:</span> <span class="n">g</span><span class="p">[</span><span class="mi">1</span><span class="p">]}})</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">parsed_filename_list</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">input_identification_dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">update_der_em_input_request</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reads the input data from each file in the input identification dict, and puts it in a list readable by the</span>
<span class="sd">        MCInputInterface.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">der_em_input_request</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_identification_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="kn">import</span> <span class="nn">csv</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">input_file_path</span> <span class="o">+</span> <span class="n">value</span><span class="p">[</span><span class="s1">&#39;Filepath&#39;</span><span class="p">],</span> <span class="n">newline</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">csvfile</span><span class="p">:</span>
                <span class="n">der_input_reader</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">reader</span><span class="p">(</span><span class="n">csvfile</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">der_input_reader</span><span class="p">:</span>
                    <span class="n">current_der_input</span> <span class="o">=</span> <span class="p">{</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span> <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]}</span>
                    <span class="nb">print</span><span class="p">(</span><span class="n">current_der_input</span><span class="p">)</span>
            <span class="n">current_der_real_power</span> <span class="o">=</span> <span class="n">current_der_input</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">]</span>
            <span class="n">current_der_input_request</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="p">:</span> <span class="n">current_der_real_power</span><span class="p">}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">der_em_input_request</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">current_der_input_request</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_input_request</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function (with this specific name) is required in each DER-S used by the ME. Accessor function that calls</span>
<span class="sd">        for an updated input request, then returns the updated request for use by the MCInputInterface</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_der_em_input_request</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">der_em_input_request</span>


<span class="k">class</span> <span class="nc">DERSHistoricalDataInput</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The Historical Data DER-S. Sometimes referred to as &quot;manual input&quot;, this DER-S serves as a simple method to</span>
<span class="sd">    update DER-EMs manually at certain times with specific values, allowing the test engineer to write in grid states</span>
<span class="sd">    as needed by each simulation. Since DER-EMs are generic models, each historical data input could represent a single</span>
<span class="sd">    DER, groups of DERs, or even more abstract ideas such as massive power excursions.</span>

<span class="sd">    The input is a single .csv file, contained in the DERSHistoricalData Inputs folder. This .csv is timestamped and</span>
<span class="sd">    in a specific format; after the timestamp column, columns are in pairs, with each pair representing Power and Bus</span>
<span class="sd">    for each DER-EM. The bus is used for assignment, at which point the values are associated to DER-EMs by header</span>
<span class="sd">    names.</span>

<span class="sd">    Otherwise, it functions like any other DER-S: it has an initialization process, an assignment process, and on</span>
<span class="sd">    timestep updates.</span>

<span class="sd">    ATTRIBUTES:</span>
<span class="sd">        .der_em_input_request: Contains the new DER-EM states for this timestep, already parsed and put into list</span>
<span class="sd">           format by the function. The list is so multiple DER-EMs can be updated per timestep.</span>

<span class="sd">        .input_file_path: The folder in which the DERSHistoricalDataInput files are located.</span>

<span class="sd">        .input_table: The input files are in .csv format; the csv reader reads these files into a table here.</span>

<span class="sd">        .list_of_ders: The DER names read from the header of the input table.</span>

<span class="sd">        .location_lookup_dictionary: A dictionary associating the DER unique identifiers with the bus they should</span>
<span class="sd">           be assigned to.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mcConfiguration</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">der_em_input_request</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">historical_data_file_path</span> <span class="o">=</span> <span class="n">mcConfiguration</span><span class="o">.</span><span class="n">mc_file_directory</span> <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot;DERSHistoricalData Inputs/2p_input2.csv&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">input_table</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">list_of_ders</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">location_lookup_dictionary</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="nf">initialize_der_s</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function (with this specific name) is required in each DER-S used by the ME. The EDMCore&#39;s initialization</span>
<span class="sd">        process calls this function for each DER-S activated in MCConfig to perform initialization tasks. This does not</span>
<span class="sd">        include DER-EM assignment (see assign_der_s_to_der_em). In this case, all this function does is call</span>
<span class="sd">        the read_input_file() function. See below.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read_input_file</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">get_input_request</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function (with this specific name) is required in each DER-S used by the ME. Accessor function that calls</span>
<span class="sd">        for an updated input request, then returns the updated request for use by the MCInputInterface</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_der_em_input_request</span><span class="p">()</span>
        <span class="c1"># print(&quot;DER EM INPUT REQUEST&quot;)</span>
        <span class="c1"># print(self.der_em_input_request)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">der_em_input_request</span>

    <span class="k">def</span> <span class="nf">assign_der_s_to_der_em</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function (with this specific name) is required in each DER-S used by the ME. The DERAssignmentHandler</span>
<span class="sd">        calls this function for each DER-S activated in MCConfig. This function&#39;s purpose is to take unique identifiers</span>
<span class="sd">        from each &quot;DER input&quot; for a given DER-S and &quot;associate&quot; them with the mRIDs for DER-EMs in the model. This is</span>
<span class="sd">        done using locational data: I.E. a specific DER input should be associated with the mRID of a DER-EM on a given</span>
<span class="sd">        bus.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">list_of_ders</span><span class="p">:</span>
            <span class="n">der_being_assigned</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">der_being_assigned</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_table</span><span class="p">[</span><span class="mi">0</span><span class="p">][(</span><span class="bp">self</span><span class="o">.</span><span class="n">location_lookup_dictionary</span><span class="p">[</span><span class="n">i</span><span class="p">])]</span>
            <span class="n">der_being_assigned</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">derAssignmentHandler</span><span class="o">.</span><span class="n">get_mRID_for_der_on_bus</span><span class="p">(</span><span class="n">der_being_assigned</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="n">assigned_der</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">([(</span><span class="n">value</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span> <span class="k">for</span> <span class="n">value</span><span class="p">,</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">der_being_assigned</span><span class="o">.</span><span class="n">items</span><span class="p">()])</span>
            <span class="n">derAssignmentHandler</span><span class="o">.</span><span class="n">append_new_values_to_association_table</span><span class="p">(</span><span class="n">assigned_der</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">open_input_file</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Opens the historical data input file, read it as a .csv file, and parses it into a list of dicts.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">historical_data_file_path</span><span class="p">)</span> <span class="k">as</span> <span class="n">csvfile</span><span class="p">:</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">DictReader</span><span class="p">(</span><span class="n">csvfile</span><span class="p">)</span>
            <span class="n">x</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">r</span><span class="p">:</span>
                <span class="n">row</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
                <span class="n">x</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Historical data file opened&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">x</span>

    <span class="k">def</span> <span class="nf">read_input_file</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reads and parses the input file. Places all the input information in input_table. Also, parses the</span>
<span class="sd">        .csv file to determine the names and locations of each DER: when the timestamp column is removed, odd column</span>
<span class="sd">        headers are names and even headers are their associated locations. These lists are converted to a list</span>
<span class="sd">        of dictionaries to be passed to the assignment handler (which takes the locations for each DER name and assigns</span>
<span class="sd">        a DER-EM mRID at the proper location to the name, this allows the MC to provide updated DER states to the DER-EM</span>
<span class="sd">        without requiring the inputs to know DER-EM mRIDs.)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">input_table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">open_input_file</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Retrieving locational data:&quot;</span><span class="p">)</span>
        <span class="n">first_row</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">item</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_table</span><span class="p">)</span>
        <span class="n">first_row</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">first_row</span><span class="p">)</span>
        <span class="n">first_row</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;Time&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;First row:&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">first_row</span><span class="p">)</span>
        <span class="n">log_der_keys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">first_row</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">log_der_keys</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">log_der_keys</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">der_name</span> <span class="o">=</span> <span class="n">log_der_keys</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">der_loc</span> <span class="o">=</span> <span class="n">log_der_keys</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">location_lookup_dictionary</span><span class="p">[</span><span class="n">der_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">der_loc</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Current dict:&quot;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">location_lookup_dictionary</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">list_of_ders</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">location_lookup_dictionary</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;List of DERS:&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">list_of_ders</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">update_der_em_input_request</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Checks the current simulation time against the input table. If a new input exists for the current timestep,</span>
<span class="sd">        it is read, converted into an input dictionary, and put in the current der_input_request</span>
<span class="sd">        (see MCInputInterface.get_all_der_s_input_requests() )</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">der_em_input_request</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">input_at_time_now</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">item</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_table</span> <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">edmCore</span><span class="o">.</span><span class="n">sim_current_time</span><span class="p">)</span> <span class="o">&lt;=</span>
                                     <span class="nb">int</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="s1">&#39;Time&#39;</span><span class="p">])</span> <span class="o">&lt;</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">edmCore</span><span class="o">.</span><span class="n">sim_current_time</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Updating DER-EMs from historical data.&quot;</span><span class="p">)</span>
            <span class="n">input_at_time_now</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">input_at_time_now</span><span class="p">)</span>
            <span class="n">input_at_time_now</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;Time&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">list_of_ders</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">der_em_input_request</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="n">i</span><span class="p">:</span> <span class="n">input_at_time_now</span><span class="p">[</span><span class="n">i</span><span class="p">]})</span>
        <span class="k">except</span> <span class="ne">StopIteration</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;End of input data.&quot;</span><span class="p">)</span>
            <span class="k">return</span>


<span class="k">class</span> <span class="nc">DERIdentificationManager</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This class manages the input association lookup table generated by the DERSAssignmentHandler. The accessor methods</span>
<span class="sd">    allow input unique IDs to be looked up for a given DER-EM mRID, or vice versa. The table is generated during the</span>
<span class="sd">    assignment process (see DERAssignmentHandler).</span>

<span class="sd">    ATTRIBUTES:</span>
<span class="sd">        .association_lookup_table: a list of dictionaries containing association data, read from the</span>
<span class="sd">            DERAssignmentHandler after the startup process is complete. Used to connect the unique identifiers of</span>
<span class="sd">            DER inputs (whatever form they might take) to mRIDs for their assigned DER-EMs.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">association_lookup_table</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">get_meas_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mrid</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        ACCESSOR FUNCTION: Returns a unique identifier for a given DER-EM mRID. If none found, the DER-EM was never</span>
<span class="sd">        assigned, and &#39;Unassigned&#39; is returned instead.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">association_lookup_table</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">i</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">value</span> <span class="o">==</span> <span class="n">mrid</span><span class="p">:</span>
                    <span class="n">input_unique_id</span> <span class="o">=</span> <span class="n">key</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">input_unique_id</span>
        <span class="k">except</span> <span class="ne">UnboundLocalError</span><span class="p">:</span>
            <span class="k">return</span> <span class="s1">&#39;Unassigned&#39;</span>

    <span class="k">def</span> <span class="nf">get_der_em_mrid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        ACCESSOR FUNCTION: Returns the associated DER-EM control mRID for a given input unique identifier. Unlike</span>
<span class="sd">        get_meas_name(), if none is found that signifies a critical error with the DERSAssignmentHandler.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">x</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">d</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">d</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">association_lookup_table</span><span class="p">)</span> <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">d</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">x</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">initialize_association_lookup_table</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieves the association table from the assignment handler.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">association_lookup_table</span> <span class="o">=</span> <span class="n">derAssignmentHandler</span><span class="o">.</span><span class="n">association_table</span>


<span class="k">class</span> <span class="nc">DERAssignmentHandler</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This class is used during the MC startup process. DER-S inputs will not know the mRIDs of DER-EMs since those</span>
<span class="sd">    are internal to the EDM. As such, a process is required to assign each incoming DER input to an appropriate DER-EM</span>
<span class="sd">    mRID, so that it&#39;s states can be updated in the model. Each DER-S DER unit requires a unique identifier (a name, a</span>
<span class="sd">    unique number, etc.) and a &quot;location&quot; on the grid, generally the bus it&#39;s located on. The assignment handler</span>
<span class="sd">    receives as input a list of {uniqueID:location} dictionaries, uses the location values to look up the DER-EMs on the</span>
<span class="sd">    appropriate bus, and assigns each unique identifier to an individual DER-EM. These associations are passed to the</span>
<span class="sd">    Identification Manager; during the simulation, new inputs from each unique ID sent to the input manager, which</span>
<span class="sd">    automatically looks up the appropriate mRID for the associated DER-EM and sends the inputs there.</span>

<span class="sd">    ATTRIBUTES:</span>
<span class="sd">        .assignment_lookup_table: contains a list of dictionaries containing mRID, name, and Bus of each DER-EM within</span>
<span class="sd">            the model.</span>

<span class="sd">        .assignment_table: a redundant assignment_lookup_table, used during the assignment process in order to prevent</span>
<span class="sd">            modification to the original assignment lookup table (which will still need to be used by the output</span>
<span class="sd">            branch).</span>

<span class="sd">        .association_table: Contains association data provided by each DER-S class, for use by the</span>
<span class="sd">            DERIdentificationManager.</span>

<span class="sd">        .der_em_mrid_per_bus_query_message: SPARQL Query used to gather the DER-EM info for the assignment tables.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assignment_lookup_table</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assignment_table</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">association_table</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">der_em_mrid_per_bus_query_message</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot; </span>
<span class="s2">        PREFIX r:  &lt;http://www.w3.org/1999/02/22-rdf-syntax-ns#&gt;</span>
<span class="s2">        PREFIX c:  &lt;http://iec.ch/TC57/CIM100#&gt;</span>
<span class="s2">        SELECT ?name ?id ?bus ?ratedS ?ratedU ?ipu ?p ?q ?fdrid (group_concat(distinct ?phs;separator=&quot;</span><span class="se">\\</span><span class="s2">n&quot;) as ?phases) WHERE {</span>
<span class="s2">         ?s r:type c:BatteryUnit.</span>
<span class="s2">         ?s c:IdentifiedObject.name ?name.</span>
<span class="s2">          ?s c:IdentifiedObject.mRID ?id.</span>
<span class="s2">         ?pec c:PowerElectronicsConnection.PowerElectronicsUnit ?s.</span>
<span class="s2">        # feeder selection options - if all commented out, query matches all feeders</span>
<span class="s2">        #VALUES ?fdrid {&quot;_C1C3E687-6FFD-C753-582B-632A27E28507&quot;}  # 123 bus</span>
<span class="s2">        VALUES ?fdrid {&quot;_49AD8E07-3BF9-A4E2-CB8F-C3722F837B62&quot;}  # 13 bus</span>
<span class="s2">         ?pec c:Equipment.EquipmentContainer ?fdr.</span>
<span class="s2">         ?fdr c:IdentifiedObject.mRID ?fdrid.</span>
<span class="s2">         ?pec c:PowerElectronicsConnection.ratedS ?ratedS.</span>
<span class="s2">         ?pec c:PowerElectronicsConnection.ratedU ?ratedU.</span>
<span class="s2">         ?pec c:PowerElectronicsConnection.maxIFault ?ipu.</span>
<span class="s2">         ?pec c:PowerElectronicsConnection.p ?p.</span>
<span class="s2">         ?pec c:PowerElectronicsConnection.q ?q.</span>
<span class="s2">         OPTIONAL {?pecp c:PowerElectronicsConnectionPhase.PowerElectronicsConnection ?pec.</span>
<span class="s2">         ?pecp c:PowerElectronicsConnectionPhase.phase ?phsraw.</span>
<span class="s2">           bind(strafter(str(?phsraw),&quot;SinglePhaseKind.&quot;) as ?phs) }</span>
<span class="s2">         ?t c:Terminal.ConductingEquipment ?pec.</span>
<span class="s2">         ?t c:Terminal.ConnectivityNode ?cn.</span>
<span class="s2">         ?cn c:IdentifiedObject.name ?bus</span>
<span class="s2">        }</span>
<span class="s2">        GROUP by ?name ?id ?bus ?ratedS ?ratedU ?ipu ?p ?q ?fdrid</span>
<span class="s2">        ORDER by ?name</span>
<span class="s2">        &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">get_assignment_lookup_table</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        ACCESSOR: Returns the assignment lookup table. Used in the message appendage process.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">assignment_lookup_table</span>

    <span class="k">def</span> <span class="nf">create_assignment_lookup_table</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Runs an extended SPARQL query on the database and parses it into the assignment lookup table: that is, the names</span>
<span class="sd">        and mRIDs of all DER-EMs on each bus in the current model.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">der_em_mrid_per_bus_query_output</span> <span class="o">=</span> <span class="n">edmCore</span><span class="o">.</span><span class="n">gapps_session</span><span class="o">.</span><span class="n">query_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">der_em_mrid_per_bus_query_message</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">der_em_mrid_per_bus_query_output</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;results&#39;</span><span class="p">][</span><span class="s1">&#39;bindings&#39;</span><span class="p">])):</span>
            <span class="n">x</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;Name&#39;</span><span class="p">:</span> <span class="n">der_em_mrid_per_bus_query_output</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;results&#39;</span><span class="p">][</span><span class="s1">&#39;bindings&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">][</span><span class="s1">&#39;value&#39;</span><span class="p">],</span>
                      <span class="s1">&#39;Bus&#39;</span><span class="p">:</span> <span class="n">der_em_mrid_per_bus_query_output</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;results&#39;</span><span class="p">][</span><span class="s1">&#39;bindings&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;bus&#39;</span><span class="p">][</span><span class="s1">&#39;value&#39;</span><span class="p">],</span>
                      <span class="s1">&#39;mRID&#39;</span><span class="p">:</span> <span class="n">der_em_mrid_per_bus_query_output</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;results&#39;</span><span class="p">][</span><span class="s1">&#39;bindings&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;id&#39;</span><span class="p">][</span><span class="s1">&#39;value&#39;</span><span class="p">]})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assignment_lookup_table</span> <span class="o">=</span> <span class="n">x</span>

    <span class="k">def</span> <span class="nf">assign_all_ders</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calls the assignment process for each DER-S. Uses the DER-S list from MCConfiguration, so no additions are</span>
<span class="sd">        needed here if new DER-Ss are added.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assignment_table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assignment_lookup_table</span>

        <span class="c1"># Object list contains string names of objects. eval() lets us use these to call the methods for the proper obj</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">mcConfiguration</span><span class="o">.</span><span class="n">ders_obj_list</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="nb">eval</span><span class="p">(</span><span class="n">value</span><span class="p">)</span><span class="o">.</span><span class="n">assign_der_s_to_der_em</span><span class="p">()</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;DER Assignment complete.&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">association_table</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_mRID_for_der_on_bus</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Bus</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        For a given Bus, checks if a DER-EM exists on that bus and is available for assignment. If so, returns its mRID</span>
<span class="sd">        and removes it from the list (so a DER-EM can&#39;t be assigned twice).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Getting mRID for a der on bus:&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">Bus</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">next_mrid_on_bus</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">item</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">assignment_table</span> <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;Bus&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="nb">str</span><span class="p">(</span><span class="n">Bus</span><span class="p">))</span>
            <span class="n">mrid</span> <span class="o">=</span> <span class="n">next_mrid_on_bus</span><span class="p">[</span><span class="s1">&#39;mRID&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assignment_table</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">assignment_table</span> <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="s1">&#39;mRID&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">mrid</span><span class="p">)]</span>
        <span class="k">except</span> <span class="ne">StopIteration</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;FATAL ERROR: Attempting to assign a DER to a nonexistant DER-EM. &quot;</span>
                  <span class="s2">&quot;The bus may be wrong, or may not contain enough DER-EMs. Verify test.&quot;</span><span class="p">)</span>
            <span class="n">quit</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">next_mrid_on_bus</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">mrid</span>

    <span class="k">def</span> <span class="nf">append_new_values_to_association_table</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Used by DER-S classes to add new values to the association table during initialization.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">association_table</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">MCInputInterface</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Input interface. Receives input messages from DER-Ss, retrieves the proper DER-EM input mRIDs for each input from</span>
<span class="sd">    the Identification Manager, and delivers input messages to the EDM that update the DER-EMs with the new states.</span>

<span class="sd">    ATTRIBUTES:</span>
<span class="sd">        .current_unified_input_request: A list of all input requests currently being provided to the Input Interface</span>
<span class="sd">            by all active DER-Ss.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_unified_input_request</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">update_all_der_em_status</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Currently, calls the test_der_em() method. In future, will call all input methods.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_der_ems</span><span class="p">()</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">update_all_der_s_status</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets the DER-S input requests.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_all_der_s_input_requests</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">get_all_der_s_input_requests</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieves input requests from all DER-Ss and appends them to a unified input request.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">online_ders</span> <span class="o">=</span> <span class="n">mcConfiguration</span><span class="o">.</span><span class="n">ders_obj_list</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;online_ders&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">online_ders</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_unified_input_request</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">mcConfiguration</span><span class="o">.</span><span class="n">ders_obj_list</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current_unified_input_request</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_unified_input_request</span> <span class="o">+</span> <span class="nb">eval</span><span class="p">(</span><span class="n">value</span><span class="p">)</span><span class="o">.</span><span class="n">get_input_request</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Current unified input request:&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_unified_input_request</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">update_der_ems</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reads each line in the unified input request and uses the GridAPPS-D library to generate EDM input messages for</span>
<span class="sd">        each one. The end result is the inputs are sent to the associated DER-EMs and the grid model is updated with</span>
<span class="sd">        the new DER states. This will be reflected in future measurements.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">input_topic</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">simulation_input_topic</span><span class="p">(</span><span class="n">edmCore</span><span class="o">.</span><span class="n">sim_mrid</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_unified_input_request</span><span class="p">:</span>
            <span class="n">der_name_to_look_up</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
            <span class="n">der_name_to_look_up</span> <span class="o">=</span> <span class="n">der_name_to_look_up</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">associated_der_em_mrid</span> <span class="o">=</span> <span class="n">derIdentificationManager</span><span class="o">.</span><span class="n">get_der_em_mrid</span><span class="p">(</span><span class="n">der_name_to_look_up</span><span class="p">)</span>
            <span class="n">my_diff_build</span> <span class="o">=</span> <span class="n">DifferenceBuilder</span><span class="p">(</span><span class="n">edmCore</span><span class="o">.</span><span class="n">sim_mrid</span><span class="p">)</span>
            <span class="n">my_diff_build</span><span class="o">.</span><span class="n">add_difference</span><span class="p">(</span><span class="n">associated_der_em_mrid</span><span class="p">,</span> <span class="s2">&quot;PowerElectronicsConnection.p&quot;</span><span class="p">,</span>
                                         <span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="n">der_name_to_look_up</span><span class="p">]),</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">message</span> <span class="o">=</span> <span class="n">my_diff_build</span><span class="o">.</span><span class="n">get_message</span><span class="p">()</span>
            <span class="n">edmCore</span><span class="o">.</span><span class="n">gapps_session</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">input_topic</span><span class="p">,</span> <span class="n">message</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_unified_input_request</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>


<span class="k">class</span> <span class="nc">GOTopologyProcessor</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    &#39;Topology&#39; refers to where things are on the grid in relation to one another. In its simplest form, topology can</span>
<span class="sd">    refer to what bus each DER-EM is on. However, GOs and GSPs may view topology in more complex forms, combining</span>
<span class="sd">    buses into branches, groups, etc. More complex topologies are stored in xml files and read into the MC by this</span>
<span class="sd">    class; the XLM contains each &quot;group&quot; and whatever buses are members of it. This class will then be able to</span>

<span class="sd">    Topological processing is not required in the early stages of testing, so this class has not been fully implemented</span>
<span class="sd">    and many of its functions are currently unused.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">topology_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bus_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">group_list</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">import_topology_from_file</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reads the topology xml file. This needs to be generated prior to the simulation and will be used by both the</span>
<span class="sd">        ME and the DERMS in use (ex. the GSP).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">tree</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="s1">&#39;Configuration/topology.xml&#39;</span><span class="p">)</span>
        <span class="n">root</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">getroot</span><span class="p">()</span>
        <span class="n">topology_map</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">root</span><span class="p">):</span>
            <span class="n">topological_input_row_key</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">root</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">topological_input_row_vals</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">root</span><span class="p">[</span><span class="n">i</span><span class="p">]):</span>
                <span class="n">topological_input_row_vals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">root</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">a</span><span class="p">]</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>
            <span class="n">topology_map_row</span> <span class="o">=</span> <span class="p">{</span><span class="n">topological_input_row_key</span><span class="p">:</span> <span class="n">topological_input_row_vals</span><span class="p">}</span>
            <span class="n">topology_map</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">topology_map_row</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">topology_dict</span> <span class="o">=</span> <span class="n">topology_map</span>
        <span class="n">group_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">bus_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">topology_map</span><span class="p">:</span>
            <span class="n">group_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">bus_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">group_list</span> <span class="o">=</span> <span class="n">group_list</span>
        <span class="k">for</span> <span class="n">flatten_count</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">):</span>
            <span class="n">bus_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">bus_list</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">item</span><span class="p">]</span>
        <span class="n">bus_list_final</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="p">[</span><span class="n">bus_list_final</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">bus_list</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">bus_list_final</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bus_list</span> <span class="o">=</span> <span class="n">bus_list</span>

    <span class="k">def</span> <span class="nf">reverse_topology_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Not implemented.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">get_group_members</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">group_input</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Unused. Returns all buses contained in a given group.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">topology_dict</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">bus_return</span> <span class="o">=</span> <span class="n">i</span><span class="p">[</span><span class="n">group_input</span><span class="p">]</span>
                <span class="n">bus_return</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">bus_return</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">item</span><span class="p">]</span>
                <span class="c1"># print(bus_return)</span>
                <span class="k">return</span> <span class="n">bus_return</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">get_groups_bus_is_in</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Not implemented. Returns all groups a given bus is a member of.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span>


<span class="k">class</span> <span class="nc">GOSensor</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This class retrieves fully formatted grid states from the measurement processor, filters them down to necessary</span>
<span class="sd">    information, and makes determinations (automatically or manually) about grid services, whether they&#39;re required,</span>
<span class="sd">    happening satisfactorily, etc. These determinations are sent to the output API to be communicated to the DERMS.</span>

<span class="sd">    ATTRIBUTES:</span>
<span class="sd">        .current_sensor_states: Grid states read into the sensor. Automatic mode only. Not currently implemented.</span>

<span class="sd">        .service_request_decision: Determination whether a grid service is needed. Automatic mode. Not implemented.</span>

<span class="sd">        .posted_service_list: List of posted service objects. Used by both Automatic and Manual modes.</span>

<span class="sd">        .manual_service_xml_data: In Manual Mode, the data contained within the manual service xml file. To be parsed</span>
<span class="sd">            and posted service objects generated from this data.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_sensor_states</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">service_request_decision</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">posted_service_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">manual_service_xml_data</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="nf">update_sensor_states</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieves measurement data from the Measurement Processor. The measurements are organized by topological group.</span>
<span class="sd">        This is only used by AUTOMATIC MODE. Not currently implemented.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">make_service_request_decision</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Performs the following once per timestep.</span>

<span class="sd">        In MANUAL MODE (override is True):</span>
<span class="sd">            Instantiates a grid service</span>
<span class="sd">        In AUTOMATIC MODE (override is False):</span>
<span class="sd">            Will call code to make grid service determination. Currently not implemented.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">mcConfiguration</span><span class="o">.</span><span class="n">go_sensor_decision_making_manual_override</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">manually_post_service</span><span class="p">(</span><span class="n">edmTimekeeper</span><span class="o">.</span><span class="n">get_sim_current_time</span><span class="p">())</span>
        <span class="k">elif</span> <span class="n">mcConfiguration</span><span class="o">.</span><span class="n">go_sensor_decision_making_manual_override</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Service request failure. Wrong input.&quot;</span><span class="p">)</span>

        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">load_manual_service_file</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        MANUAL MODE: Reads the manually_posted_service_input.xml file during MC initialization and loads it into</span>
<span class="sd">        a dictionary for later use.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">input_file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">mcConfiguration</span><span class="o">.</span><span class="n">manual_service_filename</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">input_file</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="n">input_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">manual_service_xml_data</span> <span class="o">=</span> <span class="n">xmltodict</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">manually_post_service</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sim_time</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Called by make_service_request_decision() when in MANUAL mode. Reads the contents of the manual service</span>
<span class="sd">        dictionary, draws all relevant data points for each service, and instantiates a GOPostedService object for each</span>
<span class="sd">        one, appending the objects to a list.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">manual_service_xml_data</span><span class="p">[</span><span class="s1">&#39;services&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="s1">&#39;start_time&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="nb">int</span><span class="p">(</span><span class="n">sim_time</span><span class="p">):</span>
                <span class="n">name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
                <span class="n">group_id</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="s2">&quot;group_id&quot;</span><span class="p">]</span>
                <span class="n">service_type</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="s2">&quot;service_type&quot;</span><span class="p">]</span>
                <span class="n">interval_duration</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="s2">&quot;interval_duration&quot;</span><span class="p">]</span>
                <span class="n">interval_start</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="s2">&quot;interval_start&quot;</span><span class="p">]</span>
                <span class="n">power</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="s2">&quot;power&quot;</span><span class="p">]</span>
                <span class="n">ramp</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="s2">&quot;ramp&quot;</span><span class="p">]</span>
                <span class="n">price</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="s2">&quot;price&quot;</span><span class="p">]</span>
                <span class="n">start_time</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="s2">&quot;start_time&quot;</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">posted_service_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">GOPostedService</span><span class="p">(</span>
                    <span class="n">name</span><span class="p">,</span> <span class="n">group_id</span><span class="p">,</span> <span class="n">service_type</span><span class="p">,</span> <span class="n">interval_start</span><span class="p">,</span> <span class="n">interval_duration</span><span class="p">,</span> <span class="n">power</span><span class="p">,</span> <span class="n">ramp</span><span class="p">,</span> <span class="n">price</span><span class="p">))</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Manually posting service, name:&quot;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">GOOutputInterface</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    API between the MC and a DERMS. Must be customized to the needs of the DERMS. Converts determinations and feedback</span>
<span class="sd">    data to message formats the DERMS requires/can use, and delivers them.</span>

<span class="sd">    ATTRIBUTES:</span>
<span class="sd">        .current_service_requests: A list of posted services. These are the services that are being requested, or are</span>
<span class="sd">            currently being executed. Can come from either Automatic or Manual Decision making. See GOPostedService.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">current_service_requests</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">get_all_posted_service_requests</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieves the service message data from each posted service (see the GOPostedService.get_service_message_data()</span>
<span class="sd">        method for more detail). Appends the data in the proper list-of-dict format to current_service_requests.</span>

<span class="sd">        Note: In the current implementation, it may seem redundant to read data from an xml file into dictionaries,</span>
<span class="sd">        package the data into object, and extract the data back into identical dictionaries; however, this is important</span>
<span class="sd">        to ensure that the process is decoupled. A different DERMS or even a more advanced ME-GSP API might not allow</span>
<span class="sd">        for such direct input formats.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">goSensor</span><span class="o">.</span><span class="n">posted_service_list</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">get_status</span><span class="p">()</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Posting...&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">current_service_requests</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">get_service_message_data</span><span class="p">())</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">get_service_message_data</span><span class="p">())</span>
                <span class="n">item</span><span class="o">.</span><span class="n">set_status</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;All already posted&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">generate_service_messages</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Converts the current_service_requests list of dicts into a proper xml format. Used by the xml writed in</span>
<span class="sd">        send_service_request_messages().</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">request_out_xml</span> <span class="o">=</span> <span class="n">dict2xml</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_service_requests</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Current Service Requests&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">request_out_xml</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">request_out_xml</span>

    <span class="k">def</span> <span class="nf">send_service_request_messages</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Writes the current service request messages to an xml file, which will be accessed by the GSP for its service</span>
<span class="sd">        provisioning functions.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">xmlfile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;Outputs To DERMS/OutputtoGSP.xml&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span>
        <span class="n">xmlfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">generate_service_messages</span><span class="p">())</span>
        <span class="n">xmlfile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>


<span class="k">class</span> <span class="nc">MCOutputLog</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generates .csv logs containing measurements from the measurement processor. Updates (writes a line) once per</span>
<span class="sd">    timestep.</span>

<span class="sd">    ATTRIBUTES:</span>
<span class="sd">        .csv_file: Contains the csv file object (see open_csv_file())</span>

<span class="sd">        .log_name: The log name, taken from MCConfiguration during initialization.</span>

<span class="sd">        .mrid_name_lookup_table: a table of mRIDs and their respective plain english names, used to create the log</span>
<span class="sd">            headers. Taken from edmCore.get_mrid_name_lookup_table().</span>

<span class="sd">        .header_mrids: a list of mRIDs for each measurement point, used (invisibly) in the header to write logs.</span>

<span class="sd">        .header_names: the plain english versions of the header names.</span>

<span class="sd">        .csv_dict_writer: The dictionary writer object, used to write the .csv logs.</span>

<span class="sd">        .timestamp_array: A list of all timestamps for the logs. Appended at the end of simulation.</span>

<span class="sd">        .current_measurement: The dictionary containing the current set of measurements.</span>

<span class="sd">        .is_first_measurement: Calls functions that should only run once at the start of logging (such as opening</span>
<span class="sd">           the log files, setting up the header, etc.)</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">csv_file</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log_name</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mrid_name_lookup_table</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">header_mrids</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">header_names</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">csv_dict_writer</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timestamp_array</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_measurement</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_first_measurement</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">update_logs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        During the first measurement, performs housekeeping tasks like opening the file, setting the name, translating</span>
<span class="sd">        the header to something readable, and writing the header. On all subsequent measurements, it writes a row of</span>
<span class="sd">        measurements to the logs and appends a new timestamp to the timestamp array.</span>

<span class="sd">        Note: The first timestep in the logs will be several seconds after the actual simulation start time.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_measurement</span> <span class="o">=</span> <span class="n">edmMeasurementProcessor</span><span class="o">.</span><span class="n">get_current_measurements</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_measurement</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Updating logs...&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_first_measurement</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;First measurement routines...&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">set_log_name</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">open_csv_file</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mrid_name_lookup_table</span> <span class="o">=</span> <span class="n">edmCore</span><span class="o">.</span><span class="n">get_mrid_name_lookup_table</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">translate_header_names</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">open_csv_dict_writer</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">write_header</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">is_first_measurement</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write_row</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">timestamp_array</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">edmTimekeeper</span><span class="o">.</span><span class="n">sim_current_time</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">open_csv_file</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Opens the .csv file.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Opening .csv file:&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">csv_file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">log_name</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">open_csv_dict_writer</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Opens the dict writer used to write rows. Note that the headers used are the measurement mRIDs; the plain</span>
<span class="sd">        English names are a visual effect only.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">csv_dict_writer</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">DictWriter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">csv_file</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">header_mrids</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">close_out_logs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Closes the log file and re-appends the timestamps.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">csv_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">append_timestamps</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">translate_header_names</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Looks up the plain english names for the headers and provides them to a dictionary for use by write_header().</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">header_mrids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_measurement</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">header_mrids</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">lookup_mrid</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">item</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mrid_name_lookup_table</span> <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;measid&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">i</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">StopIteration</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">lookup_mrid</span><span class="p">)</span>
            <span class="n">lookup_name</span> <span class="o">=</span> <span class="n">lookup_mrid</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">header_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lookup_name</span><span class="p">)</span>
            <span class="c1"># print(self.header_names)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">header_mrids</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">header_mrids</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">header_names</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">write_header</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Writes the log header.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">csv_dict_writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">header_mrids</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">write_row</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Writes a row of measurements to the logs.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">csv_dict_writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_measurement</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">set_log_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the log name based on the MCConfiguration settings.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log_name</span> <span class="o">=</span> <span class="n">mcConfiguration</span><span class="o">.</span><span class="n">output_log_name</span>

    <span class="k">def</span> <span class="nf">append_timestamps</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Uses the pandas library to append the timestamp column to the logs. This is the most convenient way to handle</span>
<span class="sd">        timekeeping while making sure to use the simulation time rather than the measurement time.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">csv_input</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">log_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timestamp_array</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timestamp_array</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;s&#39;</span><span class="p">)</span>
        <span class="n">csv_input</span><span class="p">[</span><span class="s1">&#39;Timestamp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">timestamp_array</span>
        <span class="n">move_column</span> <span class="o">=</span> <span class="n">csv_input</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;Timestamp&#39;</span><span class="p">)</span>
        <span class="n">csv_input</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;Timestamp&#39;</span><span class="p">,</span> <span class="n">move_column</span><span class="p">)</span>
        <span class="n">csv_input</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">log_name</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">GOPostedService</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This class is (currently) the only class that can get instantiated more than once per simulation. It contains</span>
<span class="sd">    service request data required to communicate with the DERMS. This data informs the DERMS of the type,</span>
<span class="sd">    location, and parameters of a single service it wants to request from the DERMS. These service requests are then</span>
<span class="sd">    &#39;posted&#39; to a list in the GOSensor class, which is read by the GOOutputInterface class and processed into the</span>
<span class="sd">    communication format or protocol necessary for GO-DERMS communications (currently, an xml text file stored in the</span>
<span class="sd">    /Outputs to DERMS/ folder.)</span>

<span class="sd">    The attributes and accessor methods are mostly self-explanatory; the major points of interest are the fact that it</span>
<span class="sd">    stores whatever data is needed by the DERMS, and that there is a function that returns this data in dictionary</span>
<span class="sd">    format.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">service_name</span><span class="o">=</span><span class="s2">&quot;Undefined&quot;</span><span class="p">,</span> <span class="n">group_id</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">service_type</span><span class="o">=</span><span class="s2">&quot;Undefined&quot;</span><span class="p">,</span> <span class="n">interval_start</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                 <span class="n">interval_duration</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">power</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ramp</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">price</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">service_name</span> <span class="o">=</span> <span class="n">service_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">group_id</span> <span class="o">=</span> <span class="n">group_id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">service_type</span> <span class="o">=</span> <span class="n">service_type</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">interval_start</span> <span class="o">=</span> <span class="n">interval_start</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">interval_duration</span> <span class="o">=</span> <span class="n">interval_duration</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">power</span> <span class="o">=</span> <span class="n">power</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ramp</span> <span class="o">=</span> <span class="n">ramp</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">price</span> <span class="o">=</span> <span class="n">price</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">get_service_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">service_name</span>

    <span class="k">def</span> <span class="nf">get_group_id</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">group_id</span>

    <span class="k">def</span> <span class="nf">get_service_type</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">service_type</span>

    <span class="k">def</span> <span class="nf">get_interval_start</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">interval_start</span>

    <span class="k">def</span> <span class="nf">get_interval_duration</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">interval_duration</span>

    <span class="k">def</span> <span class="nf">get_power</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">power</span>

    <span class="k">def</span> <span class="nf">get_price</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">price</span>

    <span class="k">def</span> <span class="nf">get_status</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span>

    <span class="k">def</span> <span class="nf">set_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_status</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">new_status</span>

    <span class="k">def</span> <span class="nf">get_service_message_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the attribute names and values in dictionary form for use by the message wrapper (GOOutputInterface).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">service_message_data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;service_name&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">service_name</span><span class="p">,</span>
            <span class="s2">&quot;group_id&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">group_id</span><span class="p">,</span>
            <span class="s2">&quot;service_type&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">service_type</span><span class="p">,</span>
            <span class="s2">&quot;interval_start&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">interval_start</span><span class="p">,</span>
            <span class="s2">&quot;interval_duration&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">interval_duration</span><span class="p">,</span>
            <span class="s2">&quot;power&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">power</span><span class="p">,</span>
            <span class="s2">&quot;ramp&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">ramp</span><span class="p">,</span>
            <span class="s2">&quot;price&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">price</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">service_message_data</span>

<span class="c1"># ------------------------------------------------Function Definitions------------------------------------------------</span>


<span class="k">def</span> <span class="nf">instantiate_callback_classes</span><span class="p">(</span><span class="n">simulation_id</span><span class="p">,</span> <span class="n">gapps_object</span><span class="p">,</span> <span class="n">edmCore</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Instantiates the callback classes.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">global</span> <span class="n">edmMeasurementProcessor</span>
    <span class="n">edmMeasurementProcessor</span> <span class="o">=</span> <span class="n">EDMMeasurementProcessor</span><span class="p">()</span>
    <span class="n">edmCore</span><span class="o">.</span><span class="n">gapps_session</span><span class="o">.</span><span class="n">subscribe</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">simulation_output_topic</span><span class="p">(</span><span class="n">edmCore</span><span class="o">.</span><span class="n">sim_mrid</span><span class="p">),</span> <span class="n">edmMeasurementProcessor</span><span class="p">)</span>
    <span class="k">global</span> <span class="n">edmTimekeeper</span>
    <span class="n">edmTimekeeper</span> <span class="o">=</span> <span class="n">EDMTimeKeeper</span><span class="p">(</span><span class="n">edmCore</span><span class="p">)</span>
    <span class="n">edmCore</span><span class="o">.</span><span class="n">gapps_session</span><span class="o">.</span><span class="n">subscribe</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">simulation_log_topic</span><span class="p">(</span><span class="n">edmCore</span><span class="o">.</span><span class="n">sim_mrid</span><span class="p">),</span> <span class="n">edmTimekeeper</span><span class="p">)</span>


<span class="c1"># ------------------------------------------Program Execution (Main loop)------------------------------------------</span>
<span class="k">def</span> <span class="nf">_main</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Main operating loop. Instantiates the core, runs the startup process, gets the sim mrid, instantiates the callback</span>
<span class="sd">    classes, and starts running the simulation. All ongoing processes are handled (and called) by the callback objects.</span>
<span class="sd">    Otherwise, sleeps until the end_program flag is thrown.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">global</span> <span class="n">mcConfiguration</span>
    <span class="n">mcConfiguration</span> <span class="o">=</span> <span class="n">MCConfiguration</span><span class="p">()</span>
    <span class="k">global</span> <span class="n">edmCore</span>
    <span class="n">edmCore</span> <span class="o">=</span> <span class="n">EDMCore</span><span class="p">()</span>  <span class="c1"># EDMCore must be manually instantiated.</span>
    <span class="n">edmCore</span><span class="o">.</span><span class="n">sim_start_up_process</span><span class="p">()</span>
    <span class="n">edmCore</span><span class="o">.</span><span class="n">start_simulation</span><span class="p">()</span>
    <span class="n">edmCore</span><span class="o">.</span><span class="n">initialize_sim_mrid</span><span class="p">()</span>
    <span class="n">instantiate_callback_classes</span><span class="p">(</span><span class="n">edmCore</span><span class="o">.</span><span class="n">sim_mrid</span><span class="p">,</span> <span class="n">edmCore</span><span class="o">.</span><span class="n">gapps_session</span><span class="p">,</span> <span class="n">edmCore</span><span class="p">)</span>

    <span class="k">global</span> <span class="n">end_program</span>
    <span class="k">while</span> <span class="ow">not</span> <span class="n">end_program</span><span class="p">:</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">end_program</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Ending program.&#39;</span><span class="p">)</span>
        <span class="n">quit</span><span class="p">()</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">_main</span><span class="p">()</span>
</pre></div>

        </details>

            </section>
                <section id="MCConfiguration">
                                <div class="attr class">
        <a class="headerlink" href="#MCConfiguration">#&nbsp;&nbsp</a>

        
        <span class="def">class</span>
        <span class="name">MCConfiguration</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">MCConfiguration</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Provides user configurability of the MC when appropriate. Not to be confused with the GridAPPS-D configuration</span>
<span class="sd">    process, this provides global configuration for the MC as a whole. DER-S configuration should be handled within</span>
<span class="sd">    the DER-S Class definition, and not here.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        ATTRIBUTES:</span>

<span class="sd">            .mc_file_directory: The root folder where the ME is located.</span>

<span class="sd">            .config_file_path: The text file containing the GridAPPS-D configuration info.</span>

<span class="sd">            .ders_obj_list: A dictionary containing the DER-S classes and objects *that will be used in the current</span>
<span class="sd">                simulation*. Add or comment out as appropriate for new DER-Ss or for different tests.</span>

<span class="sd">            .go_sensor_decision_making_manual_override: Set to True to use manual GOSensor decision making (That is,</span>
<span class="sd">                grid services are called by a text file rather than based on grid conditions.</span>
<span class="sd">                NOTE: Automatic mode is not currently implemented, so this should ALWAYS be set to True.</span>

<span class="sd">            .manual_service_filename: the .xml filename of the GOSensor manual service input file. Should be in MC root.</span>

<span class="sd">            .output_log_name: The name and location of the output logs. Rename before simulation with date/time, for example.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mc_file_directory</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;C:/Users/stant/PycharmProjects/doe-egot-me/&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config_file_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mc_file_directory</span> <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot;Configuration/Config.txt&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ders_obj_list</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;DERSHistoricalDataInput&#39;</span><span class="p">:</span> <span class="s1">&#39;dersHistoricalDataInput&#39;</span><span class="p">,</span>
            <span class="s1">&#39;RWHDERS&#39;</span><span class="p">:</span> <span class="s1">&#39;rwhDERS&#39;</span>
            <span class="c1"># ,</span>
            <span class="c1"># &#39;EXAMPLEDERClassName&#39;: &#39;exampleDERObjectName&#39;</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">go_sensor_decision_making_manual_override</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">manual_service_filename</span> <span class="o">=</span> <span class="s2">&quot;manually_posted_service_input.xml&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output_log_name</span> <span class="o">=</span> <span class="s1">&#39;Logged Grid State Data/MeasOutputLogs.csv&#39;</span>
</pre></div>

        </details>

            <div class="docstring"><p>Provides user configurability of the MC when appropriate. Not to be confused with the GridAPPS-D configuration
process, this provides global configuration for the MC as a whole. DER-S configuration should be handled within
the DER-S Class definition, and not here.</p>
</div>


                            <div id="MCConfiguration.__init__" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#MCConfiguration.__init__">#&nbsp;&nbsp</a>

        
            <span class="name">MCConfiguration</span><span class="signature">()</span>
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        ATTRIBUTES:</span>

<span class="sd">            .mc_file_directory: The root folder where the ME is located.</span>

<span class="sd">            .config_file_path: The text file containing the GridAPPS-D configuration info.</span>

<span class="sd">            .ders_obj_list: A dictionary containing the DER-S classes and objects *that will be used in the current</span>
<span class="sd">                simulation*. Add or comment out as appropriate for new DER-Ss or for different tests.</span>

<span class="sd">            .go_sensor_decision_making_manual_override: Set to True to use manual GOSensor decision making (That is,</span>
<span class="sd">                grid services are called by a text file rather than based on grid conditions.</span>
<span class="sd">                NOTE: Automatic mode is not currently implemented, so this should ALWAYS be set to True.</span>

<span class="sd">            .manual_service_filename: the .xml filename of the GOSensor manual service input file. Should be in MC root.</span>

<span class="sd">            .output_log_name: The name and location of the output logs. Rename before simulation with date/time, for example.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mc_file_directory</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;C:/Users/stant/PycharmProjects/doe-egot-me/&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config_file_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mc_file_directory</span> <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot;Configuration/Config.txt&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ders_obj_list</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;DERSHistoricalDataInput&#39;</span><span class="p">:</span> <span class="s1">&#39;dersHistoricalDataInput&#39;</span><span class="p">,</span>
            <span class="s1">&#39;RWHDERS&#39;</span><span class="p">:</span> <span class="s1">&#39;rwhDERS&#39;</span>
            <span class="c1"># ,</span>
            <span class="c1"># &#39;EXAMPLEDERClassName&#39;: &#39;exampleDERObjectName&#39;</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">go_sensor_decision_making_manual_override</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">manual_service_filename</span> <span class="o">=</span> <span class="s2">&quot;manually_posted_service_input.xml&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output_log_name</span> <span class="o">=</span> <span class="s1">&#39;Logged Grid State Data/MeasOutputLogs.csv&#39;</span>
</pre></div>

        </details>

            <div class="docstring"><p>ATTRIBUTES:</p>

<pre><code>.mc_file_directory: The root folder where the ME is located.

.config_file_path: The text file containing the GridAPPS-D configuration info.

.ders_obj_list: A dictionary containing the DER-S classes and objects *that will be used in the current
    simulation*. Add or comment out as appropriate for new DER-Ss or for different tests.

.go_sensor_decision_making_manual_override: Set to True to use manual GOSensor decision making (That is,
    grid services are called by a text file rather than based on grid conditions.
    NOTE: Automatic mode is not currently implemented, so this should ALWAYS be set to True.

.manual_service_filename: the .xml filename of the GOSensor manual service input file. Should be in MC root.

.output_log_name: The name and location of the output logs. Rename before simulation with date/time, for example.
</code></pre>
</div>


                            </div>
                </section>
                <section id="EDMCore">
                                <div class="attr class">
        <a class="headerlink" href="#EDMCore">#&nbsp;&nbsp</a>

        
        <span class="def">class</span>
        <span class="name">EDMCore</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">EDMCore</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Provides central, core functionality to the MC. Responsible for the startup process and storing the GridAPPS-D</span>
<span class="sd">    connection and simulation mRIDs and objects.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gapps_session</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sim_session</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sim_start_time</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sim_current_time</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sim_mrid</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">line_mrid</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config_parameters</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mrid_name_lookup_table</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cim_measurement_dict</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">get_sim_start_time</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        ACCESSOR METHOD: returns the simulation start time (per the configuration file, not realtime)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim_start_time</span>

    <span class="k">def</span> <span class="nf">get_line_mrid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        ACCESSOR METHOD: Returns the mRID for the current model (I.E. the IEEE 13-node test feeder).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">line_mrid</span>

    <span class="k">def</span> <span class="nf">sim_start_up_process</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        ENCAPSULATION METHOD: calls all methods required to set up the simulation process. Does not start the simulation</span>
<span class="sd">        itself, but performs the &quot;startup checklist&quot;. This includes connecting to GridAPPS-D and the simulation, loading</span>
<span class="sd">        configuration from the file, instantiating all the (non-callback) objects, initializing DER-Ss, assigning</span>
<span class="sd">        DER-EMs and creating the association table, and connecting to the aggregator among others. See each method&#39;s</span>
<span class="sd">        docstring for more details.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect_to_gridapps</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_config_from_file</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initialize_line_mrid</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">establish_mrid_name_lookup_table</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect_to_simulation</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initialize_sim_start_time</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initialize_sim_mrid</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">create_objects</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initialize_all_der_s</span><span class="p">()</span>
        <span class="n">derAssignmentHandler</span><span class="o">.</span><span class="n">create_assignment_lookup_table</span><span class="p">()</span>
        <span class="n">derAssignmentHandler</span><span class="o">.</span><span class="n">assign_all_ders</span><span class="p">()</span>
        <span class="n">derIdentificationManager</span><span class="o">.</span><span class="n">initialize_association_lookup_table</span><span class="p">()</span>
        <span class="n">mcOutputLog</span><span class="o">.</span><span class="n">set_log_name</span><span class="p">()</span>
        <span class="n">goSensor</span><span class="o">.</span><span class="n">load_manual_service_file</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">load_config_from_file</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Loads the GridAPPS-D configuration string from a file and places the parameters in a variable for later use.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">mcConfiguration</span><span class="o">.</span><span class="n">config_file_path</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">config_string</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">config_parameters</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">literal_eval</span><span class="p">(</span><span class="n">config_string</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">connect_to_gridapps</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Connects to GridAPPS-D and creates the gridapps session object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gapps_session</span> <span class="o">=</span> <span class="n">GridAPPSD</span><span class="p">(</span><span class="s2">&quot;(&#39;localhost&#39;, 61613)&quot;</span><span class="p">,</span> <span class="n">username</span><span class="o">=</span><span class="s1">&#39;system&#39;</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s1">&#39;manager&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">initialize_sim_mrid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieves the simulation mRID from the simulation object. The mRID is used to connect to messaging topics,</span>
<span class="sd">        while the object contains methods to, for example, start the simulation.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sim_mrid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim_session</span><span class="o">.</span><span class="n">simulation_id</span>
        <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sim_mrid</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">initialize_line_mrid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieves the model mRID from the config parameters.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">line_mrid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config_parameters</span><span class="p">[</span><span class="s2">&quot;power_system_config&quot;</span><span class="p">][</span><span class="s2">&quot;Line_name&quot;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">initialize_sim_start_time</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieves the simulation start timestamp from the config parameters. Note: this is a setting, not the real</span>
<span class="sd">        current time.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sim_start_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config_parameters</span><span class="p">[</span><span class="s2">&quot;simulation_config&quot;</span><span class="p">][</span><span class="s2">&quot;start_time&quot;</span><span class="p">]</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Simulation start time is:&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sim_start_time</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">connect_to_simulation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Connects to the GridAPPS-D simulation (as opposed to the GridAPPS-D program) and creates the simulation object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sim_session</span> <span class="o">=</span> <span class="n">Simulation</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gapps_session</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config_parameters</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">create_objects</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Instantiates all non-callback classes. All objects are global to simplify arguments and facilitate decoupling.</span>
<span class="sd">        (Note: EDMCore is manually instantiated first, in the main loop function. This is part of the startup process.</span>
<span class="sd">        The callback classes need to be instantiated separately to ensure the callback methods work properly.)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">global</span> <span class="n">mcOutputLog</span>
        <span class="n">mcOutputLog</span> <span class="o">=</span> <span class="n">MCOutputLog</span><span class="p">()</span>
        <span class="k">global</span> <span class="n">mcInputInterface</span>
        <span class="n">mcInputInterface</span> <span class="o">=</span> <span class="n">MCInputInterface</span><span class="p">()</span>
        <span class="k">global</span> <span class="n">dersHistoricalDataInput</span>
        <span class="n">dersHistoricalDataInput</span> <span class="o">=</span> <span class="n">DERSHistoricalDataInput</span><span class="p">(</span><span class="n">mcConfiguration</span><span class="p">)</span>
        <span class="k">global</span> <span class="n">rwhDERS</span>
        <span class="n">rwhDERS</span> <span class="o">=</span> <span class="n">RWHDERS</span><span class="p">(</span><span class="n">mcConfiguration</span><span class="p">)</span>
        <span class="k">global</span> <span class="n">derAssignmentHandler</span>
        <span class="n">derAssignmentHandler</span> <span class="o">=</span> <span class="n">DERAssignmentHandler</span><span class="p">()</span>
        <span class="k">global</span> <span class="n">derIdentificationManager</span>
        <span class="n">derIdentificationManager</span> <span class="o">=</span> <span class="n">DERIdentificationManager</span><span class="p">()</span>
        <span class="k">global</span> <span class="n">goSensor</span>
        <span class="n">goSensor</span> <span class="o">=</span> <span class="n">GOSensor</span><span class="p">()</span>
        <span class="k">global</span> <span class="n">goOutputInterface</span>
        <span class="n">goOutputInterface</span> <span class="o">=</span> <span class="n">GOOutputInterface</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">initialize_all_der_s</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calls the initialize_der_s() method for each DER-S listed in mcConfiguration.ders_obj_list.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">mcConfiguration</span><span class="o">.</span><span class="n">ders_obj_list</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="nb">eval</span><span class="p">(</span><span class="n">value</span><span class="p">)</span><span class="o">.</span><span class="n">initialize_der_s</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">start_simulation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Performs one final initialization of the simulation start time (fixes a bug related to our use of the logging</span>
<span class="sd">        API tricking the timekeeper into thinking it&#39;s later than it is) and calls the method to start the actual</span>
<span class="sd">        simulation.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initialize_sim_start_time</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sim_session</span><span class="o">.</span><span class="n">start_simulation</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">establish_mrid_name_lookup_table</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This currently creates two lookup dictionaries. mrid_name_lookup_table gets the real names of measurements for</span>
<span class="sd">        the measurement processor/logger. cim_measurement_dict gives a more fully fleshed out dictionary containing</span>
<span class="sd">        several parameters related to measurements that are appended to the measurement processor&#39;s current readings.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">topic</span> <span class="o">=</span> <span class="s2">&quot;goss.gridappsd.process.request.data.powergridmodel&quot;</span>
        <span class="n">message</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;modelId&quot;</span><span class="p">:</span> <span class="n">edmCore</span><span class="o">.</span><span class="n">get_line_mrid</span><span class="p">(),</span>
            <span class="s2">&quot;requestType&quot;</span><span class="p">:</span> <span class="s2">&quot;QUERY_OBJECT_MEASUREMENTS&quot;</span><span class="p">,</span>
            <span class="s2">&quot;resultFormat&quot;</span><span class="p">:</span> <span class="s2">&quot;JSON&quot;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">object_meas</span> <span class="o">=</span> <span class="n">edmCore</span><span class="o">.</span><span class="n">gapps_session</span><span class="o">.</span><span class="n">get_response</span><span class="p">(</span><span class="n">topic</span><span class="p">,</span> <span class="n">message</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mrid_name_lookup_table</span> <span class="o">=</span> <span class="n">object_meas</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span>

        <span class="n">config_api_topic</span> <span class="o">=</span> <span class="s1">&#39;goss.gridappsd.process.request.config&#39;</span>
        <span class="n">message</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;configurationType&#39;</span><span class="p">:</span> <span class="s1">&#39;CIM Dictionary&#39;</span><span class="p">,</span>
            <span class="s1">&#39;parameters&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;model_id&#39;</span><span class="p">:</span> <span class="n">edmCore</span><span class="o">.</span><span class="n">line_mrid</span><span class="p">}</span>
        <span class="p">}</span>
        <span class="n">cim_dict</span> <span class="o">=</span> <span class="n">edmCore</span><span class="o">.</span><span class="n">gapps_session</span><span class="o">.</span><span class="n">get_response</span><span class="p">(</span><span class="n">config_api_topic</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
        <span class="n">measdict</span> <span class="o">=</span> <span class="n">cim_dict</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;feeders&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;measurements&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cim_measurement_dict</span> <span class="o">=</span> <span class="n">measdict</span>

    <span class="k">def</span> <span class="nf">get_mrid_name_lookup_table</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        ACCESSOR METHOD: Returns the mrid_name_lookup_table.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">mrid_name_lookup_table</span>

    <span class="k">def</span> <span class="nf">get_cim_measurement_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        ACCESSOR METHOD: Returns the cim_measurement.dict.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cim_measurement_dict</span>
</pre></div>

        </details>

            <div class="docstring"><p>Provides central, core functionality to the MC. Responsible for the startup process and storing the GridAPPS-D
connection and simulation mRIDs and objects.</p>
</div>


                            <div id="EDMCore.__init__" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#EDMCore.__init__">#&nbsp;&nbsp</a>

        
            <span class="name">EDMCore</span><span class="signature">()</span>
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gapps_session</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sim_session</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sim_start_time</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sim_current_time</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sim_mrid</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">line_mrid</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config_parameters</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mrid_name_lookup_table</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cim_measurement_dict</span> <span class="o">=</span> <span class="p">[]</span>
</pre></div>

        </details>

    

                            </div>
                            <div id="EDMCore.get_sim_start_time" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#EDMCore.get_sim_start_time">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">get_sim_start_time</span><span class="signature">(self)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">get_sim_start_time</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        ACCESSOR METHOD: returns the simulation start time (per the configuration file, not realtime)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim_start_time</span>
</pre></div>

        </details>

            <div class="docstring"><p>ACCESSOR METHOD: returns the simulation start time (per the configuration file, not realtime)</p>
</div>


                            </div>
                            <div id="EDMCore.get_line_mrid" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#EDMCore.get_line_mrid">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">get_line_mrid</span><span class="signature">(self)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">get_line_mrid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        ACCESSOR METHOD: Returns the mRID for the current model (I.E. the IEEE 13-node test feeder).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">line_mrid</span>
</pre></div>

        </details>

            <div class="docstring"><p>ACCESSOR METHOD: Returns the mRID for the current model (I.E. the IEEE 13-node test feeder).</p>
</div>


                            </div>
                            <div id="EDMCore.sim_start_up_process" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#EDMCore.sim_start_up_process">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">sim_start_up_process</span><span class="signature">(self)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">sim_start_up_process</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        ENCAPSULATION METHOD: calls all methods required to set up the simulation process. Does not start the simulation</span>
<span class="sd">        itself, but performs the &quot;startup checklist&quot;. This includes connecting to GridAPPS-D and the simulation, loading</span>
<span class="sd">        configuration from the file, instantiating all the (non-callback) objects, initializing DER-Ss, assigning</span>
<span class="sd">        DER-EMs and creating the association table, and connecting to the aggregator among others. See each method&#39;s</span>
<span class="sd">        docstring for more details.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect_to_gridapps</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_config_from_file</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initialize_line_mrid</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">establish_mrid_name_lookup_table</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect_to_simulation</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initialize_sim_start_time</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initialize_sim_mrid</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">create_objects</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initialize_all_der_s</span><span class="p">()</span>
        <span class="n">derAssignmentHandler</span><span class="o">.</span><span class="n">create_assignment_lookup_table</span><span class="p">()</span>
        <span class="n">derAssignmentHandler</span><span class="o">.</span><span class="n">assign_all_ders</span><span class="p">()</span>
        <span class="n">derIdentificationManager</span><span class="o">.</span><span class="n">initialize_association_lookup_table</span><span class="p">()</span>
        <span class="n">mcOutputLog</span><span class="o">.</span><span class="n">set_log_name</span><span class="p">()</span>
        <span class="n">goSensor</span><span class="o">.</span><span class="n">load_manual_service_file</span><span class="p">()</span>
</pre></div>

        </details>

            <div class="docstring"><p>ENCAPSULATION METHOD: calls all methods required to set up the simulation process. Does not start the simulation
itself, but performs the "startup checklist". This includes connecting to GridAPPS-D and the simulation, loading
configuration from the file, instantiating all the (non-callback) objects, initializing DER-Ss, assigning
DER-EMs and creating the association table, and connecting to the aggregator among others. See each method's
docstring for more details.</p>
</div>


                            </div>
                            <div id="EDMCore.load_config_from_file" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#EDMCore.load_config_from_file">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">load_config_from_file</span><span class="signature">(self)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">load_config_from_file</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Loads the GridAPPS-D configuration string from a file and places the parameters in a variable for later use.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">mcConfiguration</span><span class="o">.</span><span class="n">config_file_path</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">config_string</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">config_parameters</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">literal_eval</span><span class="p">(</span><span class="n">config_string</span><span class="p">)</span>
</pre></div>

        </details>

            <div class="docstring"><p>Loads the GridAPPS-D configuration string from a file and places the parameters in a variable for later use.</p>
</div>


                            </div>
                            <div id="EDMCore.connect_to_gridapps" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#EDMCore.connect_to_gridapps">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">connect_to_gridapps</span><span class="signature">(self)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">connect_to_gridapps</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Connects to GridAPPS-D and creates the gridapps session object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gapps_session</span> <span class="o">=</span> <span class="n">GridAPPSD</span><span class="p">(</span><span class="s2">&quot;(&#39;localhost&#39;, 61613)&quot;</span><span class="p">,</span> <span class="n">username</span><span class="o">=</span><span class="s1">&#39;system&#39;</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s1">&#39;manager&#39;</span><span class="p">)</span>
</pre></div>

        </details>

            <div class="docstring"><p>Connects to GridAPPS-D and creates the gridapps session object.</p>
</div>


                            </div>
                            <div id="EDMCore.initialize_sim_mrid" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#EDMCore.initialize_sim_mrid">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">initialize_sim_mrid</span><span class="signature">(self)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">initialize_sim_mrid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieves the simulation mRID from the simulation object. The mRID is used to connect to messaging topics,</span>
<span class="sd">        while the object contains methods to, for example, start the simulation.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sim_mrid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim_session</span><span class="o">.</span><span class="n">simulation_id</span>
        <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sim_mrid</span><span class="p">)</span>
</pre></div>

        </details>

            <div class="docstring"><p>Retrieves the simulation mRID from the simulation object. The mRID is used to connect to messaging topics,
while the object contains methods to, for example, start the simulation.</p>
</div>


                            </div>
                            <div id="EDMCore.initialize_line_mrid" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#EDMCore.initialize_line_mrid">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">initialize_line_mrid</span><span class="signature">(self)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">initialize_line_mrid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieves the model mRID from the config parameters.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">line_mrid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config_parameters</span><span class="p">[</span><span class="s2">&quot;power_system_config&quot;</span><span class="p">][</span><span class="s2">&quot;Line_name&quot;</span><span class="p">]</span>
</pre></div>

        </details>

            <div class="docstring"><p>Retrieves the model mRID from the config parameters.</p>
</div>


                            </div>
                            <div id="EDMCore.initialize_sim_start_time" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#EDMCore.initialize_sim_start_time">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">initialize_sim_start_time</span><span class="signature">(self)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">initialize_sim_start_time</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieves the simulation start timestamp from the config parameters. Note: this is a setting, not the real</span>
<span class="sd">        current time.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sim_start_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config_parameters</span><span class="p">[</span><span class="s2">&quot;simulation_config&quot;</span><span class="p">][</span><span class="s2">&quot;start_time&quot;</span><span class="p">]</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Simulation start time is:&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sim_start_time</span><span class="p">)</span>
</pre></div>

        </details>

            <div class="docstring"><p>Retrieves the simulation start timestamp from the config parameters. Note: this is a setting, not the real
current time.</p>
</div>


                            </div>
                            <div id="EDMCore.connect_to_simulation" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#EDMCore.connect_to_simulation">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">connect_to_simulation</span><span class="signature">(self)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">connect_to_simulation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Connects to the GridAPPS-D simulation (as opposed to the GridAPPS-D program) and creates the simulation object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sim_session</span> <span class="o">=</span> <span class="n">Simulation</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gapps_session</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config_parameters</span><span class="p">)</span>
</pre></div>

        </details>

            <div class="docstring"><p>Connects to the GridAPPS-D simulation (as opposed to the GridAPPS-D program) and creates the simulation object.</p>
</div>


                            </div>
                            <div id="EDMCore.create_objects" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#EDMCore.create_objects">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">create_objects</span><span class="signature">(self)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">create_objects</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Instantiates all non-callback classes. All objects are global to simplify arguments and facilitate decoupling.</span>
<span class="sd">        (Note: EDMCore is manually instantiated first, in the main loop function. This is part of the startup process.</span>
<span class="sd">        The callback classes need to be instantiated separately to ensure the callback methods work properly.)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">global</span> <span class="n">mcOutputLog</span>
        <span class="n">mcOutputLog</span> <span class="o">=</span> <span class="n">MCOutputLog</span><span class="p">()</span>
        <span class="k">global</span> <span class="n">mcInputInterface</span>
        <span class="n">mcInputInterface</span> <span class="o">=</span> <span class="n">MCInputInterface</span><span class="p">()</span>
        <span class="k">global</span> <span class="n">dersHistoricalDataInput</span>
        <span class="n">dersHistoricalDataInput</span> <span class="o">=</span> <span class="n">DERSHistoricalDataInput</span><span class="p">(</span><span class="n">mcConfiguration</span><span class="p">)</span>
        <span class="k">global</span> <span class="n">rwhDERS</span>
        <span class="n">rwhDERS</span> <span class="o">=</span> <span class="n">RWHDERS</span><span class="p">(</span><span class="n">mcConfiguration</span><span class="p">)</span>
        <span class="k">global</span> <span class="n">derAssignmentHandler</span>
        <span class="n">derAssignmentHandler</span> <span class="o">=</span> <span class="n">DERAssignmentHandler</span><span class="p">()</span>
        <span class="k">global</span> <span class="n">derIdentificationManager</span>
        <span class="n">derIdentificationManager</span> <span class="o">=</span> <span class="n">DERIdentificationManager</span><span class="p">()</span>
        <span class="k">global</span> <span class="n">goSensor</span>
        <span class="n">goSensor</span> <span class="o">=</span> <span class="n">GOSensor</span><span class="p">()</span>
        <span class="k">global</span> <span class="n">goOutputInterface</span>
        <span class="n">goOutputInterface</span> <span class="o">=</span> <span class="n">GOOutputInterface</span><span class="p">()</span>
</pre></div>

        </details>

            <div class="docstring"><p>Instantiates all non-callback classes. All objects are global to simplify arguments and facilitate decoupling.
(Note: EDMCore is manually instantiated first, in the main loop function. This is part of the startup process.
The callback classes need to be instantiated separately to ensure the callback methods work properly.)</p>
</div>


                            </div>
                            <div id="EDMCore.initialize_all_der_s" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#EDMCore.initialize_all_der_s">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">initialize_all_der_s</span><span class="signature">(self)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">initialize_all_der_s</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calls the initialize_der_s() method for each DER-S listed in mcConfiguration.ders_obj_list.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">mcConfiguration</span><span class="o">.</span><span class="n">ders_obj_list</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="nb">eval</span><span class="p">(</span><span class="n">value</span><span class="p">)</span><span class="o">.</span><span class="n">initialize_der_s</span><span class="p">()</span>
</pre></div>

        </details>

            <div class="docstring"><p>Calls the initialize_der_s() method for each DER-S listed in mcConfiguration.ders_obj_list.</p>
</div>


                            </div>
                            <div id="EDMCore.start_simulation" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#EDMCore.start_simulation">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">start_simulation</span><span class="signature">(self)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">start_simulation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Performs one final initialization of the simulation start time (fixes a bug related to our use of the logging</span>
<span class="sd">        API tricking the timekeeper into thinking it&#39;s later than it is) and calls the method to start the actual</span>
<span class="sd">        simulation.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initialize_sim_start_time</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sim_session</span><span class="o">.</span><span class="n">start_simulation</span><span class="p">()</span>
</pre></div>

        </details>

            <div class="docstring"><p>Performs one final initialization of the simulation start time (fixes a bug related to our use of the logging
API tricking the timekeeper into thinking it's later than it is) and calls the method to start the actual
simulation.</p>
</div>


                            </div>
                            <div id="EDMCore.establish_mrid_name_lookup_table" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#EDMCore.establish_mrid_name_lookup_table">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">establish_mrid_name_lookup_table</span><span class="signature">(self)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">establish_mrid_name_lookup_table</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This currently creates two lookup dictionaries. mrid_name_lookup_table gets the real names of measurements for</span>
<span class="sd">        the measurement processor/logger. cim_measurement_dict gives a more fully fleshed out dictionary containing</span>
<span class="sd">        several parameters related to measurements that are appended to the measurement processor&#39;s current readings.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">topic</span> <span class="o">=</span> <span class="s2">&quot;goss.gridappsd.process.request.data.powergridmodel&quot;</span>
        <span class="n">message</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;modelId&quot;</span><span class="p">:</span> <span class="n">edmCore</span><span class="o">.</span><span class="n">get_line_mrid</span><span class="p">(),</span>
            <span class="s2">&quot;requestType&quot;</span><span class="p">:</span> <span class="s2">&quot;QUERY_OBJECT_MEASUREMENTS&quot;</span><span class="p">,</span>
            <span class="s2">&quot;resultFormat&quot;</span><span class="p">:</span> <span class="s2">&quot;JSON&quot;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">object_meas</span> <span class="o">=</span> <span class="n">edmCore</span><span class="o">.</span><span class="n">gapps_session</span><span class="o">.</span><span class="n">get_response</span><span class="p">(</span><span class="n">topic</span><span class="p">,</span> <span class="n">message</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mrid_name_lookup_table</span> <span class="o">=</span> <span class="n">object_meas</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span>

        <span class="n">config_api_topic</span> <span class="o">=</span> <span class="s1">&#39;goss.gridappsd.process.request.config&#39;</span>
        <span class="n">message</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;configurationType&#39;</span><span class="p">:</span> <span class="s1">&#39;CIM Dictionary&#39;</span><span class="p">,</span>
            <span class="s1">&#39;parameters&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;model_id&#39;</span><span class="p">:</span> <span class="n">edmCore</span><span class="o">.</span><span class="n">line_mrid</span><span class="p">}</span>
        <span class="p">}</span>
        <span class="n">cim_dict</span> <span class="o">=</span> <span class="n">edmCore</span><span class="o">.</span><span class="n">gapps_session</span><span class="o">.</span><span class="n">get_response</span><span class="p">(</span><span class="n">config_api_topic</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
        <span class="n">measdict</span> <span class="o">=</span> <span class="n">cim_dict</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;feeders&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;measurements&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cim_measurement_dict</span> <span class="o">=</span> <span class="n">measdict</span>
</pre></div>

        </details>

            <div class="docstring"><p>This currently creates two lookup dictionaries. mrid_name_lookup_table gets the real names of measurements for
the measurement processor/logger. cim_measurement_dict gives a more fully fleshed out dictionary containing
several parameters related to measurements that are appended to the measurement processor's current readings.</p>
</div>


                            </div>
                            <div id="EDMCore.get_mrid_name_lookup_table" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#EDMCore.get_mrid_name_lookup_table">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">get_mrid_name_lookup_table</span><span class="signature">(self)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">get_mrid_name_lookup_table</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        ACCESSOR METHOD: Returns the mrid_name_lookup_table.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">mrid_name_lookup_table</span>
</pre></div>

        </details>

            <div class="docstring"><p>ACCESSOR METHOD: Returns the mrid_name_lookup_table.</p>
</div>


                            </div>
                            <div id="EDMCore.get_cim_measurement_dict" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#EDMCore.get_cim_measurement_dict">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">get_cim_measurement_dict</span><span class="signature">(self)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">get_cim_measurement_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        ACCESSOR METHOD: Returns the cim_measurement.dict.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cim_measurement_dict</span>
</pre></div>

        </details>

            <div class="docstring"><p>ACCESSOR METHOD: Returns the cim_measurement.dict.</p>
</div>


                            </div>
                </section>
                <section id="EDMTimeKeeper">
                                <div class="attr class">
        <a class="headerlink" href="#EDMTimeKeeper">#&nbsp;&nbsp</a>

        
        <span class="def">class</span>
        <span class="name">EDMTimeKeeper</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">EDMTimeKeeper</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    CALLBACK CLASS. GridAPPS-D provides logging messages to this callback class. on_message() filters these down</span>
<span class="sd">    to exclude everything except simulation timestep &quot;incrementing to...&quot; messages and simulation ending messages.</span>
<span class="sd">    Each time an incrementation message is received from GridAPPS-D, one second has elapsed. The Timekeeper increments</span>
<span class="sd">    the time each timestep; more importantly, it also calls all methods that are intended to run continuously during</span>
<span class="sd">    simulation runtime. perform_all_on_timestep_updates() updates the MC once per second, including receiving DER-S</span>
<span class="sd">    inputs, updating the DER-EMs, and updating the logs.</span>

<span class="sd">    Note: this does not include updating the grid state measurements. GridAPPS-D retrieves grid states for the</span>
<span class="sd">    measurement callbacks once every three seconds using a completely different communications pathway. As such,</span>
<span class="sd">    measurements and their processing are not handled by this class in any way.</span>

<span class="sd">    ATTRIBUTES:</span>

<span class="sd">        .sim_start_time: The (from config) simulation start timecode.</span>

<span class="sd">        .sim_current_time: The current timestamp. Initialized to the sim start time.</span>

<span class="sd">        .previous_log_message: A buffer containing the previous log message. Necessary to fix a double incrementation</span>
<span class="sd">               glitch caused by GridAPPS-D providing the same log multiple times.</span>

<span class="sd">        .edmCoreObj: edmCore is fed through an argument directly since it doesn&#39;t function properly as a global object.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">edmCoreObj</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sim_start_time</span> <span class="o">=</span> <span class="n">edmCoreObj</span><span class="o">.</span><span class="n">get_sim_start_time</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sim_current_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim_start_time</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">previous_log_message</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">edmCoreObj</span> <span class="o">=</span> <span class="n">edmCoreObj</span>

    <span class="k">def</span> <span class="nf">on_message</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sim</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        CALLBACK METHOD: the &quot;message&quot; argument contains the full text of the Log messages provided by GridAPPS-D. This</span>
<span class="sd">        occurs for many reasons, including startup messages, errors, etc. We are only concerned with two types of</span>
<span class="sd">        messages: if the message contains the text &quot;incrementing to &quot;, that means one second (and thus one timestep) has</span>
<span class="sd">        elapsed, and if the message process status is &quot;complete&quot; or &quot;closed&quot;, we know the simulation is complete and</span>
<span class="sd">        the MC should close out.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># on_message function definitions:</span>

        <span class="k">def</span> <span class="nf">end_program</span><span class="p">():</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Ends the program by closing out the logs and setting the global end program flag to true, breaking the</span>
<span class="sd">            main loop.</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="n">mcOutputLog</span><span class="o">.</span><span class="n">close_out_logs</span><span class="p">()</span>
            <span class="k">global</span> <span class="n">end_program</span>
            <span class="n">end_program</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">def</span> <span class="nf">update_and_increment_timestep</span><span class="p">(</span><span class="n">log_message</span><span class="p">,</span> <span class="bp">self</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Increments the timestep only if &quot;incrementing to &quot; is within the log_message; otherwise does nothing.</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="k">if</span> <span class="s2">&quot;incrementing to &quot;</span> <span class="ow">in</span> <span class="n">log_message</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">log_message</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">previous_log_message</span><span class="p">:</span>  <span class="c1"># Msgs get spit out twice for some reason. Only reads one.</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">increment_sim_current_time</span><span class="p">()</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Current timestep: &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim_current_time</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">perform_all_on_timestep_updates</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">previous_log_message</span> <span class="o">=</span> <span class="n">log_message</span>

        <span class="c1"># on_message() function body:</span>

        <span class="n">log_message</span> <span class="o">=</span> <span class="n">message</span><span class="p">[</span><span class="s2">&quot;logMessage&quot;</span><span class="p">]</span>
        <span class="n">process_status</span> <span class="o">=</span> <span class="n">message</span><span class="p">[</span><span class="s1">&#39;processStatus&#39;</span><span class="p">]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">process_status</span> <span class="o">==</span> <span class="s1">&#39;COMPLETE&#39;</span> <span class="ow">or</span> <span class="n">process_status</span> <span class="o">==</span> <span class="s1">&#39;CLOSED&#39;</span><span class="p">:</span>
                <span class="n">end_program</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">update_and_increment_timestep</span><span class="p">(</span><span class="n">log_message</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">KeyError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>   <span class="c1"># Spits out the log message for troubleshooting if something weird happens.</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;KeyError!&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">increment_sim_current_time</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Increments the current simulation time by 1.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">current_int_time</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sim_current_time</span><span class="p">)</span>
        <span class="n">current_int_time</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sim_current_time</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">current_int_time</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_sim_current_time</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        ACCESSOR: Returns the current simulation time. (Not real time.)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim_current_time</span>

    <span class="k">def</span> <span class="nf">perform_all_on_timestep_updates</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        ENCAPSULATION: Calls all methods that update the system each timestep (second). New processes should be added</span>
<span class="sd">        here if they need to be ongoing, I.E. once per second through the simulation.</span>

<span class="sd">        NOTE: DOES NOT INCLUDE MEASUREMENT READING/PROCESSING. Those are done once every three seconds due to the way</span>
<span class="sd">        GridAPPS-D is designed and are independent of the simulation timekeeper processes. See EDMMeasurementProcessor.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Performing on-timestep updates:&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">edmCoreObj</span><span class="o">.</span><span class="n">sim_current_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim_current_time</span>
        <span class="n">mcInputInterface</span><span class="o">.</span><span class="n">update_all_der_s_status</span><span class="p">()</span>
        <span class="n">mcInputInterface</span><span class="o">.</span><span class="n">update_all_der_em_status</span><span class="p">()</span>
        <span class="n">mcOutputLog</span><span class="o">.</span><span class="n">update_logs</span><span class="p">()</span>
        <span class="n">goSensor</span><span class="o">.</span><span class="n">make_service_request_decision</span><span class="p">()</span>
        <span class="n">goOutputInterface</span><span class="o">.</span><span class="n">get_all_posted_service_requests</span><span class="p">()</span>
        <span class="n">goOutputInterface</span><span class="o">.</span><span class="n">send_service_request_messages</span><span class="p">()</span>
</pre></div>

        </details>

            <div class="docstring"><p>CALLBACK CLASS. GridAPPS-D provides logging messages to this callback class. on_message() filters these down
to exclude everything except simulation timestep "incrementing to..." messages and simulation ending messages.
Each time an incrementation message is received from GridAPPS-D, one second has elapsed. The Timekeeper increments
the time each timestep; more importantly, it also calls all methods that are intended to run continuously during
simulation runtime. perform_all_on_timestep_updates() updates the MC once per second, including receiving DER-S
inputs, updating the DER-EMs, and updating the logs.</p>

<p>Note: this does not include updating the grid state measurements. GridAPPS-D retrieves grid states for the
measurement callbacks once every three seconds using a completely different communications pathway. As such,
measurements and their processing are not handled by this class in any way.</p>

<p>ATTRIBUTES:</p>

<pre><code>.sim_start_time: The (from config) simulation start timecode.

.sim_current_time: The current timestamp. Initialized to the sim start time.

.previous_log_message: A buffer containing the previous log message. Necessary to fix a double incrementation
       glitch caused by GridAPPS-D providing the same log multiple times.

.edmCoreObj: edmCore is fed through an argument directly since it doesn't function properly as a global object.
</code></pre>
</div>


                            <div id="EDMTimeKeeper.__init__" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#EDMTimeKeeper.__init__">#&nbsp;&nbsp</a>

        
            <span class="name">EDMTimeKeeper</span><span class="signature">(edmCoreObj)</span>
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">edmCoreObj</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sim_start_time</span> <span class="o">=</span> <span class="n">edmCoreObj</span><span class="o">.</span><span class="n">get_sim_start_time</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sim_current_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim_start_time</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">previous_log_message</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">edmCoreObj</span> <span class="o">=</span> <span class="n">edmCoreObj</span>
</pre></div>

        </details>

    

                            </div>
                            <div id="EDMTimeKeeper.on_message" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#EDMTimeKeeper.on_message">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">on_message</span><span class="signature">(self, sim, message)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">on_message</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sim</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        CALLBACK METHOD: the &quot;message&quot; argument contains the full text of the Log messages provided by GridAPPS-D. This</span>
<span class="sd">        occurs for many reasons, including startup messages, errors, etc. We are only concerned with two types of</span>
<span class="sd">        messages: if the message contains the text &quot;incrementing to &quot;, that means one second (and thus one timestep) has</span>
<span class="sd">        elapsed, and if the message process status is &quot;complete&quot; or &quot;closed&quot;, we know the simulation is complete and</span>
<span class="sd">        the MC should close out.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># on_message function definitions:</span>

        <span class="k">def</span> <span class="nf">end_program</span><span class="p">():</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Ends the program by closing out the logs and setting the global end program flag to true, breaking the</span>
<span class="sd">            main loop.</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="n">mcOutputLog</span><span class="o">.</span><span class="n">close_out_logs</span><span class="p">()</span>
            <span class="k">global</span> <span class="n">end_program</span>
            <span class="n">end_program</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">def</span> <span class="nf">update_and_increment_timestep</span><span class="p">(</span><span class="n">log_message</span><span class="p">,</span> <span class="bp">self</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Increments the timestep only if &quot;incrementing to &quot; is within the log_message; otherwise does nothing.</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="k">if</span> <span class="s2">&quot;incrementing to &quot;</span> <span class="ow">in</span> <span class="n">log_message</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">log_message</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">previous_log_message</span><span class="p">:</span>  <span class="c1"># Msgs get spit out twice for some reason. Only reads one.</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">increment_sim_current_time</span><span class="p">()</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Current timestep: &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim_current_time</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">perform_all_on_timestep_updates</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">previous_log_message</span> <span class="o">=</span> <span class="n">log_message</span>

        <span class="c1"># on_message() function body:</span>

        <span class="n">log_message</span> <span class="o">=</span> <span class="n">message</span><span class="p">[</span><span class="s2">&quot;logMessage&quot;</span><span class="p">]</span>
        <span class="n">process_status</span> <span class="o">=</span> <span class="n">message</span><span class="p">[</span><span class="s1">&#39;processStatus&#39;</span><span class="p">]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">process_status</span> <span class="o">==</span> <span class="s1">&#39;COMPLETE&#39;</span> <span class="ow">or</span> <span class="n">process_status</span> <span class="o">==</span> <span class="s1">&#39;CLOSED&#39;</span><span class="p">:</span>
                <span class="n">end_program</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">update_and_increment_timestep</span><span class="p">(</span><span class="n">log_message</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">KeyError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>   <span class="c1"># Spits out the log message for troubleshooting if something weird happens.</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;KeyError!&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
</pre></div>

        </details>

            <div class="docstring"><p>CALLBACK METHOD: the "message" argument contains the full text of the Log messages provided by GridAPPS-D. This
occurs for many reasons, including startup messages, errors, etc. We are only concerned with two types of
messages: if the message contains the text "incrementing to ", that means one second (and thus one timestep) has
elapsed, and if the message process status is "complete" or "closed", we know the simulation is complete and
the MC should close out.</p>
</div>


                            </div>
                            <div id="EDMTimeKeeper.increment_sim_current_time" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#EDMTimeKeeper.increment_sim_current_time">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">increment_sim_current_time</span><span class="signature">(self)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">increment_sim_current_time</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Increments the current simulation time by 1.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">current_int_time</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sim_current_time</span><span class="p">)</span>
        <span class="n">current_int_time</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sim_current_time</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">current_int_time</span><span class="p">)</span>
</pre></div>

        </details>

            <div class="docstring"><p>Increments the current simulation time by 1.</p>
</div>


                            </div>
                            <div id="EDMTimeKeeper.get_sim_current_time" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#EDMTimeKeeper.get_sim_current_time">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">get_sim_current_time</span><span class="signature">(self)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">get_sim_current_time</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        ACCESSOR: Returns the current simulation time. (Not real time.)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim_current_time</span>
</pre></div>

        </details>

            <div class="docstring"><p>ACCESSOR: Returns the current simulation time. (Not real time.)</p>
</div>


                            </div>
                            <div id="EDMTimeKeeper.perform_all_on_timestep_updates" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#EDMTimeKeeper.perform_all_on_timestep_updates">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">perform_all_on_timestep_updates</span><span class="signature">(self)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">perform_all_on_timestep_updates</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        ENCAPSULATION: Calls all methods that update the system each timestep (second). New processes should be added</span>
<span class="sd">        here if they need to be ongoing, I.E. once per second through the simulation.</span>

<span class="sd">        NOTE: DOES NOT INCLUDE MEASUREMENT READING/PROCESSING. Those are done once every three seconds due to the way</span>
<span class="sd">        GridAPPS-D is designed and are independent of the simulation timekeeper processes. See EDMMeasurementProcessor.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Performing on-timestep updates:&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">edmCoreObj</span><span class="o">.</span><span class="n">sim_current_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim_current_time</span>
        <span class="n">mcInputInterface</span><span class="o">.</span><span class="n">update_all_der_s_status</span><span class="p">()</span>
        <span class="n">mcInputInterface</span><span class="o">.</span><span class="n">update_all_der_em_status</span><span class="p">()</span>
        <span class="n">mcOutputLog</span><span class="o">.</span><span class="n">update_logs</span><span class="p">()</span>
        <span class="n">goSensor</span><span class="o">.</span><span class="n">make_service_request_decision</span><span class="p">()</span>
        <span class="n">goOutputInterface</span><span class="o">.</span><span class="n">get_all_posted_service_requests</span><span class="p">()</span>
        <span class="n">goOutputInterface</span><span class="o">.</span><span class="n">send_service_request_messages</span><span class="p">()</span>
</pre></div>

        </details>

            <div class="docstring"><p>ENCAPSULATION: Calls all methods that update the system each timestep (second). New processes should be added
here if they need to be ongoing, I.E. once per second through the simulation.</p>

<p>NOTE: DOES NOT INCLUDE MEASUREMENT READING/PROCESSING. Those are done once every three seconds due to the way
GridAPPS-D is designed and are independent of the simulation timekeeper processes. See EDMMeasurementProcessor.</p>
</div>


                            </div>
                </section>
                <section id="EDMMeasurementProcessor">
                                <div class="attr class">
        <a class="headerlink" href="#EDMMeasurementProcessor">#&nbsp;&nbsp</a>

        
        <span class="def">class</span>
        <span class="name">EDMMeasurementProcessor</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">EDMMeasurementProcessor</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    CALLBACK CLASS: once per three seconds (roughly), GridAPPS-D provides a dictionary to the on_message() method</span>
<span class="sd">    containing all of the simulation measurements by mRID including the magnitude, angle, etc. The measurement processor</span>
<span class="sd">    parses that dictionary into something more useful to the MC, draws more valuable information from the model, gets</span>
<span class="sd">    association and location data from the input branch, and appends it to the dictionary to produce something usable</span>
<span class="sd">    by the GO and the logging class.</span>

<span class="sd">    NOTE: the API for measurements and timekeeping are completely separate. The MC as a whole is synchronized with the</span>
<span class="sd">    timekeeping class, but measurement processes are done separately. This is why logs will have repeated values: the</span>
<span class="sd">    logs are part of the MC and thus update once per second, but the grid states going IN to the logs are only updated</span>
<span class="sd">    once per three seconds.</span>

<span class="sd">    ATTRIBUTES:</span>
<span class="sd">        .measurement_timestamp: The timestamp of the most recent set of measurements as read from the GridAPPS-D</span>
<span class="sd">            message. NOTE: Currently unused, but might be useful for future log revisions.</span>

<span class="sd">        .current_measurements: Contains the measurements taken from the GridAPPS-D message. Written in the function</span>
<span class="sd">            parse_message_into_current_measurements.</span>

<span class="sd">        .mrid_name_lookup_table: Read from EDMCore. Used to append informative data to each measurement.</span>

<span class="sd">        .measurement_lookup_table: Read from EDMCore. Used to append (different) information to each measurement.</span>

<span class="sd">        .measurement_mrids: Measurement dictionaries provided by GridAPPS-D use mRIDs as keys for each measurement.</span>
<span class="sd">            This contains a list of those keys and is used to replace those mRIDs with human-readable names.</span>

<span class="sd">        .measurement_names: A list of human-readable measurement names. See measurement_mrids.</span>

<span class="sd">        .assignment_lookup_table: Read from DERAssignmentHandler. Used to append DER-S to DER-EM association data to</span>
<span class="sd">            each measurement for logging and troubleshooting purposes.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">measurement_timestamp</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_measurements</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mrid_name_lookup_table</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">measurement_lookup_table</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">measurement_mrids</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">measurement_names</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assignment_lookup_table</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">on_message</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">headers</span><span class="p">,</span> <span class="n">measurements</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        CALLBACK METHOD: receives the measurements once every three seconds, and passes them to the parsing method.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parse_message_into_current_measurements</span><span class="p">(</span><span class="n">measurements</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_current_measurements</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        ACCESSOR: Returns the current fully processed measurement dictionary.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_measurements</span>

    <span class="k">def</span> <span class="nf">parse_message_into_current_measurements</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">measurement_message</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The measurement message from GridAPPS-D is pretty ugly. This method pulls out just the stuff we need, and then</span>
<span class="sd">        calls methods to append names, association/location info, etc. Basically, this turns the raw input data into</span>
<span class="sd">        the fully formatted edmMeasurementProcessor.current_measurements dictionary which is passed to the logger and GO</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_measurements</span> <span class="o">=</span> <span class="n">measurement_message</span><span class="p">[</span><span class="s1">&#39;message&#39;</span><span class="p">][</span><span class="s1">&#39;measurements&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">measurement_timestamp</span> <span class="o">=</span> <span class="n">measurement_message</span><span class="p">[</span><span class="s1">&#39;message&#39;</span><span class="p">][</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">append_names</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">append_association_data</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">append_names</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds a bunch of extra important information to each measurement&#39;s value dictionary.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mrid_name_lookup_table</span> <span class="o">=</span> <span class="n">edmCore</span><span class="o">.</span><span class="n">get_mrid_name_lookup_table</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">measurement_lookup_table</span> <span class="o">=</span> <span class="n">edmCore</span><span class="o">.</span><span class="n">get_cim_measurement_dict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">measurement_mrids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_measurements</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">measurement_mrids</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">lookup_mrid</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">item</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mrid_name_lookup_table</span> <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;measid&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">i</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">StopIteration</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">lookup_mrid</span><span class="p">)</span>
            <span class="n">lookup_name</span> <span class="o">=</span> <span class="n">lookup_mrid</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">measurement_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lookup_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">measurement_mrids</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">measurement_mrids</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">measurement_names</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">measurement_mrids</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">current_measurements</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;Measurement name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
                <span class="n">measurement_table_dict_containing_mrid</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">item</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">measurement_lookup_table</span>
                                                              <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;mRID&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">key</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">current_measurements</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;Meas Name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">measurement_table_dict_containing_mrid</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">current_measurements</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;Conducting Equipment Name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">measurement_table_dict_containing_mrid</span><span class="p">[</span>
                    <span class="s1">&#39;ConductingEquipment_name&#39;</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">current_measurements</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;Bus&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">measurement_table_dict_containing_mrid</span><span class="p">[</span>
                    <span class="s1">&#39;ConnectivityNode&#39;</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">current_measurements</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;Phases&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">measurement_table_dict_containing_mrid</span><span class="p">[</span>
                    <span class="s1">&#39;phases&#39;</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">current_measurements</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;MeasType&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">measurement_table_dict_containing_mrid</span><span class="p">[</span>
                    <span class="s1">&#39;measurementType&#39;</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">StopIteration</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Measurements updated with amplifying information.&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">append_association_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Appends association data.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assignment_lookup_table</span> <span class="o">=</span> <span class="n">derAssignmentHandler</span><span class="o">.</span><span class="n">get_assignment_lookup_table</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">assignment_lookup_table</span><span class="p">:</span>
            <span class="n">original_name</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;Name&#39;</span><span class="p">]</span>
            <span class="n">formatted_name</span> <span class="o">=</span> <span class="n">original_name</span><span class="p">[:</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="s1">&#39;_Battery&#39;</span><span class="p">)]</span>
            <span class="n">item</span><span class="p">[</span><span class="s1">&#39;DER-EM Name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">formatted_name</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_measurements</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">assignment_dict_with_given_name</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">item</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">assignment_lookup_table</span> <span class="k">if</span>
                                                       <span class="n">item</span><span class="p">[</span><span class="s1">&#39;DER-EM Name&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_measurements</span><span class="p">[</span><span class="n">key</span><span class="p">][</span>
                                                           <span class="s1">&#39;Conducting Equipment Name&#39;</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">current_measurements</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;Inverter Control mRID&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">assignment_dict_with_given_name</span><span class="p">[</span><span class="s1">&#39;mRID&#39;</span><span class="p">]</span>
                <span class="n">input_name</span> <span class="o">=</span> <span class="n">derIdentificationManager</span><span class="o">.</span><span class="n">get_meas_name</span><span class="p">(</span><span class="n">assignment_dict_with_given_name</span><span class="p">[</span><span class="s1">&#39;mRID&#39;</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">current_measurements</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;Input Unique ID&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">input_name</span>
            <span class="k">except</span> <span class="ne">StopIteration</span><span class="p">:</span>
                <span class="k">pass</span>
</pre></div>

        </details>

            <div class="docstring"><p>CALLBACK CLASS: once per three seconds (roughly), GridAPPS-D provides a dictionary to the on_message() method
containing all of the simulation measurements by mRID including the magnitude, angle, etc. The measurement processor
parses that dictionary into something more useful to the MC, draws more valuable information from the model, gets
association and location data from the input branch, and appends it to the dictionary to produce something usable
by the GO and the logging class.</p>

<p>NOTE: the API for measurements and timekeeping are completely separate. The MC as a whole is synchronized with the
timekeeping class, but measurement processes are done separately. This is why logs will have repeated values: the
logs are part of the MC and thus update once per second, but the grid states going IN to the logs are only updated
once per three seconds.</p>

<p>ATTRIBUTES:
    .measurement_timestamp: The timestamp of the most recent set of measurements as read from the GridAPPS-D
        message. NOTE: Currently unused, but might be useful for future log revisions.</p>

<pre><code>.current_measurements: Contains the measurements taken from the GridAPPS-D message. Written in the function
    parse_message_into_current_measurements.

.mrid_name_lookup_table: Read from EDMCore. Used to append informative data to each measurement.

.measurement_lookup_table: Read from EDMCore. Used to append (different) information to each measurement.

.measurement_mrids: Measurement dictionaries provided by GridAPPS-D use mRIDs as keys for each measurement.
    This contains a list of those keys and is used to replace those mRIDs with human-readable names.

.measurement_names: A list of human-readable measurement names. See measurement_mrids.

.assignment_lookup_table: Read from DERAssignmentHandler. Used to append DER-S to DER-EM association data to
    each measurement for logging and troubleshooting purposes.
</code></pre>
</div>


                            <div id="EDMMeasurementProcessor.__init__" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#EDMMeasurementProcessor.__init__">#&nbsp;&nbsp</a>

        
            <span class="name">EDMMeasurementProcessor</span><span class="signature">()</span>
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">measurement_timestamp</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_measurements</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mrid_name_lookup_table</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">measurement_lookup_table</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">measurement_mrids</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">measurement_names</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assignment_lookup_table</span> <span class="o">=</span> <span class="p">[]</span>
</pre></div>

        </details>

    

                            </div>
                            <div id="EDMMeasurementProcessor.on_message" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#EDMMeasurementProcessor.on_message">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">on_message</span><span class="signature">(self, headers, measurements)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">on_message</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">headers</span><span class="p">,</span> <span class="n">measurements</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        CALLBACK METHOD: receives the measurements once every three seconds, and passes them to the parsing method.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parse_message_into_current_measurements</span><span class="p">(</span><span class="n">measurements</span><span class="p">)</span>
</pre></div>

        </details>

            <div class="docstring"><p>CALLBACK METHOD: receives the measurements once every three seconds, and passes them to the parsing method.</p>
</div>


                            </div>
                            <div id="EDMMeasurementProcessor.get_current_measurements" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#EDMMeasurementProcessor.get_current_measurements">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">get_current_measurements</span><span class="signature">(self)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">get_current_measurements</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        ACCESSOR: Returns the current fully processed measurement dictionary.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_measurements</span>
</pre></div>

        </details>

            <div class="docstring"><p>ACCESSOR: Returns the current fully processed measurement dictionary.</p>
</div>


                            </div>
                            <div id="EDMMeasurementProcessor.parse_message_into_current_measurements" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#EDMMeasurementProcessor.parse_message_into_current_measurements">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">parse_message_into_current_measurements</span><span class="signature">(self, measurement_message)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">parse_message_into_current_measurements</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">measurement_message</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The measurement message from GridAPPS-D is pretty ugly. This method pulls out just the stuff we need, and then</span>
<span class="sd">        calls methods to append names, association/location info, etc. Basically, this turns the raw input data into</span>
<span class="sd">        the fully formatted edmMeasurementProcessor.current_measurements dictionary which is passed to the logger and GO</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_measurements</span> <span class="o">=</span> <span class="n">measurement_message</span><span class="p">[</span><span class="s1">&#39;message&#39;</span><span class="p">][</span><span class="s1">&#39;measurements&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">measurement_timestamp</span> <span class="o">=</span> <span class="n">measurement_message</span><span class="p">[</span><span class="s1">&#39;message&#39;</span><span class="p">][</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">append_names</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">append_association_data</span><span class="p">()</span>
</pre></div>

        </details>

            <div class="docstring"><p>The measurement message from GridAPPS-D is pretty ugly. This method pulls out just the stuff we need, and then
calls methods to append names, association/location info, etc. Basically, this turns the raw input data into
the fully formatted edmMeasurementProcessor.current_measurements dictionary which is passed to the logger and GO</p>
</div>


                            </div>
                            <div id="EDMMeasurementProcessor.append_names" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#EDMMeasurementProcessor.append_names">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">append_names</span><span class="signature">(self)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">append_names</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds a bunch of extra important information to each measurement&#39;s value dictionary.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mrid_name_lookup_table</span> <span class="o">=</span> <span class="n">edmCore</span><span class="o">.</span><span class="n">get_mrid_name_lookup_table</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">measurement_lookup_table</span> <span class="o">=</span> <span class="n">edmCore</span><span class="o">.</span><span class="n">get_cim_measurement_dict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">measurement_mrids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_measurements</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">measurement_mrids</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">lookup_mrid</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">item</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mrid_name_lookup_table</span> <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;measid&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">i</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">StopIteration</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">lookup_mrid</span><span class="p">)</span>
            <span class="n">lookup_name</span> <span class="o">=</span> <span class="n">lookup_mrid</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">measurement_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lookup_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">measurement_mrids</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">measurement_mrids</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">measurement_names</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">measurement_mrids</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">current_measurements</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;Measurement name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
                <span class="n">measurement_table_dict_containing_mrid</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">item</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">measurement_lookup_table</span>
                                                              <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;mRID&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">key</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">current_measurements</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;Meas Name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">measurement_table_dict_containing_mrid</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">current_measurements</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;Conducting Equipment Name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">measurement_table_dict_containing_mrid</span><span class="p">[</span>
                    <span class="s1">&#39;ConductingEquipment_name&#39;</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">current_measurements</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;Bus&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">measurement_table_dict_containing_mrid</span><span class="p">[</span>
                    <span class="s1">&#39;ConnectivityNode&#39;</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">current_measurements</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;Phases&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">measurement_table_dict_containing_mrid</span><span class="p">[</span>
                    <span class="s1">&#39;phases&#39;</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">current_measurements</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;MeasType&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">measurement_table_dict_containing_mrid</span><span class="p">[</span>
                    <span class="s1">&#39;measurementType&#39;</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">StopIteration</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Measurements updated with amplifying information.&quot;</span><span class="p">)</span>
</pre></div>

        </details>

            <div class="docstring"><p>Adds a bunch of extra important information to each measurement's value dictionary.</p>
</div>


                            </div>
                            <div id="EDMMeasurementProcessor.append_association_data" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#EDMMeasurementProcessor.append_association_data">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">append_association_data</span><span class="signature">(self)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">append_association_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Appends association data.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assignment_lookup_table</span> <span class="o">=</span> <span class="n">derAssignmentHandler</span><span class="o">.</span><span class="n">get_assignment_lookup_table</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">assignment_lookup_table</span><span class="p">:</span>
            <span class="n">original_name</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;Name&#39;</span><span class="p">]</span>
            <span class="n">formatted_name</span> <span class="o">=</span> <span class="n">original_name</span><span class="p">[:</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="s1">&#39;_Battery&#39;</span><span class="p">)]</span>
            <span class="n">item</span><span class="p">[</span><span class="s1">&#39;DER-EM Name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">formatted_name</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_measurements</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">assignment_dict_with_given_name</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">item</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">assignment_lookup_table</span> <span class="k">if</span>
                                                       <span class="n">item</span><span class="p">[</span><span class="s1">&#39;DER-EM Name&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_measurements</span><span class="p">[</span><span class="n">key</span><span class="p">][</span>
                                                           <span class="s1">&#39;Conducting Equipment Name&#39;</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">current_measurements</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;Inverter Control mRID&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">assignment_dict_with_given_name</span><span class="p">[</span><span class="s1">&#39;mRID&#39;</span><span class="p">]</span>
                <span class="n">input_name</span> <span class="o">=</span> <span class="n">derIdentificationManager</span><span class="o">.</span><span class="n">get_meas_name</span><span class="p">(</span><span class="n">assignment_dict_with_given_name</span><span class="p">[</span><span class="s1">&#39;mRID&#39;</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">current_measurements</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;Input Unique ID&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">input_name</span>
            <span class="k">except</span> <span class="ne">StopIteration</span><span class="p">:</span>
                <span class="k">pass</span>
</pre></div>

        </details>

            <div class="docstring"><p>Appends association data.</p>
</div>


                            </div>
                </section>
                <section id="RWHDERS">
                                <div class="attr class">
        <a class="headerlink" href="#RWHDERS">#&nbsp;&nbsp</a>

        
        <span class="def">class</span>
        <span class="name">RWHDERS</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">RWHDERS</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The Resistive Water Heater DER-S. This DER-S is designed to build on prior work by the Portland State Univerity</span>
<span class="sd">    Power Engineering Group. RWHDERS is designed to provide a means for resistive water heaters to be modeled and</span>
<span class="sd">    simulated in the Modeling Environment.</span>

<span class="sd">    The input to RWHDERS is information from water heater emulators that are/will be provided by the GSP (via the EGoT</span>
<span class="sd">    server/client system). These emulators function over time as a resistive water heater, turning on and off based on</span>
<span class="sd">    current tank temperature, ambient losses, usage profiles, etc. These functions are handled externally to the ME,</span>
<span class="sd">    however: the end result is a series of .csv files contained in the RWHDERS Inputs folder.</span>

<span class="sd">    The ME uses these .csv files as follows. Each file is named &quot;DER#####_Bus###.csv&quot;. The first set of numbers is a</span>
<span class="sd">    serial number used as each emulated DER input&#39;s &#39;unique identifier&#39;. The second set is the &#39;locational information&#39;,</span>
<span class="sd">    in this case the Bus the DER should be located on in the model. The contents of the .csv file are a single pair of</span>
<span class="sd">    values: &quot;P&quot;, for power, and a number corresponding to what the power should be set to. This is by agreement with</span>
<span class="sd">    the GSP designer; in the future, the file could contain voltages, or more complex information such as usage profiles</span>
<span class="sd">    that would require modification to the RWHDERS class to parse.</span>

<span class="sd">    At the beginning of each simulation, the DERAssignmentHandler class calls the assign_der_s_to_der_em() function for</span>
<span class="sd">    each DER-S, including RWHDERS. This function associates each unique identifier with the mRID of a DER-EM. These</span>
<span class="sd">    DER-EMs already exist in the model and do nothing unless associated with a DER-S unit.</span>

<span class="sd">    During the simulation, each time step RWHDERS reads the .csv files for updates. The power levels for each DER are</span>
<span class="sd">    processed into a standard message format used by MCInputInterface. The association data is used to ensure each</span>
<span class="sd">    input is being sent to the proper DER-EM by MCInputInterface. Then, again on each timestep, MCInputInterface updates</span>
<span class="sd">    the DER-EMs in the model with the new power data, which is reflected in the logs.</span>

<span class="sd">    In this way, changes to water heater states are converted to time-valued power changes, which are sent to RWHDERS,</span>
<span class="sd">    processed by the MC, and written into the simulation so that grid states reflect the changes.</span>

<span class="sd">    ATTRIBUTES:</span>
<span class="sd">        .der_em_input_request: Contains the new DER-EM states for this timestep, already parsed and put into list</span>
<span class="sd">            format by RWHDERS. The list is so multiple DER-EMs can be updated per timestep.</span>

<span class="sd">        .input_file_path: The folder in which the RWHDERS input files are located.</span>

<span class="sd">        .input_identification_dict: a dictionary of identification information for each DER input. The keys are the</span>
<span class="sd">           serial numbers parsed from each file name, and the values include the buys and the filename. Used during</span>
<span class="sd">           assignment, and also on time step to get the right data from the right file for each DER&#39;s unique ID.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mcConfiguration</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">der_em_input_request</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">input_file_path</span> <span class="o">=</span> <span class="n">mcConfiguration</span><span class="o">.</span><span class="n">mc_file_directory</span> <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot;/RWHDERS Inputs/&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">input_identification_dict</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="nf">initialize_der_s</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function (with this specific name) is required in each DER-S used by the ME. The EDMCore&#39;s initialization</span>
<span class="sd">        process calls this function for each DER-S activated in MCConfig to perform initialization tasks. This does not</span>
<span class="sd">        include DER-EM assignment (see assign_der_s_to_der_em). In this case, all this function does is call</span>
<span class="sd">        the parse_input_file_names_for_assignment() function. See below.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parse_input_file_names_for_assignment</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">assign_der_s_to_der_em</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function (with this specific name) is required in each DER-S used by the ME. The DERAssignmentHandler</span>
<span class="sd">        calls this function for each DER-S activated in MCConfig. This function&#39;s purpose is to take unique identifiers</span>
<span class="sd">        from each &quot;DER input&quot; for a given DER-S and &quot;associate&quot; them with the mRIDs for DER-EMs in the model. This is</span>
<span class="sd">        done using locational data: I.E. a specific DER input should be associated with the mRID of a DER-EM on a given</span>
<span class="sd">        bus. This function does those tasks using the input_identification_dict generated in the initialization process</span>
<span class="sd">        (see self.parse_input_file_names_for_assignment())</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;iid&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">input_identification_dict</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_identification_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">der_id</span> <span class="o">=</span> <span class="n">key</span>
            <span class="n">der_bus</span> <span class="o">=</span> <span class="n">value</span><span class="p">[</span><span class="s1">&#39;Bus&#39;</span><span class="p">]</span>
            <span class="n">der_mrid</span> <span class="o">=</span> <span class="n">derAssignmentHandler</span><span class="o">.</span><span class="n">get_mRID_for_der_on_bus</span><span class="p">(</span><span class="n">der_bus</span><span class="p">)</span>
            <span class="n">der_being_assigned</span> <span class="o">=</span> <span class="p">{</span><span class="n">der_id</span><span class="p">:</span> <span class="n">der_mrid</span><span class="p">}</span>
            <span class="n">derAssignmentHandler</span><span class="o">.</span><span class="n">append_new_values_to_association_table</span><span class="p">(</span><span class="n">der_being_assigned</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">parse_input_file_names_for_assignment</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function is called during the DER-S initialization process. It reads all the files in the RWHDERS Inputs</span>
<span class="sd">        folder and parses them into an input dictionary containing the unique ID, file name, and Bus location for each.</span>
<span class="sd">        These are used during assignment and each time step to &quot;connect the dots&quot; between the input file and the</span>
<span class="sd">        DER-EM which represents its data.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">filename_list</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">input_file_path</span><span class="p">)</span>
        <span class="n">parsed_filename_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">filename_list</span><span class="p">:</span>
            <span class="n">g</span> <span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)</span>
            <span class="n">g</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">g</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">5</span><span class="p">:]</span>
            <span class="n">g</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">g</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">3</span><span class="p">:</span><span class="mi">6</span><span class="p">]</span>
            <span class="n">parsed_filename_list</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="n">g</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span> <span class="p">{</span><span class="s2">&quot;Filepath&quot;</span><span class="p">:</span> <span class="n">i</span><span class="p">,</span> <span class="s2">&quot;Bus&quot;</span><span class="p">:</span> <span class="n">g</span><span class="p">[</span><span class="mi">1</span><span class="p">]}})</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">parsed_filename_list</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">input_identification_dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">update_der_em_input_request</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reads the input data from each file in the input identification dict, and puts it in a list readable by the</span>
<span class="sd">        MCInputInterface.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">der_em_input_request</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_identification_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="kn">import</span> <span class="nn">csv</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">input_file_path</span> <span class="o">+</span> <span class="n">value</span><span class="p">[</span><span class="s1">&#39;Filepath&#39;</span><span class="p">],</span> <span class="n">newline</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">csvfile</span><span class="p">:</span>
                <span class="n">der_input_reader</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">reader</span><span class="p">(</span><span class="n">csvfile</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">der_input_reader</span><span class="p">:</span>
                    <span class="n">current_der_input</span> <span class="o">=</span> <span class="p">{</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span> <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]}</span>
                    <span class="nb">print</span><span class="p">(</span><span class="n">current_der_input</span><span class="p">)</span>
            <span class="n">current_der_real_power</span> <span class="o">=</span> <span class="n">current_der_input</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">]</span>
            <span class="n">current_der_input_request</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="p">:</span> <span class="n">current_der_real_power</span><span class="p">}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">der_em_input_request</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">current_der_input_request</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_input_request</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function (with this specific name) is required in each DER-S used by the ME. Accessor function that calls</span>
<span class="sd">        for an updated input request, then returns the updated request for use by the MCInputInterface</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_der_em_input_request</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">der_em_input_request</span>
</pre></div>

        </details>

            <div class="docstring"><p>The Resistive Water Heater DER-S. This DER-S is designed to build on prior work by the Portland State Univerity
Power Engineering Group. RWHDERS is designed to provide a means for resistive water heaters to be modeled and
simulated in the Modeling Environment.</p>

<p>The input to RWHDERS is information from water heater emulators that are/will be provided by the GSP (via the EGoT
server/client system). These emulators function over time as a resistive water heater, turning on and off based on
current tank temperature, ambient losses, usage profiles, etc. These functions are handled externally to the ME,
however: the end result is a series of .csv files contained in the RWHDERS Inputs folder.</p>

<p>The ME uses these .csv files as follows. Each file is named "DER#####_Bus###.csv". The first set of numbers is a
serial number used as each emulated DER input's 'unique identifier'. The second set is the 'locational information',
in this case the Bus the DER should be located on in the model. The contents of the .csv file are a single pair of
values: "P", for power, and a number corresponding to what the power should be set to. This is by agreement with
the GSP designer; in the future, the file could contain voltages, or more complex information such as usage profiles
that would require modification to the RWHDERS class to parse.</p>

<p>At the beginning of each simulation, the DERAssignmentHandler class calls the assign_der_s_to_der_em() function for
each DER-S, including RWHDERS. This function associates each unique identifier with the mRID of a DER-EM. These
DER-EMs already exist in the model and do nothing unless associated with a DER-S unit.</p>

<p>During the simulation, each time step RWHDERS reads the .csv files for updates. The power levels for each DER are
processed into a standard message format used by MCInputInterface. The association data is used to ensure each
input is being sent to the proper DER-EM by MCInputInterface. Then, again on each timestep, MCInputInterface updates
the DER-EMs in the model with the new power data, which is reflected in the logs.</p>

<p>In this way, changes to water heater states are converted to time-valued power changes, which are sent to RWHDERS,
processed by the MC, and written into the simulation so that grid states reflect the changes.</p>

<p>ATTRIBUTES:
    .der_em_input_request: Contains the new DER-EM states for this timestep, already parsed and put into list
        format by RWHDERS. The list is so multiple DER-EMs can be updated per timestep.</p>

<pre><code>.input_file_path: The folder in which the RWHDERS input files are located.

.input_identification_dict: a dictionary of identification information for each DER input. The keys are the
   serial numbers parsed from each file name, and the values include the buys and the filename. Used during
   assignment, and also on time step to get the right data from the right file for each DER's unique ID.
</code></pre>
</div>


                            <div id="RWHDERS.__init__" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#RWHDERS.__init__">#&nbsp;&nbsp</a>

        
            <span class="name">RWHDERS</span><span class="signature">(mcConfiguration)</span>
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mcConfiguration</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">der_em_input_request</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">input_file_path</span> <span class="o">=</span> <span class="n">mcConfiguration</span><span class="o">.</span><span class="n">mc_file_directory</span> <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot;/RWHDERS Inputs/&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">input_identification_dict</span> <span class="o">=</span> <span class="p">{}</span>
</pre></div>

        </details>

    

                            </div>
                            <div id="RWHDERS.initialize_der_s" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#RWHDERS.initialize_der_s">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">initialize_der_s</span><span class="signature">(self)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">initialize_der_s</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function (with this specific name) is required in each DER-S used by the ME. The EDMCore&#39;s initialization</span>
<span class="sd">        process calls this function for each DER-S activated in MCConfig to perform initialization tasks. This does not</span>
<span class="sd">        include DER-EM assignment (see assign_der_s_to_der_em). In this case, all this function does is call</span>
<span class="sd">        the parse_input_file_names_for_assignment() function. See below.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parse_input_file_names_for_assignment</span><span class="p">()</span>
</pre></div>

        </details>

            <div class="docstring"><p>This function (with this specific name) is required in each DER-S used by the ME. The EDMCore's initialization
process calls this function for each DER-S activated in MCConfig to perform initialization tasks. This does not
include DER-EM assignment (see assign_der_s_to_der_em). In this case, all this function does is call
the parse_input_file_names_for_assignment() function. See below.</p>
</div>


                            </div>
                            <div id="RWHDERS.assign_der_s_to_der_em" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#RWHDERS.assign_der_s_to_der_em">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">assign_der_s_to_der_em</span><span class="signature">(self)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">assign_der_s_to_der_em</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function (with this specific name) is required in each DER-S used by the ME. The DERAssignmentHandler</span>
<span class="sd">        calls this function for each DER-S activated in MCConfig. This function&#39;s purpose is to take unique identifiers</span>
<span class="sd">        from each &quot;DER input&quot; for a given DER-S and &quot;associate&quot; them with the mRIDs for DER-EMs in the model. This is</span>
<span class="sd">        done using locational data: I.E. a specific DER input should be associated with the mRID of a DER-EM on a given</span>
<span class="sd">        bus. This function does those tasks using the input_identification_dict generated in the initialization process</span>
<span class="sd">        (see self.parse_input_file_names_for_assignment())</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;iid&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">input_identification_dict</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_identification_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">der_id</span> <span class="o">=</span> <span class="n">key</span>
            <span class="n">der_bus</span> <span class="o">=</span> <span class="n">value</span><span class="p">[</span><span class="s1">&#39;Bus&#39;</span><span class="p">]</span>
            <span class="n">der_mrid</span> <span class="o">=</span> <span class="n">derAssignmentHandler</span><span class="o">.</span><span class="n">get_mRID_for_der_on_bus</span><span class="p">(</span><span class="n">der_bus</span><span class="p">)</span>
            <span class="n">der_being_assigned</span> <span class="o">=</span> <span class="p">{</span><span class="n">der_id</span><span class="p">:</span> <span class="n">der_mrid</span><span class="p">}</span>
            <span class="n">derAssignmentHandler</span><span class="o">.</span><span class="n">append_new_values_to_association_table</span><span class="p">(</span><span class="n">der_being_assigned</span><span class="p">)</span>
</pre></div>

        </details>

            <div class="docstring"><p>This function (with this specific name) is required in each DER-S used by the ME. The DERAssignmentHandler
calls this function for each DER-S activated in MCConfig. This function's purpose is to take unique identifiers
from each "DER input" for a given DER-S and "associate" them with the mRIDs for DER-EMs in the model. This is
done using locational data: I.E. a specific DER input should be associated with the mRID of a DER-EM on a given
bus. This function does those tasks using the input_identification_dict generated in the initialization process
(see self.parse_input_file_names_for_assignment())</p>
</div>


                            </div>
                            <div id="RWHDERS.parse_input_file_names_for_assignment" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#RWHDERS.parse_input_file_names_for_assignment">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">parse_input_file_names_for_assignment</span><span class="signature">(self)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">parse_input_file_names_for_assignment</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function is called during the DER-S initialization process. It reads all the files in the RWHDERS Inputs</span>
<span class="sd">        folder and parses them into an input dictionary containing the unique ID, file name, and Bus location for each.</span>
<span class="sd">        These are used during assignment and each time step to &quot;connect the dots&quot; between the input file and the</span>
<span class="sd">        DER-EM which represents its data.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">filename_list</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">input_file_path</span><span class="p">)</span>
        <span class="n">parsed_filename_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">filename_list</span><span class="p">:</span>
            <span class="n">g</span> <span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)</span>
            <span class="n">g</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">g</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">5</span><span class="p">:]</span>
            <span class="n">g</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">g</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">3</span><span class="p">:</span><span class="mi">6</span><span class="p">]</span>
            <span class="n">parsed_filename_list</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="n">g</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span> <span class="p">{</span><span class="s2">&quot;Filepath&quot;</span><span class="p">:</span> <span class="n">i</span><span class="p">,</span> <span class="s2">&quot;Bus&quot;</span><span class="p">:</span> <span class="n">g</span><span class="p">[</span><span class="mi">1</span><span class="p">]}})</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">parsed_filename_list</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">input_identification_dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
</pre></div>

        </details>

            <div class="docstring"><p>This function is called during the DER-S initialization process. It reads all the files in the RWHDERS Inputs
folder and parses them into an input dictionary containing the unique ID, file name, and Bus location for each.
These are used during assignment and each time step to "connect the dots" between the input file and the
DER-EM which represents its data.</p>
</div>


                            </div>
                            <div id="RWHDERS.update_der_em_input_request" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#RWHDERS.update_der_em_input_request">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">update_der_em_input_request</span><span class="signature">(self)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">update_der_em_input_request</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reads the input data from each file in the input identification dict, and puts it in a list readable by the</span>
<span class="sd">        MCInputInterface.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">der_em_input_request</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_identification_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="kn">import</span> <span class="nn">csv</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">input_file_path</span> <span class="o">+</span> <span class="n">value</span><span class="p">[</span><span class="s1">&#39;Filepath&#39;</span><span class="p">],</span> <span class="n">newline</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">csvfile</span><span class="p">:</span>
                <span class="n">der_input_reader</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">reader</span><span class="p">(</span><span class="n">csvfile</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">der_input_reader</span><span class="p">:</span>
                    <span class="n">current_der_input</span> <span class="o">=</span> <span class="p">{</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span> <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]}</span>
                    <span class="nb">print</span><span class="p">(</span><span class="n">current_der_input</span><span class="p">)</span>
            <span class="n">current_der_real_power</span> <span class="o">=</span> <span class="n">current_der_input</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">]</span>
            <span class="n">current_der_input_request</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="p">:</span> <span class="n">current_der_real_power</span><span class="p">}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">der_em_input_request</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">current_der_input_request</span><span class="p">)</span>
</pre></div>

        </details>

            <div class="docstring"><p>Reads the input data from each file in the input identification dict, and puts it in a list readable by the
MCInputInterface.</p>
</div>


                            </div>
                            <div id="RWHDERS.get_input_request" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#RWHDERS.get_input_request">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">get_input_request</span><span class="signature">(self)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">get_input_request</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function (with this specific name) is required in each DER-S used by the ME. Accessor function that calls</span>
<span class="sd">        for an updated input request, then returns the updated request for use by the MCInputInterface</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_der_em_input_request</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">der_em_input_request</span>
</pre></div>

        </details>

            <div class="docstring"><p>This function (with this specific name) is required in each DER-S used by the ME. Accessor function that calls
for an updated input request, then returns the updated request for use by the MCInputInterface</p>
</div>


                            </div>
                </section>
                <section id="DERSHistoricalDataInput">
                                <div class="attr class">
        <a class="headerlink" href="#DERSHistoricalDataInput">#&nbsp;&nbsp</a>

        
        <span class="def">class</span>
        <span class="name">DERSHistoricalDataInput</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">DERSHistoricalDataInput</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The Historical Data DER-S. Sometimes referred to as &quot;manual input&quot;, this DER-S serves as a simple method to</span>
<span class="sd">    update DER-EMs manually at certain times with specific values, allowing the test engineer to write in grid states</span>
<span class="sd">    as needed by each simulation. Since DER-EMs are generic models, each historical data input could represent a single</span>
<span class="sd">    DER, groups of DERs, or even more abstract ideas such as massive power excursions.</span>

<span class="sd">    The input is a single .csv file, contained in the DERSHistoricalData Inputs folder. This .csv is timestamped and</span>
<span class="sd">    in a specific format; after the timestamp column, columns are in pairs, with each pair representing Power and Bus</span>
<span class="sd">    for each DER-EM. The bus is used for assignment, at which point the values are associated to DER-EMs by header</span>
<span class="sd">    names.</span>

<span class="sd">    Otherwise, it functions like any other DER-S: it has an initialization process, an assignment process, and on</span>
<span class="sd">    timestep updates.</span>

<span class="sd">    ATTRIBUTES:</span>
<span class="sd">        .der_em_input_request: Contains the new DER-EM states for this timestep, already parsed and put into list</span>
<span class="sd">           format by the function. The list is so multiple DER-EMs can be updated per timestep.</span>

<span class="sd">        .input_file_path: The folder in which the DERSHistoricalDataInput files are located.</span>

<span class="sd">        .input_table: The input files are in .csv format; the csv reader reads these files into a table here.</span>

<span class="sd">        .list_of_ders: The DER names read from the header of the input table.</span>

<span class="sd">        .location_lookup_dictionary: A dictionary associating the DER unique identifiers with the bus they should</span>
<span class="sd">           be assigned to.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mcConfiguration</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">der_em_input_request</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">historical_data_file_path</span> <span class="o">=</span> <span class="n">mcConfiguration</span><span class="o">.</span><span class="n">mc_file_directory</span> <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot;DERSHistoricalData Inputs/2p_input2.csv&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">input_table</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">list_of_ders</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">location_lookup_dictionary</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="nf">initialize_der_s</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function (with this specific name) is required in each DER-S used by the ME. The EDMCore&#39;s initialization</span>
<span class="sd">        process calls this function for each DER-S activated in MCConfig to perform initialization tasks. This does not</span>
<span class="sd">        include DER-EM assignment (see assign_der_s_to_der_em). In this case, all this function does is call</span>
<span class="sd">        the read_input_file() function. See below.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read_input_file</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">get_input_request</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function (with this specific name) is required in each DER-S used by the ME. Accessor function that calls</span>
<span class="sd">        for an updated input request, then returns the updated request for use by the MCInputInterface</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_der_em_input_request</span><span class="p">()</span>
        <span class="c1"># print(&quot;DER EM INPUT REQUEST&quot;)</span>
        <span class="c1"># print(self.der_em_input_request)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">der_em_input_request</span>

    <span class="k">def</span> <span class="nf">assign_der_s_to_der_em</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function (with this specific name) is required in each DER-S used by the ME. The DERAssignmentHandler</span>
<span class="sd">        calls this function for each DER-S activated in MCConfig. This function&#39;s purpose is to take unique identifiers</span>
<span class="sd">        from each &quot;DER input&quot; for a given DER-S and &quot;associate&quot; them with the mRIDs for DER-EMs in the model. This is</span>
<span class="sd">        done using locational data: I.E. a specific DER input should be associated with the mRID of a DER-EM on a given</span>
<span class="sd">        bus.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">list_of_ders</span><span class="p">:</span>
            <span class="n">der_being_assigned</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">der_being_assigned</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_table</span><span class="p">[</span><span class="mi">0</span><span class="p">][(</span><span class="bp">self</span><span class="o">.</span><span class="n">location_lookup_dictionary</span><span class="p">[</span><span class="n">i</span><span class="p">])]</span>
            <span class="n">der_being_assigned</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">derAssignmentHandler</span><span class="o">.</span><span class="n">get_mRID_for_der_on_bus</span><span class="p">(</span><span class="n">der_being_assigned</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="n">assigned_der</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">([(</span><span class="n">value</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span> <span class="k">for</span> <span class="n">value</span><span class="p">,</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">der_being_assigned</span><span class="o">.</span><span class="n">items</span><span class="p">()])</span>
            <span class="n">derAssignmentHandler</span><span class="o">.</span><span class="n">append_new_values_to_association_table</span><span class="p">(</span><span class="n">assigned_der</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">open_input_file</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Opens the historical data input file, read it as a .csv file, and parses it into a list of dicts.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">historical_data_file_path</span><span class="p">)</span> <span class="k">as</span> <span class="n">csvfile</span><span class="p">:</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">DictReader</span><span class="p">(</span><span class="n">csvfile</span><span class="p">)</span>
            <span class="n">x</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">r</span><span class="p">:</span>
                <span class="n">row</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
                <span class="n">x</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Historical data file opened&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">x</span>

    <span class="k">def</span> <span class="nf">read_input_file</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reads and parses the input file. Places all the input information in input_table. Also, parses the</span>
<span class="sd">        .csv file to determine the names and locations of each DER: when the timestamp column is removed, odd column</span>
<span class="sd">        headers are names and even headers are their associated locations. These lists are converted to a list</span>
<span class="sd">        of dictionaries to be passed to the assignment handler (which takes the locations for each DER name and assigns</span>
<span class="sd">        a DER-EM mRID at the proper location to the name, this allows the MC to provide updated DER states to the DER-EM</span>
<span class="sd">        without requiring the inputs to know DER-EM mRIDs.)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">input_table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">open_input_file</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Retrieving locational data:&quot;</span><span class="p">)</span>
        <span class="n">first_row</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">item</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_table</span><span class="p">)</span>
        <span class="n">first_row</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">first_row</span><span class="p">)</span>
        <span class="n">first_row</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;Time&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;First row:&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">first_row</span><span class="p">)</span>
        <span class="n">log_der_keys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">first_row</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">log_der_keys</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">log_der_keys</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">der_name</span> <span class="o">=</span> <span class="n">log_der_keys</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">der_loc</span> <span class="o">=</span> <span class="n">log_der_keys</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">location_lookup_dictionary</span><span class="p">[</span><span class="n">der_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">der_loc</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Current dict:&quot;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">location_lookup_dictionary</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">list_of_ders</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">location_lookup_dictionary</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;List of DERS:&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">list_of_ders</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">update_der_em_input_request</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Checks the current simulation time against the input table. If a new input exists for the current timestep,</span>
<span class="sd">        it is read, converted into an input dictionary, and put in the current der_input_request</span>
<span class="sd">        (see MCInputInterface.get_all_der_s_input_requests() )</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">der_em_input_request</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">input_at_time_now</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">item</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_table</span> <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">edmCore</span><span class="o">.</span><span class="n">sim_current_time</span><span class="p">)</span> <span class="o">&lt;=</span>
                                     <span class="nb">int</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="s1">&#39;Time&#39;</span><span class="p">])</span> <span class="o">&lt;</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">edmCore</span><span class="o">.</span><span class="n">sim_current_time</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Updating DER-EMs from historical data.&quot;</span><span class="p">)</span>
            <span class="n">input_at_time_now</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">input_at_time_now</span><span class="p">)</span>
            <span class="n">input_at_time_now</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;Time&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">list_of_ders</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">der_em_input_request</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="n">i</span><span class="p">:</span> <span class="n">input_at_time_now</span><span class="p">[</span><span class="n">i</span><span class="p">]})</span>
        <span class="k">except</span> <span class="ne">StopIteration</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;End of input data.&quot;</span><span class="p">)</span>
            <span class="k">return</span>
</pre></div>

        </details>

            <div class="docstring"><p>The Historical Data DER-S. Sometimes referred to as "manual input", this DER-S serves as a simple method to
update DER-EMs manually at certain times with specific values, allowing the test engineer to write in grid states
as needed by each simulation. Since DER-EMs are generic models, each historical data input could represent a single
DER, groups of DERs, or even more abstract ideas such as massive power excursions.</p>

<p>The input is a single .csv file, contained in the DERSHistoricalData Inputs folder. This .csv is timestamped and
in a specific format; after the timestamp column, columns are in pairs, with each pair representing Power and Bus
for each DER-EM. The bus is used for assignment, at which point the values are associated to DER-EMs by header
names.</p>

<p>Otherwise, it functions like any other DER-S: it has an initialization process, an assignment process, and on
timestep updates.</p>

<p>ATTRIBUTES:
    .der_em_input_request: Contains the new DER-EM states for this timestep, already parsed and put into list
       format by the function. The list is so multiple DER-EMs can be updated per timestep.</p>

<pre><code>.input_file_path: The folder in which the DERSHistoricalDataInput files are located.

.input_table: The input files are in .csv format; the csv reader reads these files into a table here.

.list_of_ders: The DER names read from the header of the input table.

.location_lookup_dictionary: A dictionary associating the DER unique identifiers with the bus they should
   be assigned to.
</code></pre>
</div>


                            <div id="DERSHistoricalDataInput.__init__" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#DERSHistoricalDataInput.__init__">#&nbsp;&nbsp</a>

        
            <span class="name">DERSHistoricalDataInput</span><span class="signature">(mcConfiguration)</span>
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mcConfiguration</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">der_em_input_request</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">historical_data_file_path</span> <span class="o">=</span> <span class="n">mcConfiguration</span><span class="o">.</span><span class="n">mc_file_directory</span> <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot;DERSHistoricalData Inputs/2p_input2.csv&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">input_table</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">list_of_ders</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">location_lookup_dictionary</span> <span class="o">=</span> <span class="p">{}</span>
</pre></div>

        </details>

    

                            </div>
                            <div id="DERSHistoricalDataInput.initialize_der_s" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#DERSHistoricalDataInput.initialize_der_s">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">initialize_der_s</span><span class="signature">(self)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">initialize_der_s</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function (with this specific name) is required in each DER-S used by the ME. The EDMCore&#39;s initialization</span>
<span class="sd">        process calls this function for each DER-S activated in MCConfig to perform initialization tasks. This does not</span>
<span class="sd">        include DER-EM assignment (see assign_der_s_to_der_em). In this case, all this function does is call</span>
<span class="sd">        the read_input_file() function. See below.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read_input_file</span><span class="p">()</span>
</pre></div>

        </details>

            <div class="docstring"><p>This function (with this specific name) is required in each DER-S used by the ME. The EDMCore's initialization
process calls this function for each DER-S activated in MCConfig to perform initialization tasks. This does not
include DER-EM assignment (see assign_der_s_to_der_em). In this case, all this function does is call
the read_input_file() function. See below.</p>
</div>


                            </div>
                            <div id="DERSHistoricalDataInput.get_input_request" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#DERSHistoricalDataInput.get_input_request">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">get_input_request</span><span class="signature">(self)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">get_input_request</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function (with this specific name) is required in each DER-S used by the ME. Accessor function that calls</span>
<span class="sd">        for an updated input request, then returns the updated request for use by the MCInputInterface</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_der_em_input_request</span><span class="p">()</span>
        <span class="c1"># print(&quot;DER EM INPUT REQUEST&quot;)</span>
        <span class="c1"># print(self.der_em_input_request)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">der_em_input_request</span>
</pre></div>

        </details>

            <div class="docstring"><p>This function (with this specific name) is required in each DER-S used by the ME. Accessor function that calls
for an updated input request, then returns the updated request for use by the MCInputInterface</p>
</div>


                            </div>
                            <div id="DERSHistoricalDataInput.assign_der_s_to_der_em" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#DERSHistoricalDataInput.assign_der_s_to_der_em">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">assign_der_s_to_der_em</span><span class="signature">(self)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">assign_der_s_to_der_em</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function (with this specific name) is required in each DER-S used by the ME. The DERAssignmentHandler</span>
<span class="sd">        calls this function for each DER-S activated in MCConfig. This function&#39;s purpose is to take unique identifiers</span>
<span class="sd">        from each &quot;DER input&quot; for a given DER-S and &quot;associate&quot; them with the mRIDs for DER-EMs in the model. This is</span>
<span class="sd">        done using locational data: I.E. a specific DER input should be associated with the mRID of a DER-EM on a given</span>
<span class="sd">        bus.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">list_of_ders</span><span class="p">:</span>
            <span class="n">der_being_assigned</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">der_being_assigned</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_table</span><span class="p">[</span><span class="mi">0</span><span class="p">][(</span><span class="bp">self</span><span class="o">.</span><span class="n">location_lookup_dictionary</span><span class="p">[</span><span class="n">i</span><span class="p">])]</span>
            <span class="n">der_being_assigned</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">derAssignmentHandler</span><span class="o">.</span><span class="n">get_mRID_for_der_on_bus</span><span class="p">(</span><span class="n">der_being_assigned</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="n">assigned_der</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">([(</span><span class="n">value</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span> <span class="k">for</span> <span class="n">value</span><span class="p">,</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">der_being_assigned</span><span class="o">.</span><span class="n">items</span><span class="p">()])</span>
            <span class="n">derAssignmentHandler</span><span class="o">.</span><span class="n">append_new_values_to_association_table</span><span class="p">(</span><span class="n">assigned_der</span><span class="p">)</span>
</pre></div>

        </details>

            <div class="docstring"><p>This function (with this specific name) is required in each DER-S used by the ME. The DERAssignmentHandler
calls this function for each DER-S activated in MCConfig. This function's purpose is to take unique identifiers
from each "DER input" for a given DER-S and "associate" them with the mRIDs for DER-EMs in the model. This is
done using locational data: I.E. a specific DER input should be associated with the mRID of a DER-EM on a given
bus.</p>
</div>


                            </div>
                            <div id="DERSHistoricalDataInput.open_input_file" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#DERSHistoricalDataInput.open_input_file">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">open_input_file</span><span class="signature">(self)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">open_input_file</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Opens the historical data input file, read it as a .csv file, and parses it into a list of dicts.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">historical_data_file_path</span><span class="p">)</span> <span class="k">as</span> <span class="n">csvfile</span><span class="p">:</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">DictReader</span><span class="p">(</span><span class="n">csvfile</span><span class="p">)</span>
            <span class="n">x</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">r</span><span class="p">:</span>
                <span class="n">row</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
                <span class="n">x</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Historical data file opened&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">x</span>
</pre></div>

        </details>

            <div class="docstring"><p>Opens the historical data input file, read it as a .csv file, and parses it into a list of dicts.</p>
</div>


                            </div>
                            <div id="DERSHistoricalDataInput.read_input_file" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#DERSHistoricalDataInput.read_input_file">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">read_input_file</span><span class="signature">(self)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">read_input_file</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reads and parses the input file. Places all the input information in input_table. Also, parses the</span>
<span class="sd">        .csv file to determine the names and locations of each DER: when the timestamp column is removed, odd column</span>
<span class="sd">        headers are names and even headers are their associated locations. These lists are converted to a list</span>
<span class="sd">        of dictionaries to be passed to the assignment handler (which takes the locations for each DER name and assigns</span>
<span class="sd">        a DER-EM mRID at the proper location to the name, this allows the MC to provide updated DER states to the DER-EM</span>
<span class="sd">        without requiring the inputs to know DER-EM mRIDs.)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">input_table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">open_input_file</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Retrieving locational data:&quot;</span><span class="p">)</span>
        <span class="n">first_row</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">item</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_table</span><span class="p">)</span>
        <span class="n">first_row</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">first_row</span><span class="p">)</span>
        <span class="n">first_row</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;Time&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;First row:&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">first_row</span><span class="p">)</span>
        <span class="n">log_der_keys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">first_row</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">log_der_keys</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">log_der_keys</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">der_name</span> <span class="o">=</span> <span class="n">log_der_keys</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">der_loc</span> <span class="o">=</span> <span class="n">log_der_keys</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">location_lookup_dictionary</span><span class="p">[</span><span class="n">der_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">der_loc</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Current dict:&quot;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">location_lookup_dictionary</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">list_of_ders</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">location_lookup_dictionary</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;List of DERS:&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">list_of_ders</span><span class="p">)</span>
</pre></div>

        </details>

            <div class="docstring"><p>Reads and parses the input file. Places all the input information in input_table. Also, parses the
.csv file to determine the names and locations of each DER: when the timestamp column is removed, odd column
headers are names and even headers are their associated locations. These lists are converted to a list
of dictionaries to be passed to the assignment handler (which takes the locations for each DER name and assigns
a DER-EM mRID at the proper location to the name, this allows the MC to provide updated DER states to the DER-EM
without requiring the inputs to know DER-EM mRIDs.)</p>
</div>


                            </div>
                            <div id="DERSHistoricalDataInput.update_der_em_input_request" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#DERSHistoricalDataInput.update_der_em_input_request">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">update_der_em_input_request</span><span class="signature">(self)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">update_der_em_input_request</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Checks the current simulation time against the input table. If a new input exists for the current timestep,</span>
<span class="sd">        it is read, converted into an input dictionary, and put in the current der_input_request</span>
<span class="sd">        (see MCInputInterface.get_all_der_s_input_requests() )</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">der_em_input_request</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">input_at_time_now</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">item</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_table</span> <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">edmCore</span><span class="o">.</span><span class="n">sim_current_time</span><span class="p">)</span> <span class="o">&lt;=</span>
                                     <span class="nb">int</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="s1">&#39;Time&#39;</span><span class="p">])</span> <span class="o">&lt;</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">edmCore</span><span class="o">.</span><span class="n">sim_current_time</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Updating DER-EMs from historical data.&quot;</span><span class="p">)</span>
            <span class="n">input_at_time_now</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">input_at_time_now</span><span class="p">)</span>
            <span class="n">input_at_time_now</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;Time&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">list_of_ders</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">der_em_input_request</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="n">i</span><span class="p">:</span> <span class="n">input_at_time_now</span><span class="p">[</span><span class="n">i</span><span class="p">]})</span>
        <span class="k">except</span> <span class="ne">StopIteration</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;End of input data.&quot;</span><span class="p">)</span>
            <span class="k">return</span>
</pre></div>

        </details>

            <div class="docstring"><p>Checks the current simulation time against the input table. If a new input exists for the current timestep,
it is read, converted into an input dictionary, and put in the current der_input_request
(see MCInputInterface.get_all_der_s_input_requests() )</p>
</div>


                            </div>
                </section>
                <section id="DERIdentificationManager">
                                <div class="attr class">
        <a class="headerlink" href="#DERIdentificationManager">#&nbsp;&nbsp</a>

        
        <span class="def">class</span>
        <span class="name">DERIdentificationManager</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">DERIdentificationManager</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This class manages the input association lookup table generated by the DERSAssignmentHandler. The accessor methods</span>
<span class="sd">    allow input unique IDs to be looked up for a given DER-EM mRID, or vice versa. The table is generated during the</span>
<span class="sd">    assignment process (see DERAssignmentHandler).</span>

<span class="sd">    ATTRIBUTES:</span>
<span class="sd">        .association_lookup_table: a list of dictionaries containing association data, read from the</span>
<span class="sd">            DERAssignmentHandler after the startup process is complete. Used to connect the unique identifiers of</span>
<span class="sd">            DER inputs (whatever form they might take) to mRIDs for their assigned DER-EMs.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">association_lookup_table</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">get_meas_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mrid</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        ACCESSOR FUNCTION: Returns a unique identifier for a given DER-EM mRID. If none found, the DER-EM was never</span>
<span class="sd">        assigned, and &#39;Unassigned&#39; is returned instead.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">association_lookup_table</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">i</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">value</span> <span class="o">==</span> <span class="n">mrid</span><span class="p">:</span>
                    <span class="n">input_unique_id</span> <span class="o">=</span> <span class="n">key</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">input_unique_id</span>
        <span class="k">except</span> <span class="ne">UnboundLocalError</span><span class="p">:</span>
            <span class="k">return</span> <span class="s1">&#39;Unassigned&#39;</span>

    <span class="k">def</span> <span class="nf">get_der_em_mrid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        ACCESSOR FUNCTION: Returns the associated DER-EM control mRID for a given input unique identifier. Unlike</span>
<span class="sd">        get_meas_name(), if none is found that signifies a critical error with the DERSAssignmentHandler.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">x</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">d</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">d</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">association_lookup_table</span><span class="p">)</span> <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">d</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">x</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">initialize_association_lookup_table</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieves the association table from the assignment handler.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">association_lookup_table</span> <span class="o">=</span> <span class="n">derAssignmentHandler</span><span class="o">.</span><span class="n">association_table</span>
</pre></div>

        </details>

            <div class="docstring"><p>This class manages the input association lookup table generated by the DERSAssignmentHandler. The accessor methods
allow input unique IDs to be looked up for a given DER-EM mRID, or vice versa. The table is generated during the
assignment process (see DERAssignmentHandler).</p>

<p>ATTRIBUTES:
    .association_lookup_table: a list of dictionaries containing association data, read from the
        DERAssignmentHandler after the startup process is complete. Used to connect the unique identifiers of
        DER inputs (whatever form they might take) to mRIDs for their assigned DER-EMs.</p>
</div>


                            <div id="DERIdentificationManager.__init__" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#DERIdentificationManager.__init__">#&nbsp;&nbsp</a>

        
            <span class="name">DERIdentificationManager</span><span class="signature">()</span>
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">association_lookup_table</span> <span class="o">=</span> <span class="kc">None</span>
</pre></div>

        </details>

    

                            </div>
                            <div id="DERIdentificationManager.get_meas_name" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#DERIdentificationManager.get_meas_name">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">get_meas_name</span><span class="signature">(self, mrid)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">get_meas_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mrid</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        ACCESSOR FUNCTION: Returns a unique identifier for a given DER-EM mRID. If none found, the DER-EM was never</span>
<span class="sd">        assigned, and &#39;Unassigned&#39; is returned instead.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">association_lookup_table</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">i</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">value</span> <span class="o">==</span> <span class="n">mrid</span><span class="p">:</span>
                    <span class="n">input_unique_id</span> <span class="o">=</span> <span class="n">key</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">input_unique_id</span>
        <span class="k">except</span> <span class="ne">UnboundLocalError</span><span class="p">:</span>
            <span class="k">return</span> <span class="s1">&#39;Unassigned&#39;</span>
</pre></div>

        </details>

            <div class="docstring"><p>ACCESSOR FUNCTION: Returns a unique identifier for a given DER-EM mRID. If none found, the DER-EM was never
assigned, and 'Unassigned' is returned instead.</p>
</div>


                            </div>
                            <div id="DERIdentificationManager.get_der_em_mrid" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#DERIdentificationManager.get_der_em_mrid">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">get_der_em_mrid</span><span class="signature">(self, name)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">get_der_em_mrid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        ACCESSOR FUNCTION: Returns the associated DER-EM control mRID for a given input unique identifier. Unlike</span>
<span class="sd">        get_meas_name(), if none is found that signifies a critical error with the DERSAssignmentHandler.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">x</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">d</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">d</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">association_lookup_table</span><span class="p">)</span> <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">d</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">x</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
</pre></div>

        </details>

            <div class="docstring"><p>ACCESSOR FUNCTION: Returns the associated DER-EM control mRID for a given input unique identifier. Unlike
get_meas_name(), if none is found that signifies a critical error with the DERSAssignmentHandler.</p>
</div>


                            </div>
                            <div id="DERIdentificationManager.initialize_association_lookup_table" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#DERIdentificationManager.initialize_association_lookup_table">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">initialize_association_lookup_table</span><span class="signature">(self)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">initialize_association_lookup_table</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieves the association table from the assignment handler.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">association_lookup_table</span> <span class="o">=</span> <span class="n">derAssignmentHandler</span><span class="o">.</span><span class="n">association_table</span>
</pre></div>

        </details>

            <div class="docstring"><p>Retrieves the association table from the assignment handler.</p>
</div>


                            </div>
                </section>
                <section id="DERAssignmentHandler">
                                <div class="attr class">
        <a class="headerlink" href="#DERAssignmentHandler">#&nbsp;&nbsp</a>

        
        <span class="def">class</span>
        <span class="name">DERAssignmentHandler</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">DERAssignmentHandler</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This class is used during the MC startup process. DER-S inputs will not know the mRIDs of DER-EMs since those</span>
<span class="sd">    are internal to the EDM. As such, a process is required to assign each incoming DER input to an appropriate DER-EM</span>
<span class="sd">    mRID, so that it&#39;s states can be updated in the model. Each DER-S DER unit requires a unique identifier (a name, a</span>
<span class="sd">    unique number, etc.) and a &quot;location&quot; on the grid, generally the bus it&#39;s located on. The assignment handler</span>
<span class="sd">    receives as input a list of {uniqueID:location} dictionaries, uses the location values to look up the DER-EMs on the</span>
<span class="sd">    appropriate bus, and assigns each unique identifier to an individual DER-EM. These associations are passed to the</span>
<span class="sd">    Identification Manager; during the simulation, new inputs from each unique ID sent to the input manager, which</span>
<span class="sd">    automatically looks up the appropriate mRID for the associated DER-EM and sends the inputs there.</span>

<span class="sd">    ATTRIBUTES:</span>
<span class="sd">        .assignment_lookup_table: contains a list of dictionaries containing mRID, name, and Bus of each DER-EM within</span>
<span class="sd">            the model.</span>

<span class="sd">        .assignment_table: a redundant assignment_lookup_table, used during the assignment process in order to prevent</span>
<span class="sd">            modification to the original assignment lookup table (which will still need to be used by the output</span>
<span class="sd">            branch).</span>

<span class="sd">        .association_table: Contains association data provided by each DER-S class, for use by the</span>
<span class="sd">            DERIdentificationManager.</span>

<span class="sd">        .der_em_mrid_per_bus_query_message: SPARQL Query used to gather the DER-EM info for the assignment tables.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assignment_lookup_table</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assignment_table</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">association_table</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">der_em_mrid_per_bus_query_message</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot; </span>
<span class="s2">        PREFIX r:  &lt;http://www.w3.org/1999/02/22-rdf-syntax-ns#&gt;</span>
<span class="s2">        PREFIX c:  &lt;http://iec.ch/TC57/CIM100#&gt;</span>
<span class="s2">        SELECT ?name ?id ?bus ?ratedS ?ratedU ?ipu ?p ?q ?fdrid (group_concat(distinct ?phs;separator=&quot;</span><span class="se">\\</span><span class="s2">n&quot;) as ?phases) WHERE {</span>
<span class="s2">         ?s r:type c:BatteryUnit.</span>
<span class="s2">         ?s c:IdentifiedObject.name ?name.</span>
<span class="s2">          ?s c:IdentifiedObject.mRID ?id.</span>
<span class="s2">         ?pec c:PowerElectronicsConnection.PowerElectronicsUnit ?s.</span>
<span class="s2">        # feeder selection options - if all commented out, query matches all feeders</span>
<span class="s2">        #VALUES ?fdrid {&quot;_C1C3E687-6FFD-C753-582B-632A27E28507&quot;}  # 123 bus</span>
<span class="s2">        VALUES ?fdrid {&quot;_49AD8E07-3BF9-A4E2-CB8F-C3722F837B62&quot;}  # 13 bus</span>
<span class="s2">         ?pec c:Equipment.EquipmentContainer ?fdr.</span>
<span class="s2">         ?fdr c:IdentifiedObject.mRID ?fdrid.</span>
<span class="s2">         ?pec c:PowerElectronicsConnection.ratedS ?ratedS.</span>
<span class="s2">         ?pec c:PowerElectronicsConnection.ratedU ?ratedU.</span>
<span class="s2">         ?pec c:PowerElectronicsConnection.maxIFault ?ipu.</span>
<span class="s2">         ?pec c:PowerElectronicsConnection.p ?p.</span>
<span class="s2">         ?pec c:PowerElectronicsConnection.q ?q.</span>
<span class="s2">         OPTIONAL {?pecp c:PowerElectronicsConnectionPhase.PowerElectronicsConnection ?pec.</span>
<span class="s2">         ?pecp c:PowerElectronicsConnectionPhase.phase ?phsraw.</span>
<span class="s2">           bind(strafter(str(?phsraw),&quot;SinglePhaseKind.&quot;) as ?phs) }</span>
<span class="s2">         ?t c:Terminal.ConductingEquipment ?pec.</span>
<span class="s2">         ?t c:Terminal.ConnectivityNode ?cn.</span>
<span class="s2">         ?cn c:IdentifiedObject.name ?bus</span>
<span class="s2">        }</span>
<span class="s2">        GROUP by ?name ?id ?bus ?ratedS ?ratedU ?ipu ?p ?q ?fdrid</span>
<span class="s2">        ORDER by ?name</span>
<span class="s2">        &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">get_assignment_lookup_table</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        ACCESSOR: Returns the assignment lookup table. Used in the message appendage process.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">assignment_lookup_table</span>

    <span class="k">def</span> <span class="nf">create_assignment_lookup_table</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Runs an extended SPARQL query on the database and parses it into the assignment lookup table: that is, the names</span>
<span class="sd">        and mRIDs of all DER-EMs on each bus in the current model.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">der_em_mrid_per_bus_query_output</span> <span class="o">=</span> <span class="n">edmCore</span><span class="o">.</span><span class="n">gapps_session</span><span class="o">.</span><span class="n">query_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">der_em_mrid_per_bus_query_message</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">der_em_mrid_per_bus_query_output</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;results&#39;</span><span class="p">][</span><span class="s1">&#39;bindings&#39;</span><span class="p">])):</span>
            <span class="n">x</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;Name&#39;</span><span class="p">:</span> <span class="n">der_em_mrid_per_bus_query_output</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;results&#39;</span><span class="p">][</span><span class="s1">&#39;bindings&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">][</span><span class="s1">&#39;value&#39;</span><span class="p">],</span>
                      <span class="s1">&#39;Bus&#39;</span><span class="p">:</span> <span class="n">der_em_mrid_per_bus_query_output</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;results&#39;</span><span class="p">][</span><span class="s1">&#39;bindings&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;bus&#39;</span><span class="p">][</span><span class="s1">&#39;value&#39;</span><span class="p">],</span>
                      <span class="s1">&#39;mRID&#39;</span><span class="p">:</span> <span class="n">der_em_mrid_per_bus_query_output</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;results&#39;</span><span class="p">][</span><span class="s1">&#39;bindings&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;id&#39;</span><span class="p">][</span><span class="s1">&#39;value&#39;</span><span class="p">]})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assignment_lookup_table</span> <span class="o">=</span> <span class="n">x</span>

    <span class="k">def</span> <span class="nf">assign_all_ders</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calls the assignment process for each DER-S. Uses the DER-S list from MCConfiguration, so no additions are</span>
<span class="sd">        needed here if new DER-Ss are added.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assignment_table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assignment_lookup_table</span>

        <span class="c1"># Object list contains string names of objects. eval() lets us use these to call the methods for the proper obj</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">mcConfiguration</span><span class="o">.</span><span class="n">ders_obj_list</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="nb">eval</span><span class="p">(</span><span class="n">value</span><span class="p">)</span><span class="o">.</span><span class="n">assign_der_s_to_der_em</span><span class="p">()</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;DER Assignment complete.&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">association_table</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_mRID_for_der_on_bus</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Bus</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        For a given Bus, checks if a DER-EM exists on that bus and is available for assignment. If so, returns its mRID</span>
<span class="sd">        and removes it from the list (so a DER-EM can&#39;t be assigned twice).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Getting mRID for a der on bus:&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">Bus</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">next_mrid_on_bus</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">item</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">assignment_table</span> <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;Bus&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="nb">str</span><span class="p">(</span><span class="n">Bus</span><span class="p">))</span>
            <span class="n">mrid</span> <span class="o">=</span> <span class="n">next_mrid_on_bus</span><span class="p">[</span><span class="s1">&#39;mRID&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assignment_table</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">assignment_table</span> <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="s1">&#39;mRID&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">mrid</span><span class="p">)]</span>
        <span class="k">except</span> <span class="ne">StopIteration</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;FATAL ERROR: Attempting to assign a DER to a nonexistant DER-EM. &quot;</span>
                  <span class="s2">&quot;The bus may be wrong, or may not contain enough DER-EMs. Verify test.&quot;</span><span class="p">)</span>
            <span class="n">quit</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">next_mrid_on_bus</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">mrid</span>

    <span class="k">def</span> <span class="nf">append_new_values_to_association_table</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Used by DER-S classes to add new values to the association table during initialization.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">association_table</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
</pre></div>

        </details>

            <div class="docstring"><p>This class is used during the MC startup process. DER-S inputs will not know the mRIDs of DER-EMs since those
are internal to the EDM. As such, a process is required to assign each incoming DER input to an appropriate DER-EM
mRID, so that it's states can be updated in the model. Each DER-S DER unit requires a unique identifier (a name, a
unique number, etc.) and a "location" on the grid, generally the bus it's located on. The assignment handler
receives as input a list of {uniqueID:location} dictionaries, uses the location values to look up the DER-EMs on the
appropriate bus, and assigns each unique identifier to an individual DER-EM. These associations are passed to the
Identification Manager; during the simulation, new inputs from each unique ID sent to the input manager, which
automatically looks up the appropriate mRID for the associated DER-EM and sends the inputs there.</p>

<p>ATTRIBUTES:
    .assignment_lookup_table: contains a list of dictionaries containing mRID, name, and Bus of each DER-EM within
        the model.</p>

<pre><code>.assignment_table: a redundant assignment_lookup_table, used during the assignment process in order to prevent
    modification to the original assignment lookup table (which will still need to be used by the output
    branch).

.association_table: Contains association data provided by each DER-S class, for use by the
    DERIdentificationManager.

.der_em_mrid_per_bus_query_message: SPARQL Query used to gather the DER-EM info for the assignment tables.
</code></pre>
</div>


                            <div id="DERAssignmentHandler.__init__" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#DERAssignmentHandler.__init__">#&nbsp;&nbsp</a>

        
            <span class="name">DERAssignmentHandler</span><span class="signature">()</span>
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assignment_lookup_table</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assignment_table</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">association_table</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">der_em_mrid_per_bus_query_message</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot; </span>
<span class="s2">        PREFIX r:  &lt;http://www.w3.org/1999/02/22-rdf-syntax-ns#&gt;</span>
<span class="s2">        PREFIX c:  &lt;http://iec.ch/TC57/CIM100#&gt;</span>
<span class="s2">        SELECT ?name ?id ?bus ?ratedS ?ratedU ?ipu ?p ?q ?fdrid (group_concat(distinct ?phs;separator=&quot;</span><span class="se">\\</span><span class="s2">n&quot;) as ?phases) WHERE {</span>
<span class="s2">         ?s r:type c:BatteryUnit.</span>
<span class="s2">         ?s c:IdentifiedObject.name ?name.</span>
<span class="s2">          ?s c:IdentifiedObject.mRID ?id.</span>
<span class="s2">         ?pec c:PowerElectronicsConnection.PowerElectronicsUnit ?s.</span>
<span class="s2">        # feeder selection options - if all commented out, query matches all feeders</span>
<span class="s2">        #VALUES ?fdrid {&quot;_C1C3E687-6FFD-C753-582B-632A27E28507&quot;}  # 123 bus</span>
<span class="s2">        VALUES ?fdrid {&quot;_49AD8E07-3BF9-A4E2-CB8F-C3722F837B62&quot;}  # 13 bus</span>
<span class="s2">         ?pec c:Equipment.EquipmentContainer ?fdr.</span>
<span class="s2">         ?fdr c:IdentifiedObject.mRID ?fdrid.</span>
<span class="s2">         ?pec c:PowerElectronicsConnection.ratedS ?ratedS.</span>
<span class="s2">         ?pec c:PowerElectronicsConnection.ratedU ?ratedU.</span>
<span class="s2">         ?pec c:PowerElectronicsConnection.maxIFault ?ipu.</span>
<span class="s2">         ?pec c:PowerElectronicsConnection.p ?p.</span>
<span class="s2">         ?pec c:PowerElectronicsConnection.q ?q.</span>
<span class="s2">         OPTIONAL {?pecp c:PowerElectronicsConnectionPhase.PowerElectronicsConnection ?pec.</span>
<span class="s2">         ?pecp c:PowerElectronicsConnectionPhase.phase ?phsraw.</span>
<span class="s2">           bind(strafter(str(?phsraw),&quot;SinglePhaseKind.&quot;) as ?phs) }</span>
<span class="s2">         ?t c:Terminal.ConductingEquipment ?pec.</span>
<span class="s2">         ?t c:Terminal.ConnectivityNode ?cn.</span>
<span class="s2">         ?cn c:IdentifiedObject.name ?bus</span>
<span class="s2">        }</span>
<span class="s2">        GROUP by ?name ?id ?bus ?ratedS ?ratedU ?ipu ?p ?q ?fdrid</span>
<span class="s2">        ORDER by ?name</span>
<span class="s2">        &quot;&quot;&quot;</span>
</pre></div>

        </details>

    

                            </div>
                            <div id="DERAssignmentHandler.get_assignment_lookup_table" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#DERAssignmentHandler.get_assignment_lookup_table">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">get_assignment_lookup_table</span><span class="signature">(self)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">get_assignment_lookup_table</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        ACCESSOR: Returns the assignment lookup table. Used in the message appendage process.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">assignment_lookup_table</span>
</pre></div>

        </details>

            <div class="docstring"><p>ACCESSOR: Returns the assignment lookup table. Used in the message appendage process.</p>
</div>


                            </div>
                            <div id="DERAssignmentHandler.create_assignment_lookup_table" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#DERAssignmentHandler.create_assignment_lookup_table">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">create_assignment_lookup_table</span><span class="signature">(self)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">create_assignment_lookup_table</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Runs an extended SPARQL query on the database and parses it into the assignment lookup table: that is, the names</span>
<span class="sd">        and mRIDs of all DER-EMs on each bus in the current model.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">der_em_mrid_per_bus_query_output</span> <span class="o">=</span> <span class="n">edmCore</span><span class="o">.</span><span class="n">gapps_session</span><span class="o">.</span><span class="n">query_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">der_em_mrid_per_bus_query_message</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">der_em_mrid_per_bus_query_output</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;results&#39;</span><span class="p">][</span><span class="s1">&#39;bindings&#39;</span><span class="p">])):</span>
            <span class="n">x</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;Name&#39;</span><span class="p">:</span> <span class="n">der_em_mrid_per_bus_query_output</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;results&#39;</span><span class="p">][</span><span class="s1">&#39;bindings&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">][</span><span class="s1">&#39;value&#39;</span><span class="p">],</span>
                      <span class="s1">&#39;Bus&#39;</span><span class="p">:</span> <span class="n">der_em_mrid_per_bus_query_output</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;results&#39;</span><span class="p">][</span><span class="s1">&#39;bindings&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;bus&#39;</span><span class="p">][</span><span class="s1">&#39;value&#39;</span><span class="p">],</span>
                      <span class="s1">&#39;mRID&#39;</span><span class="p">:</span> <span class="n">der_em_mrid_per_bus_query_output</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;results&#39;</span><span class="p">][</span><span class="s1">&#39;bindings&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;id&#39;</span><span class="p">][</span><span class="s1">&#39;value&#39;</span><span class="p">]})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assignment_lookup_table</span> <span class="o">=</span> <span class="n">x</span>
</pre></div>

        </details>

            <div class="docstring"><p>Runs an extended SPARQL query on the database and parses it into the assignment lookup table: that is, the names
and mRIDs of all DER-EMs on each bus in the current model.</p>
</div>


                            </div>
                            <div id="DERAssignmentHandler.assign_all_ders" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#DERAssignmentHandler.assign_all_ders">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">assign_all_ders</span><span class="signature">(self)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">assign_all_ders</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calls the assignment process for each DER-S. Uses the DER-S list from MCConfiguration, so no additions are</span>
<span class="sd">        needed here if new DER-Ss are added.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assignment_table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assignment_lookup_table</span>

        <span class="c1"># Object list contains string names of objects. eval() lets us use these to call the methods for the proper obj</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">mcConfiguration</span><span class="o">.</span><span class="n">ders_obj_list</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="nb">eval</span><span class="p">(</span><span class="n">value</span><span class="p">)</span><span class="o">.</span><span class="n">assign_der_s_to_der_em</span><span class="p">()</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;DER Assignment complete.&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">association_table</span><span class="p">)</span>
</pre></div>

        </details>

            <div class="docstring"><p>Calls the assignment process for each DER-S. Uses the DER-S list from MCConfiguration, so no additions are
needed here if new DER-Ss are added.</p>
</div>


                            </div>
                            <div id="DERAssignmentHandler.get_mRID_for_der_on_bus" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#DERAssignmentHandler.get_mRID_for_der_on_bus">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">get_mRID_for_der_on_bus</span><span class="signature">(self, Bus)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">get_mRID_for_der_on_bus</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Bus</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        For a given Bus, checks if a DER-EM exists on that bus and is available for assignment. If so, returns its mRID</span>
<span class="sd">        and removes it from the list (so a DER-EM can&#39;t be assigned twice).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Getting mRID for a der on bus:&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">Bus</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">next_mrid_on_bus</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">item</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">assignment_table</span> <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;Bus&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="nb">str</span><span class="p">(</span><span class="n">Bus</span><span class="p">))</span>
            <span class="n">mrid</span> <span class="o">=</span> <span class="n">next_mrid_on_bus</span><span class="p">[</span><span class="s1">&#39;mRID&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assignment_table</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">assignment_table</span> <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="s1">&#39;mRID&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">mrid</span><span class="p">)]</span>
        <span class="k">except</span> <span class="ne">StopIteration</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;FATAL ERROR: Attempting to assign a DER to a nonexistant DER-EM. &quot;</span>
                  <span class="s2">&quot;The bus may be wrong, or may not contain enough DER-EMs. Verify test.&quot;</span><span class="p">)</span>
            <span class="n">quit</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">next_mrid_on_bus</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">mrid</span>
</pre></div>

        </details>

            <div class="docstring"><p>For a given Bus, checks if a DER-EM exists on that bus and is available for assignment. If so, returns its mRID
and removes it from the list (so a DER-EM can't be assigned twice).</p>
</div>


                            </div>
                            <div id="DERAssignmentHandler.append_new_values_to_association_table" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#DERAssignmentHandler.append_new_values_to_association_table">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">append_new_values_to_association_table</span><span class="signature">(self, values)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">append_new_values_to_association_table</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Used by DER-S classes to add new values to the association table during initialization.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">association_table</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
</pre></div>

        </details>

            <div class="docstring"><p>Used by DER-S classes to add new values to the association table during initialization.</p>
</div>


                            </div>
                </section>
                <section id="MCInputInterface">
                                <div class="attr class">
        <a class="headerlink" href="#MCInputInterface">#&nbsp;&nbsp</a>

        
        <span class="def">class</span>
        <span class="name">MCInputInterface</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">MCInputInterface</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Input interface. Receives input messages from DER-Ss, retrieves the proper DER-EM input mRIDs for each input from</span>
<span class="sd">    the Identification Manager, and delivers input messages to the EDM that update the DER-EMs with the new states.</span>

<span class="sd">    ATTRIBUTES:</span>
<span class="sd">        .current_unified_input_request: A list of all input requests currently being provided to the Input Interface</span>
<span class="sd">            by all active DER-Ss.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_unified_input_request</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">update_all_der_em_status</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Currently, calls the test_der_em() method. In future, will call all input methods.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_der_ems</span><span class="p">()</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">update_all_der_s_status</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets the DER-S input requests.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_all_der_s_input_requests</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">get_all_der_s_input_requests</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieves input requests from all DER-Ss and appends them to a unified input request.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">online_ders</span> <span class="o">=</span> <span class="n">mcConfiguration</span><span class="o">.</span><span class="n">ders_obj_list</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;online_ders&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">online_ders</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_unified_input_request</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">mcConfiguration</span><span class="o">.</span><span class="n">ders_obj_list</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current_unified_input_request</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_unified_input_request</span> <span class="o">+</span> <span class="nb">eval</span><span class="p">(</span><span class="n">value</span><span class="p">)</span><span class="o">.</span><span class="n">get_input_request</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Current unified input request:&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_unified_input_request</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">update_der_ems</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reads each line in the unified input request and uses the GridAPPS-D library to generate EDM input messages for</span>
<span class="sd">        each one. The end result is the inputs are sent to the associated DER-EMs and the grid model is updated with</span>
<span class="sd">        the new DER states. This will be reflected in future measurements.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">input_topic</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">simulation_input_topic</span><span class="p">(</span><span class="n">edmCore</span><span class="o">.</span><span class="n">sim_mrid</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_unified_input_request</span><span class="p">:</span>
            <span class="n">der_name_to_look_up</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
            <span class="n">der_name_to_look_up</span> <span class="o">=</span> <span class="n">der_name_to_look_up</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">associated_der_em_mrid</span> <span class="o">=</span> <span class="n">derIdentificationManager</span><span class="o">.</span><span class="n">get_der_em_mrid</span><span class="p">(</span><span class="n">der_name_to_look_up</span><span class="p">)</span>
            <span class="n">my_diff_build</span> <span class="o">=</span> <span class="n">DifferenceBuilder</span><span class="p">(</span><span class="n">edmCore</span><span class="o">.</span><span class="n">sim_mrid</span><span class="p">)</span>
            <span class="n">my_diff_build</span><span class="o">.</span><span class="n">add_difference</span><span class="p">(</span><span class="n">associated_der_em_mrid</span><span class="p">,</span> <span class="s2">&quot;PowerElectronicsConnection.p&quot;</span><span class="p">,</span>
                                         <span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="n">der_name_to_look_up</span><span class="p">]),</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">message</span> <span class="o">=</span> <span class="n">my_diff_build</span><span class="o">.</span><span class="n">get_message</span><span class="p">()</span>
            <span class="n">edmCore</span><span class="o">.</span><span class="n">gapps_session</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">input_topic</span><span class="p">,</span> <span class="n">message</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_unified_input_request</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
</pre></div>

        </details>

            <div class="docstring"><p>Input interface. Receives input messages from DER-Ss, retrieves the proper DER-EM input mRIDs for each input from
the Identification Manager, and delivers input messages to the EDM that update the DER-EMs with the new states.</p>

<p>ATTRIBUTES:
    .current_unified_input_request: A list of all input requests currently being provided to the Input Interface
        by all active DER-Ss.</p>
</div>


                            <div id="MCInputInterface.__init__" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#MCInputInterface.__init__">#&nbsp;&nbsp</a>

        
            <span class="name">MCInputInterface</span><span class="signature">()</span>
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_unified_input_request</span> <span class="o">=</span> <span class="p">[]</span>
</pre></div>

        </details>

    

                            </div>
                            <div id="MCInputInterface.update_all_der_em_status" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#MCInputInterface.update_all_der_em_status">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">update_all_der_em_status</span><span class="signature">(self)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">update_all_der_em_status</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Currently, calls the test_der_em() method. In future, will call all input methods.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_der_ems</span><span class="p">()</span>
        <span class="k">pass</span>
</pre></div>

        </details>

            <div class="docstring"><p>Currently, calls the test_der_em() method. In future, will call all input methods.</p>
</div>


                            </div>
                            <div id="MCInputInterface.update_all_der_s_status" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#MCInputInterface.update_all_der_s_status">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">update_all_der_s_status</span><span class="signature">(self)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">update_all_der_s_status</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets the DER-S input requests.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_all_der_s_input_requests</span><span class="p">()</span>
</pre></div>

        </details>

            <div class="docstring"><p>Gets the DER-S input requests.</p>
</div>


                            </div>
                            <div id="MCInputInterface.get_all_der_s_input_requests" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#MCInputInterface.get_all_der_s_input_requests">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">get_all_der_s_input_requests</span><span class="signature">(self)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">get_all_der_s_input_requests</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieves input requests from all DER-Ss and appends them to a unified input request.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">online_ders</span> <span class="o">=</span> <span class="n">mcConfiguration</span><span class="o">.</span><span class="n">ders_obj_list</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;online_ders&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">online_ders</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_unified_input_request</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">mcConfiguration</span><span class="o">.</span><span class="n">ders_obj_list</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current_unified_input_request</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_unified_input_request</span> <span class="o">+</span> <span class="nb">eval</span><span class="p">(</span><span class="n">value</span><span class="p">)</span><span class="o">.</span><span class="n">get_input_request</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Current unified input request:&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_unified_input_request</span><span class="p">)</span>
</pre></div>

        </details>

            <div class="docstring"><p>Retrieves input requests from all DER-Ss and appends them to a unified input request.</p>
</div>


                            </div>
                            <div id="MCInputInterface.update_der_ems" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#MCInputInterface.update_der_ems">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">update_der_ems</span><span class="signature">(self)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">update_der_ems</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reads each line in the unified input request and uses the GridAPPS-D library to generate EDM input messages for</span>
<span class="sd">        each one. The end result is the inputs are sent to the associated DER-EMs and the grid model is updated with</span>
<span class="sd">        the new DER states. This will be reflected in future measurements.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">input_topic</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">simulation_input_topic</span><span class="p">(</span><span class="n">edmCore</span><span class="o">.</span><span class="n">sim_mrid</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_unified_input_request</span><span class="p">:</span>
            <span class="n">der_name_to_look_up</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
            <span class="n">der_name_to_look_up</span> <span class="o">=</span> <span class="n">der_name_to_look_up</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">associated_der_em_mrid</span> <span class="o">=</span> <span class="n">derIdentificationManager</span><span class="o">.</span><span class="n">get_der_em_mrid</span><span class="p">(</span><span class="n">der_name_to_look_up</span><span class="p">)</span>
            <span class="n">my_diff_build</span> <span class="o">=</span> <span class="n">DifferenceBuilder</span><span class="p">(</span><span class="n">edmCore</span><span class="o">.</span><span class="n">sim_mrid</span><span class="p">)</span>
            <span class="n">my_diff_build</span><span class="o">.</span><span class="n">add_difference</span><span class="p">(</span><span class="n">associated_der_em_mrid</span><span class="p">,</span> <span class="s2">&quot;PowerElectronicsConnection.p&quot;</span><span class="p">,</span>
                                         <span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="n">der_name_to_look_up</span><span class="p">]),</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">message</span> <span class="o">=</span> <span class="n">my_diff_build</span><span class="o">.</span><span class="n">get_message</span><span class="p">()</span>
            <span class="n">edmCore</span><span class="o">.</span><span class="n">gapps_session</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">input_topic</span><span class="p">,</span> <span class="n">message</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_unified_input_request</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
</pre></div>

        </details>

            <div class="docstring"><p>Reads each line in the unified input request and uses the GridAPPS-D library to generate EDM input messages for
each one. The end result is the inputs are sent to the associated DER-EMs and the grid model is updated with
the new DER states. This will be reflected in future measurements.</p>
</div>


                            </div>
                </section>
                <section id="GOTopologyProcessor">
                                <div class="attr class">
        <a class="headerlink" href="#GOTopologyProcessor">#&nbsp;&nbsp</a>

        
        <span class="def">class</span>
        <span class="name">GOTopologyProcessor</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">GOTopologyProcessor</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    &#39;Topology&#39; refers to where things are on the grid in relation to one another. In its simplest form, topology can</span>
<span class="sd">    refer to what bus each DER-EM is on. However, GOs and GSPs may view topology in more complex forms, combining</span>
<span class="sd">    buses into branches, groups, etc. More complex topologies are stored in xml files and read into the MC by this</span>
<span class="sd">    class; the XLM contains each &quot;group&quot; and whatever buses are members of it. This class will then be able to</span>

<span class="sd">    Topological processing is not required in the early stages of testing, so this class has not been fully implemented</span>
<span class="sd">    and many of its functions are currently unused.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">topology_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bus_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">group_list</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">import_topology_from_file</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reads the topology xml file. This needs to be generated prior to the simulation and will be used by both the</span>
<span class="sd">        ME and the DERMS in use (ex. the GSP).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">tree</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="s1">&#39;Configuration/topology.xml&#39;</span><span class="p">)</span>
        <span class="n">root</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">getroot</span><span class="p">()</span>
        <span class="n">topology_map</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">root</span><span class="p">):</span>
            <span class="n">topological_input_row_key</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">root</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">topological_input_row_vals</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">root</span><span class="p">[</span><span class="n">i</span><span class="p">]):</span>
                <span class="n">topological_input_row_vals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">root</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">a</span><span class="p">]</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>
            <span class="n">topology_map_row</span> <span class="o">=</span> <span class="p">{</span><span class="n">topological_input_row_key</span><span class="p">:</span> <span class="n">topological_input_row_vals</span><span class="p">}</span>
            <span class="n">topology_map</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">topology_map_row</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">topology_dict</span> <span class="o">=</span> <span class="n">topology_map</span>
        <span class="n">group_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">bus_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">topology_map</span><span class="p">:</span>
            <span class="n">group_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">bus_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">group_list</span> <span class="o">=</span> <span class="n">group_list</span>
        <span class="k">for</span> <span class="n">flatten_count</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">):</span>
            <span class="n">bus_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">bus_list</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">item</span><span class="p">]</span>
        <span class="n">bus_list_final</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="p">[</span><span class="n">bus_list_final</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">bus_list</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">bus_list_final</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bus_list</span> <span class="o">=</span> <span class="n">bus_list</span>

    <span class="k">def</span> <span class="nf">reverse_topology_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Not implemented.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">get_group_members</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">group_input</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Unused. Returns all buses contained in a given group.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">topology_dict</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">bus_return</span> <span class="o">=</span> <span class="n">i</span><span class="p">[</span><span class="n">group_input</span><span class="p">]</span>
                <span class="n">bus_return</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">bus_return</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">item</span><span class="p">]</span>
                <span class="c1"># print(bus_return)</span>
                <span class="k">return</span> <span class="n">bus_return</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">get_groups_bus_is_in</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Not implemented. Returns all groups a given bus is a member of.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span>
</pre></div>

        </details>

            <div class="docstring"><p>'Topology' refers to where things are on the grid in relation to one another. In its simplest form, topology can
refer to what bus each DER-EM is on. However, GOs and GSPs may view topology in more complex forms, combining
buses into branches, groups, etc. More complex topologies are stored in xml files and read into the MC by this
class; the XLM contains each "group" and whatever buses are members of it. This class will then be able to</p>

<p>Topological processing is not required in the early stages of testing, so this class has not been fully implemented
and many of its functions are currently unused.</p>
</div>


                            <div id="GOTopologyProcessor.__init__" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#GOTopologyProcessor.__init__">#&nbsp;&nbsp</a>

        
            <span class="name">GOTopologyProcessor</span><span class="signature">()</span>
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">topology_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bus_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">group_list</span> <span class="o">=</span> <span class="p">[]</span>
</pre></div>

        </details>

    

                            </div>
                            <div id="GOTopologyProcessor.import_topology_from_file" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#GOTopologyProcessor.import_topology_from_file">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">import_topology_from_file</span><span class="signature">(self)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">import_topology_from_file</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reads the topology xml file. This needs to be generated prior to the simulation and will be used by both the</span>
<span class="sd">        ME and the DERMS in use (ex. the GSP).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">tree</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="s1">&#39;Configuration/topology.xml&#39;</span><span class="p">)</span>
        <span class="n">root</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">getroot</span><span class="p">()</span>
        <span class="n">topology_map</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">root</span><span class="p">):</span>
            <span class="n">topological_input_row_key</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">root</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">topological_input_row_vals</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">root</span><span class="p">[</span><span class="n">i</span><span class="p">]):</span>
                <span class="n">topological_input_row_vals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">root</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">a</span><span class="p">]</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>
            <span class="n">topology_map_row</span> <span class="o">=</span> <span class="p">{</span><span class="n">topological_input_row_key</span><span class="p">:</span> <span class="n">topological_input_row_vals</span><span class="p">}</span>
            <span class="n">topology_map</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">topology_map_row</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">topology_dict</span> <span class="o">=</span> <span class="n">topology_map</span>
        <span class="n">group_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">bus_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">topology_map</span><span class="p">:</span>
            <span class="n">group_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">bus_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">group_list</span> <span class="o">=</span> <span class="n">group_list</span>
        <span class="k">for</span> <span class="n">flatten_count</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">):</span>
            <span class="n">bus_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">bus_list</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">item</span><span class="p">]</span>
        <span class="n">bus_list_final</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="p">[</span><span class="n">bus_list_final</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">bus_list</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">bus_list_final</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bus_list</span> <span class="o">=</span> <span class="n">bus_list</span>
</pre></div>

        </details>

            <div class="docstring"><p>Reads the topology xml file. This needs to be generated prior to the simulation and will be used by both the
ME and the DERMS in use (ex. the GSP).</p>
</div>


                            </div>
                            <div id="GOTopologyProcessor.reverse_topology_dict" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#GOTopologyProcessor.reverse_topology_dict">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">reverse_topology_dict</span><span class="signature">(self)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">reverse_topology_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Not implemented.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span>
</pre></div>

        </details>

            <div class="docstring"><p>Not implemented.</p>
</div>


                            </div>
                            <div id="GOTopologyProcessor.get_group_members" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#GOTopologyProcessor.get_group_members">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">get_group_members</span><span class="signature">(self, group_input)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">get_group_members</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">group_input</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Unused. Returns all buses contained in a given group.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">topology_dict</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">bus_return</span> <span class="o">=</span> <span class="n">i</span><span class="p">[</span><span class="n">group_input</span><span class="p">]</span>
                <span class="n">bus_return</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">bus_return</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">item</span><span class="p">]</span>
                <span class="c1"># print(bus_return)</span>
                <span class="k">return</span> <span class="n">bus_return</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="k">pass</span>
</pre></div>

        </details>

            <div class="docstring"><p>Unused. Returns all buses contained in a given group.</p>
</div>


                            </div>
                            <div id="GOTopologyProcessor.get_groups_bus_is_in" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#GOTopologyProcessor.get_groups_bus_is_in">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">get_groups_bus_is_in</span><span class="signature">(self)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">get_groups_bus_is_in</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Not implemented. Returns all groups a given bus is a member of.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span>
</pre></div>

        </details>

            <div class="docstring"><p>Not implemented. Returns all groups a given bus is a member of.</p>
</div>


                            </div>
                </section>
                <section id="GOSensor">
                                <div class="attr class">
        <a class="headerlink" href="#GOSensor">#&nbsp;&nbsp</a>

        
        <span class="def">class</span>
        <span class="name">GOSensor</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">GOSensor</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This class retrieves fully formatted grid states from the measurement processor, filters them down to necessary</span>
<span class="sd">    information, and makes determinations (automatically or manually) about grid services, whether they&#39;re required,</span>
<span class="sd">    happening satisfactorily, etc. These determinations are sent to the output API to be communicated to the DERMS.</span>

<span class="sd">    ATTRIBUTES:</span>
<span class="sd">        .current_sensor_states: Grid states read into the sensor. Automatic mode only. Not currently implemented.</span>

<span class="sd">        .service_request_decision: Determination whether a grid service is needed. Automatic mode. Not implemented.</span>

<span class="sd">        .posted_service_list: List of posted service objects. Used by both Automatic and Manual modes.</span>

<span class="sd">        .manual_service_xml_data: In Manual Mode, the data contained within the manual service xml file. To be parsed</span>
<span class="sd">            and posted service objects generated from this data.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_sensor_states</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">service_request_decision</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">posted_service_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">manual_service_xml_data</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="nf">update_sensor_states</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieves measurement data from the Measurement Processor. The measurements are organized by topological group.</span>
<span class="sd">        This is only used by AUTOMATIC MODE. Not currently implemented.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">make_service_request_decision</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Performs the following once per timestep.</span>

<span class="sd">        In MANUAL MODE (override is True):</span>
<span class="sd">            Instantiates a grid service</span>
<span class="sd">        In AUTOMATIC MODE (override is False):</span>
<span class="sd">            Will call code to make grid service determination. Currently not implemented.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">mcConfiguration</span><span class="o">.</span><span class="n">go_sensor_decision_making_manual_override</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">manually_post_service</span><span class="p">(</span><span class="n">edmTimekeeper</span><span class="o">.</span><span class="n">get_sim_current_time</span><span class="p">())</span>
        <span class="k">elif</span> <span class="n">mcConfiguration</span><span class="o">.</span><span class="n">go_sensor_decision_making_manual_override</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Service request failure. Wrong input.&quot;</span><span class="p">)</span>

        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">load_manual_service_file</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        MANUAL MODE: Reads the manually_posted_service_input.xml file during MC initialization and loads it into</span>
<span class="sd">        a dictionary for later use.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">input_file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">mcConfiguration</span><span class="o">.</span><span class="n">manual_service_filename</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">input_file</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="n">input_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">manual_service_xml_data</span> <span class="o">=</span> <span class="n">xmltodict</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">manually_post_service</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sim_time</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Called by make_service_request_decision() when in MANUAL mode. Reads the contents of the manual service</span>
<span class="sd">        dictionary, draws all relevant data points for each service, and instantiates a GOPostedService object for each</span>
<span class="sd">        one, appending the objects to a list.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">manual_service_xml_data</span><span class="p">[</span><span class="s1">&#39;services&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="s1">&#39;start_time&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="nb">int</span><span class="p">(</span><span class="n">sim_time</span><span class="p">):</span>
                <span class="n">name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
                <span class="n">group_id</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="s2">&quot;group_id&quot;</span><span class="p">]</span>
                <span class="n">service_type</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="s2">&quot;service_type&quot;</span><span class="p">]</span>
                <span class="n">interval_duration</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="s2">&quot;interval_duration&quot;</span><span class="p">]</span>
                <span class="n">interval_start</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="s2">&quot;interval_start&quot;</span><span class="p">]</span>
                <span class="n">power</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="s2">&quot;power&quot;</span><span class="p">]</span>
                <span class="n">ramp</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="s2">&quot;ramp&quot;</span><span class="p">]</span>
                <span class="n">price</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="s2">&quot;price&quot;</span><span class="p">]</span>
                <span class="n">start_time</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="s2">&quot;start_time&quot;</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">posted_service_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">GOPostedService</span><span class="p">(</span>
                    <span class="n">name</span><span class="p">,</span> <span class="n">group_id</span><span class="p">,</span> <span class="n">service_type</span><span class="p">,</span> <span class="n">interval_start</span><span class="p">,</span> <span class="n">interval_duration</span><span class="p">,</span> <span class="n">power</span><span class="p">,</span> <span class="n">ramp</span><span class="p">,</span> <span class="n">price</span><span class="p">))</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Manually posting service, name:&quot;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
</pre></div>

        </details>

            <div class="docstring"><p>This class retrieves fully formatted grid states from the measurement processor, filters them down to necessary
information, and makes determinations (automatically or manually) about grid services, whether they're required,
happening satisfactorily, etc. These determinations are sent to the output API to be communicated to the DERMS.</p>

<p>ATTRIBUTES:
    .current_sensor_states: Grid states read into the sensor. Automatic mode only. Not currently implemented.</p>

<pre><code>.service_request_decision: Determination whether a grid service is needed. Automatic mode. Not implemented.

.posted_service_list: List of posted service objects. Used by both Automatic and Manual modes.

.manual_service_xml_data: In Manual Mode, the data contained within the manual service xml file. To be parsed
    and posted service objects generated from this data.
</code></pre>
</div>


                            <div id="GOSensor.__init__" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#GOSensor.__init__">#&nbsp;&nbsp</a>

        
            <span class="name">GOSensor</span><span class="signature">()</span>
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_sensor_states</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">service_request_decision</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">posted_service_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">manual_service_xml_data</span> <span class="o">=</span> <span class="p">{}</span>
</pre></div>

        </details>

    

                            </div>
                            <div id="GOSensor.update_sensor_states" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#GOSensor.update_sensor_states">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">update_sensor_states</span><span class="signature">(self)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">update_sensor_states</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieves measurement data from the Measurement Processor. The measurements are organized by topological group.</span>
<span class="sd">        This is only used by AUTOMATIC MODE. Not currently implemented.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span>
</pre></div>

        </details>

            <div class="docstring"><p>Retrieves measurement data from the Measurement Processor. The measurements are organized by topological group.
This is only used by AUTOMATIC MODE. Not currently implemented.</p>
</div>


                            </div>
                            <div id="GOSensor.make_service_request_decision" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#GOSensor.make_service_request_decision">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">make_service_request_decision</span><span class="signature">(self)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">make_service_request_decision</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Performs the following once per timestep.</span>

<span class="sd">        In MANUAL MODE (override is True):</span>
<span class="sd">            Instantiates a grid service</span>
<span class="sd">        In AUTOMATIC MODE (override is False):</span>
<span class="sd">            Will call code to make grid service determination. Currently not implemented.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">mcConfiguration</span><span class="o">.</span><span class="n">go_sensor_decision_making_manual_override</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">manually_post_service</span><span class="p">(</span><span class="n">edmTimekeeper</span><span class="o">.</span><span class="n">get_sim_current_time</span><span class="p">())</span>
        <span class="k">elif</span> <span class="n">mcConfiguration</span><span class="o">.</span><span class="n">go_sensor_decision_making_manual_override</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Service request failure. Wrong input.&quot;</span><span class="p">)</span>

        <span class="k">pass</span>
</pre></div>

        </details>

            <div class="docstring"><p>Performs the following once per timestep.</p>

<p>In MANUAL MODE (override is True):
    Instantiates a grid service
In AUTOMATIC MODE (override is False):
    Will call code to make grid service determination. Currently not implemented.</p>
</div>


                            </div>
                            <div id="GOSensor.load_manual_service_file" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#GOSensor.load_manual_service_file">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">load_manual_service_file</span><span class="signature">(self)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">load_manual_service_file</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        MANUAL MODE: Reads the manually_posted_service_input.xml file during MC initialization and loads it into</span>
<span class="sd">        a dictionary for later use.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">input_file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">mcConfiguration</span><span class="o">.</span><span class="n">manual_service_filename</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">input_file</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="n">input_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">manual_service_xml_data</span> <span class="o">=</span> <span class="n">xmltodict</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</pre></div>

        </details>

            <div class="docstring"><p>MANUAL MODE: Reads the manually_posted_service_input.xml file during MC initialization and loads it into
a dictionary for later use.</p>
</div>


                            </div>
                            <div id="GOSensor.manually_post_service" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#GOSensor.manually_post_service">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">manually_post_service</span><span class="signature">(self, sim_time)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">manually_post_service</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sim_time</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Called by make_service_request_decision() when in MANUAL mode. Reads the contents of the manual service</span>
<span class="sd">        dictionary, draws all relevant data points for each service, and instantiates a GOPostedService object for each</span>
<span class="sd">        one, appending the objects to a list.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">manual_service_xml_data</span><span class="p">[</span><span class="s1">&#39;services&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="s1">&#39;start_time&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="nb">int</span><span class="p">(</span><span class="n">sim_time</span><span class="p">):</span>
                <span class="n">name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
                <span class="n">group_id</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="s2">&quot;group_id&quot;</span><span class="p">]</span>
                <span class="n">service_type</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="s2">&quot;service_type&quot;</span><span class="p">]</span>
                <span class="n">interval_duration</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="s2">&quot;interval_duration&quot;</span><span class="p">]</span>
                <span class="n">interval_start</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="s2">&quot;interval_start&quot;</span><span class="p">]</span>
                <span class="n">power</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="s2">&quot;power&quot;</span><span class="p">]</span>
                <span class="n">ramp</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="s2">&quot;ramp&quot;</span><span class="p">]</span>
                <span class="n">price</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="s2">&quot;price&quot;</span><span class="p">]</span>
                <span class="n">start_time</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="s2">&quot;start_time&quot;</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">posted_service_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">GOPostedService</span><span class="p">(</span>
                    <span class="n">name</span><span class="p">,</span> <span class="n">group_id</span><span class="p">,</span> <span class="n">service_type</span><span class="p">,</span> <span class="n">interval_start</span><span class="p">,</span> <span class="n">interval_duration</span><span class="p">,</span> <span class="n">power</span><span class="p">,</span> <span class="n">ramp</span><span class="p">,</span> <span class="n">price</span><span class="p">))</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Manually posting service, name:&quot;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
</pre></div>

        </details>

            <div class="docstring"><p>Called by make_service_request_decision() when in MANUAL mode. Reads the contents of the manual service
dictionary, draws all relevant data points for each service, and instantiates a GOPostedService object for each
one, appending the objects to a list.</p>
</div>


                            </div>
                </section>
                <section id="GOOutputInterface">
                                <div class="attr class">
        <a class="headerlink" href="#GOOutputInterface">#&nbsp;&nbsp</a>

        
        <span class="def">class</span>
        <span class="name">GOOutputInterface</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">GOOutputInterface</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    API between the MC and a DERMS. Must be customized to the needs of the DERMS. Converts determinations and feedback</span>
<span class="sd">    data to message formats the DERMS requires/can use, and delivers them.</span>

<span class="sd">    ATTRIBUTES:</span>
<span class="sd">        .current_service_requests: A list of posted services. These are the services that are being requested, or are</span>
<span class="sd">            currently being executed. Can come from either Automatic or Manual Decision making. See GOPostedService.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">current_service_requests</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">get_all_posted_service_requests</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieves the service message data from each posted service (see the GOPostedService.get_service_message_data()</span>
<span class="sd">        method for more detail). Appends the data in the proper list-of-dict format to current_service_requests.</span>

<span class="sd">        Note: In the current implementation, it may seem redundant to read data from an xml file into dictionaries,</span>
<span class="sd">        package the data into object, and extract the data back into identical dictionaries; however, this is important</span>
<span class="sd">        to ensure that the process is decoupled. A different DERMS or even a more advanced ME-GSP API might not allow</span>
<span class="sd">        for such direct input formats.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">goSensor</span><span class="o">.</span><span class="n">posted_service_list</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">get_status</span><span class="p">()</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Posting...&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">current_service_requests</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">get_service_message_data</span><span class="p">())</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">get_service_message_data</span><span class="p">())</span>
                <span class="n">item</span><span class="o">.</span><span class="n">set_status</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;All already posted&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">generate_service_messages</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Converts the current_service_requests list of dicts into a proper xml format. Used by the xml writed in</span>
<span class="sd">        send_service_request_messages().</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">request_out_xml</span> <span class="o">=</span> <span class="n">dict2xml</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_service_requests</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Current Service Requests&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">request_out_xml</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">request_out_xml</span>

    <span class="k">def</span> <span class="nf">send_service_request_messages</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Writes the current service request messages to an xml file, which will be accessed by the GSP for its service</span>
<span class="sd">        provisioning functions.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">xmlfile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;Outputs To DERMS/OutputtoGSP.xml&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span>
        <span class="n">xmlfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">generate_service_messages</span><span class="p">())</span>
        <span class="n">xmlfile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>

        </details>

            <div class="docstring"><p>API between the MC and a DERMS. Must be customized to the needs of the DERMS. Converts determinations and feedback
data to message formats the DERMS requires/can use, and delivers them.</p>

<p>ATTRIBUTES:
    .current_service_requests: A list of posted services. These are the services that are being requested, or are
        currently being executed. Can come from either Automatic or Manual Decision making. See GOPostedService.</p>
</div>


                            <div id="GOOutputInterface.__init__" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#GOOutputInterface.__init__">#&nbsp;&nbsp</a>

        
            <span class="name">GOOutputInterface</span><span class="signature">()</span>
    </div>

        
    

                            </div>
                            <div id="GOOutputInterface.current_service_requests" class="classattr">
                                            <div class="attr variable"><a class="headerlink" href="#GOOutputInterface.current_service_requests">#&nbsp;&nbsp</a>

        <span class="name">current_service_requests</span><span class="default_value"> = []</span>
    </div>

    

                            </div>
                            <div id="GOOutputInterface.get_all_posted_service_requests" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#GOOutputInterface.get_all_posted_service_requests">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">get_all_posted_service_requests</span><span class="signature">(self)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">get_all_posted_service_requests</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieves the service message data from each posted service (see the GOPostedService.get_service_message_data()</span>
<span class="sd">        method for more detail). Appends the data in the proper list-of-dict format to current_service_requests.</span>

<span class="sd">        Note: In the current implementation, it may seem redundant to read data from an xml file into dictionaries,</span>
<span class="sd">        package the data into object, and extract the data back into identical dictionaries; however, this is important</span>
<span class="sd">        to ensure that the process is decoupled. A different DERMS or even a more advanced ME-GSP API might not allow</span>
<span class="sd">        for such direct input formats.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">goSensor</span><span class="o">.</span><span class="n">posted_service_list</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">get_status</span><span class="p">()</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Posting...&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">current_service_requests</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">get_service_message_data</span><span class="p">())</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">get_service_message_data</span><span class="p">())</span>
                <span class="n">item</span><span class="o">.</span><span class="n">set_status</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;All already posted&quot;</span><span class="p">)</span>
</pre></div>

        </details>

            <div class="docstring"><p>Retrieves the service message data from each posted service (see the GOPostedService.get_service_message_data()
method for more detail). Appends the data in the proper list-of-dict format to current_service_requests.</p>

<p>Note: In the current implementation, it may seem redundant to read data from an xml file into dictionaries,
package the data into object, and extract the data back into identical dictionaries; however, this is important
to ensure that the process is decoupled. A different DERMS or even a more advanced ME-GSP API might not allow
for such direct input formats.</p>
</div>


                            </div>
                            <div id="GOOutputInterface.generate_service_messages" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#GOOutputInterface.generate_service_messages">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">generate_service_messages</span><span class="signature">(self)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">generate_service_messages</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Converts the current_service_requests list of dicts into a proper xml format. Used by the xml writed in</span>
<span class="sd">        send_service_request_messages().</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">request_out_xml</span> <span class="o">=</span> <span class="n">dict2xml</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_service_requests</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Current Service Requests&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">request_out_xml</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">request_out_xml</span>
</pre></div>

        </details>

            <div class="docstring"><p>Converts the current_service_requests list of dicts into a proper xml format. Used by the xml writed in
send_service_request_messages().</p>
</div>


                            </div>
                            <div id="GOOutputInterface.send_service_request_messages" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#GOOutputInterface.send_service_request_messages">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">send_service_request_messages</span><span class="signature">(self)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">send_service_request_messages</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Writes the current service request messages to an xml file, which will be accessed by the GSP for its service</span>
<span class="sd">        provisioning functions.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">xmlfile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;Outputs To DERMS/OutputtoGSP.xml&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span>
        <span class="n">xmlfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">generate_service_messages</span><span class="p">())</span>
        <span class="n">xmlfile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>

        </details>

            <div class="docstring"><p>Writes the current service request messages to an xml file, which will be accessed by the GSP for its service
provisioning functions.</p>
</div>


                            </div>
                </section>
                <section id="MCOutputLog">
                                <div class="attr class">
        <a class="headerlink" href="#MCOutputLog">#&nbsp;&nbsp</a>

        
        <span class="def">class</span>
        <span class="name">MCOutputLog</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">MCOutputLog</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generates .csv logs containing measurements from the measurement processor. Updates (writes a line) once per</span>
<span class="sd">    timestep.</span>

<span class="sd">    ATTRIBUTES:</span>
<span class="sd">        .csv_file: Contains the csv file object (see open_csv_file())</span>

<span class="sd">        .log_name: The log name, taken from MCConfiguration during initialization.</span>

<span class="sd">        .mrid_name_lookup_table: a table of mRIDs and their respective plain english names, used to create the log</span>
<span class="sd">            headers. Taken from edmCore.get_mrid_name_lookup_table().</span>

<span class="sd">        .header_mrids: a list of mRIDs for each measurement point, used (invisibly) in the header to write logs.</span>

<span class="sd">        .header_names: the plain english versions of the header names.</span>

<span class="sd">        .csv_dict_writer: The dictionary writer object, used to write the .csv logs.</span>

<span class="sd">        .timestamp_array: A list of all timestamps for the logs. Appended at the end of simulation.</span>

<span class="sd">        .current_measurement: The dictionary containing the current set of measurements.</span>

<span class="sd">        .is_first_measurement: Calls functions that should only run once at the start of logging (such as opening</span>
<span class="sd">           the log files, setting up the header, etc.)</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">csv_file</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log_name</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mrid_name_lookup_table</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">header_mrids</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">header_names</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">csv_dict_writer</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timestamp_array</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_measurement</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_first_measurement</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">update_logs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        During the first measurement, performs housekeeping tasks like opening the file, setting the name, translating</span>
<span class="sd">        the header to something readable, and writing the header. On all subsequent measurements, it writes a row of</span>
<span class="sd">        measurements to the logs and appends a new timestamp to the timestamp array.</span>

<span class="sd">        Note: The first timestep in the logs will be several seconds after the actual simulation start time.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_measurement</span> <span class="o">=</span> <span class="n">edmMeasurementProcessor</span><span class="o">.</span><span class="n">get_current_measurements</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_measurement</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Updating logs...&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_first_measurement</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;First measurement routines...&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">set_log_name</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">open_csv_file</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mrid_name_lookup_table</span> <span class="o">=</span> <span class="n">edmCore</span><span class="o">.</span><span class="n">get_mrid_name_lookup_table</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">translate_header_names</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">open_csv_dict_writer</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">write_header</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">is_first_measurement</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write_row</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">timestamp_array</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">edmTimekeeper</span><span class="o">.</span><span class="n">sim_current_time</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">open_csv_file</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Opens the .csv file.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Opening .csv file:&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">csv_file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">log_name</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">open_csv_dict_writer</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Opens the dict writer used to write rows. Note that the headers used are the measurement mRIDs; the plain</span>
<span class="sd">        English names are a visual effect only.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">csv_dict_writer</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">DictWriter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">csv_file</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">header_mrids</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">close_out_logs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Closes the log file and re-appends the timestamps.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">csv_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">append_timestamps</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">translate_header_names</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Looks up the plain english names for the headers and provides them to a dictionary for use by write_header().</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">header_mrids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_measurement</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">header_mrids</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">lookup_mrid</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">item</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mrid_name_lookup_table</span> <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;measid&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">i</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">StopIteration</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">lookup_mrid</span><span class="p">)</span>
            <span class="n">lookup_name</span> <span class="o">=</span> <span class="n">lookup_mrid</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">header_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lookup_name</span><span class="p">)</span>
            <span class="c1"># print(self.header_names)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">header_mrids</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">header_mrids</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">header_names</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">write_header</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Writes the log header.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">csv_dict_writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">header_mrids</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">write_row</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Writes a row of measurements to the logs.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">csv_dict_writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_measurement</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">set_log_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the log name based on the MCConfiguration settings.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log_name</span> <span class="o">=</span> <span class="n">mcConfiguration</span><span class="o">.</span><span class="n">output_log_name</span>

    <span class="k">def</span> <span class="nf">append_timestamps</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Uses the pandas library to append the timestamp column to the logs. This is the most convenient way to handle</span>
<span class="sd">        timekeeping while making sure to use the simulation time rather than the measurement time.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">csv_input</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">log_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timestamp_array</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timestamp_array</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;s&#39;</span><span class="p">)</span>
        <span class="n">csv_input</span><span class="p">[</span><span class="s1">&#39;Timestamp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">timestamp_array</span>
        <span class="n">move_column</span> <span class="o">=</span> <span class="n">csv_input</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;Timestamp&#39;</span><span class="p">)</span>
        <span class="n">csv_input</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;Timestamp&#39;</span><span class="p">,</span> <span class="n">move_column</span><span class="p">)</span>
        <span class="n">csv_input</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">log_name</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>

        </details>

            <div class="docstring"><p>Generates .csv logs containing measurements from the measurement processor. Updates (writes a line) once per
timestep.</p>

<p>ATTRIBUTES:
    .csv_file: Contains the csv file object (see open_csv_file())</p>

<pre><code>.log_name: The log name, taken from MCConfiguration during initialization.

.mrid_name_lookup_table: a table of mRIDs and their respective plain english names, used to create the log
    headers. Taken from edmCore.get_mrid_name_lookup_table().

.header_mrids: a list of mRIDs for each measurement point, used (invisibly) in the header to write logs.

.header_names: the plain english versions of the header names.

.csv_dict_writer: The dictionary writer object, used to write the .csv logs.

.timestamp_array: A list of all timestamps for the logs. Appended at the end of simulation.

.current_measurement: The dictionary containing the current set of measurements.

.is_first_measurement: Calls functions that should only run once at the start of logging (such as opening
   the log files, setting up the header, etc.)
</code></pre>
</div>


                            <div id="MCOutputLog.__init__" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#MCOutputLog.__init__">#&nbsp;&nbsp</a>

        
            <span class="name">MCOutputLog</span><span class="signature">()</span>
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">csv_file</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log_name</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mrid_name_lookup_table</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">header_mrids</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">header_names</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">csv_dict_writer</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timestamp_array</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_measurement</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_first_measurement</span> <span class="o">=</span> <span class="kc">True</span>
</pre></div>

        </details>

    

                            </div>
                            <div id="MCOutputLog.update_logs" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#MCOutputLog.update_logs">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">update_logs</span><span class="signature">(self)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">update_logs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        During the first measurement, performs housekeeping tasks like opening the file, setting the name, translating</span>
<span class="sd">        the header to something readable, and writing the header. On all subsequent measurements, it writes a row of</span>
<span class="sd">        measurements to the logs and appends a new timestamp to the timestamp array.</span>

<span class="sd">        Note: The first timestep in the logs will be several seconds after the actual simulation start time.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_measurement</span> <span class="o">=</span> <span class="n">edmMeasurementProcessor</span><span class="o">.</span><span class="n">get_current_measurements</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_measurement</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Updating logs...&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_first_measurement</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;First measurement routines...&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">set_log_name</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">open_csv_file</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mrid_name_lookup_table</span> <span class="o">=</span> <span class="n">edmCore</span><span class="o">.</span><span class="n">get_mrid_name_lookup_table</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">translate_header_names</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">open_csv_dict_writer</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">write_header</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">is_first_measurement</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write_row</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">timestamp_array</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">edmTimekeeper</span><span class="o">.</span><span class="n">sim_current_time</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">pass</span>
</pre></div>

        </details>

            <div class="docstring"><p>During the first measurement, performs housekeeping tasks like opening the file, setting the name, translating
the header to something readable, and writing the header. On all subsequent measurements, it writes a row of
measurements to the logs and appends a new timestamp to the timestamp array.</p>

<p>Note: The first timestep in the logs will be several seconds after the actual simulation start time.</p>
</div>


                            </div>
                            <div id="MCOutputLog.open_csv_file" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#MCOutputLog.open_csv_file">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">open_csv_file</span><span class="signature">(self)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">open_csv_file</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Opens the .csv file.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Opening .csv file:&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">csv_file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">log_name</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
</pre></div>

        </details>

            <div class="docstring"><p>Opens the .csv file.</p>
</div>


                            </div>
                            <div id="MCOutputLog.open_csv_dict_writer" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#MCOutputLog.open_csv_dict_writer">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">open_csv_dict_writer</span><span class="signature">(self)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">open_csv_dict_writer</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Opens the dict writer used to write rows. Note that the headers used are the measurement mRIDs; the plain</span>
<span class="sd">        English names are a visual effect only.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">csv_dict_writer</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">DictWriter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">csv_file</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">header_mrids</span><span class="p">)</span>
</pre></div>

        </details>

            <div class="docstring"><p>Opens the dict writer used to write rows. Note that the headers used are the measurement mRIDs; the plain
English names are a visual effect only.</p>
</div>


                            </div>
                            <div id="MCOutputLog.close_out_logs" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#MCOutputLog.close_out_logs">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">close_out_logs</span><span class="signature">(self)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">close_out_logs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Closes the log file and re-appends the timestamps.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">csv_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">append_timestamps</span><span class="p">()</span>
</pre></div>

        </details>

            <div class="docstring"><p>Closes the log file and re-appends the timestamps.</p>
</div>


                            </div>
                            <div id="MCOutputLog.translate_header_names" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#MCOutputLog.translate_header_names">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">translate_header_names</span><span class="signature">(self)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">translate_header_names</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Looks up the plain english names for the headers and provides them to a dictionary for use by write_header().</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">header_mrids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_measurement</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">header_mrids</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">lookup_mrid</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">item</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mrid_name_lookup_table</span> <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;measid&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">i</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">StopIteration</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">lookup_mrid</span><span class="p">)</span>
            <span class="n">lookup_name</span> <span class="o">=</span> <span class="n">lookup_mrid</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">header_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lookup_name</span><span class="p">)</span>
            <span class="c1"># print(self.header_names)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">header_mrids</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">header_mrids</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">header_names</span><span class="p">))</span>
</pre></div>

        </details>

            <div class="docstring"><p>Looks up the plain english names for the headers and provides them to a dictionary for use by write_header().</p>
</div>


                            </div>
                            <div id="MCOutputLog.write_header" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#MCOutputLog.write_header">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">write_header</span><span class="signature">(self)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">write_header</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Writes the log header.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">csv_dict_writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">header_mrids</span><span class="p">)</span>
</pre></div>

        </details>

            <div class="docstring"><p>Writes the log header.</p>
</div>


                            </div>
                            <div id="MCOutputLog.write_row" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#MCOutputLog.write_row">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">write_row</span><span class="signature">(self)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">write_row</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Writes a row of measurements to the logs.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">csv_dict_writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_measurement</span><span class="p">)</span>
</pre></div>

        </details>

            <div class="docstring"><p>Writes a row of measurements to the logs.</p>
</div>


                            </div>
                            <div id="MCOutputLog.set_log_name" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#MCOutputLog.set_log_name">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">set_log_name</span><span class="signature">(self)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">set_log_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the log name based on the MCConfiguration settings.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log_name</span> <span class="o">=</span> <span class="n">mcConfiguration</span><span class="o">.</span><span class="n">output_log_name</span>
</pre></div>

        </details>

            <div class="docstring"><p>Sets the log name based on the MCConfiguration settings.</p>
</div>


                            </div>
                            <div id="MCOutputLog.append_timestamps" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#MCOutputLog.append_timestamps">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">append_timestamps</span><span class="signature">(self)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">append_timestamps</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Uses the pandas library to append the timestamp column to the logs. This is the most convenient way to handle</span>
<span class="sd">        timekeeping while making sure to use the simulation time rather than the measurement time.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">csv_input</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">log_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timestamp_array</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timestamp_array</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;s&#39;</span><span class="p">)</span>
        <span class="n">csv_input</span><span class="p">[</span><span class="s1">&#39;Timestamp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">timestamp_array</span>
        <span class="n">move_column</span> <span class="o">=</span> <span class="n">csv_input</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;Timestamp&#39;</span><span class="p">)</span>
        <span class="n">csv_input</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;Timestamp&#39;</span><span class="p">,</span> <span class="n">move_column</span><span class="p">)</span>
        <span class="n">csv_input</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">log_name</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>

        </details>

            <div class="docstring"><p>Uses the pandas library to append the timestamp column to the logs. This is the most convenient way to handle
timekeeping while making sure to use the simulation time rather than the measurement time.</p>
</div>


                            </div>
                </section>
                <section id="GOPostedService">
                                <div class="attr class">
        <a class="headerlink" href="#GOPostedService">#&nbsp;&nbsp</a>

        
        <span class="def">class</span>
        <span class="name">GOPostedService</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">GOPostedService</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This class is (currently) the only class that can get instantiated more than once per simulation. It contains</span>
<span class="sd">    service request data required to communicate with the DERMS. This data informs the DERMS of the type,</span>
<span class="sd">    location, and parameters of a single service it wants to request from the DERMS. These service requests are then</span>
<span class="sd">    &#39;posted&#39; to a list in the GOSensor class, which is read by the GOOutputInterface class and processed into the</span>
<span class="sd">    communication format or protocol necessary for GO-DERMS communications (currently, an xml text file stored in the</span>
<span class="sd">    /Outputs to DERMS/ folder.)</span>

<span class="sd">    The attributes and accessor methods are mostly self-explanatory; the major points of interest are the fact that it</span>
<span class="sd">    stores whatever data is needed by the DERMS, and that there is a function that returns this data in dictionary</span>
<span class="sd">    format.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">service_name</span><span class="o">=</span><span class="s2">&quot;Undefined&quot;</span><span class="p">,</span> <span class="n">group_id</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">service_type</span><span class="o">=</span><span class="s2">&quot;Undefined&quot;</span><span class="p">,</span> <span class="n">interval_start</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                 <span class="n">interval_duration</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">power</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ramp</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">price</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">service_name</span> <span class="o">=</span> <span class="n">service_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">group_id</span> <span class="o">=</span> <span class="n">group_id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">service_type</span> <span class="o">=</span> <span class="n">service_type</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">interval_start</span> <span class="o">=</span> <span class="n">interval_start</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">interval_duration</span> <span class="o">=</span> <span class="n">interval_duration</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">power</span> <span class="o">=</span> <span class="n">power</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ramp</span> <span class="o">=</span> <span class="n">ramp</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">price</span> <span class="o">=</span> <span class="n">price</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">get_service_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">service_name</span>

    <span class="k">def</span> <span class="nf">get_group_id</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">group_id</span>

    <span class="k">def</span> <span class="nf">get_service_type</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">service_type</span>

    <span class="k">def</span> <span class="nf">get_interval_start</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">interval_start</span>

    <span class="k">def</span> <span class="nf">get_interval_duration</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">interval_duration</span>

    <span class="k">def</span> <span class="nf">get_power</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">power</span>

    <span class="k">def</span> <span class="nf">get_price</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">price</span>

    <span class="k">def</span> <span class="nf">get_status</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span>

    <span class="k">def</span> <span class="nf">set_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_status</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">new_status</span>

    <span class="k">def</span> <span class="nf">get_service_message_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the attribute names and values in dictionary form for use by the message wrapper (GOOutputInterface).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">service_message_data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;service_name&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">service_name</span><span class="p">,</span>
            <span class="s2">&quot;group_id&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">group_id</span><span class="p">,</span>
            <span class="s2">&quot;service_type&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">service_type</span><span class="p">,</span>
            <span class="s2">&quot;interval_start&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">interval_start</span><span class="p">,</span>
            <span class="s2">&quot;interval_duration&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">interval_duration</span><span class="p">,</span>
            <span class="s2">&quot;power&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">power</span><span class="p">,</span>
            <span class="s2">&quot;ramp&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">ramp</span><span class="p">,</span>
            <span class="s2">&quot;price&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">price</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">service_message_data</span>
</pre></div>

        </details>

            <div class="docstring"><p>This class is (currently) the only class that can get instantiated more than once per simulation. It contains
service request data required to communicate with the DERMS. This data informs the DERMS of the type,
location, and parameters of a single service it wants to request from the DERMS. These service requests are then
'posted' to a list in the GOSensor class, which is read by the GOOutputInterface class and processed into the
communication format or protocol necessary for GO-DERMS communications (currently, an xml text file stored in the
/Outputs to DERMS/ folder.)</p>

<p>The attributes and accessor methods are mostly self-explanatory; the major points of interest are the fact that it
stores whatever data is needed by the DERMS, and that there is a function that returns this data in dictionary
format.</p>
</div>


                            <div id="GOPostedService.__init__" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#GOPostedService.__init__">#&nbsp;&nbsp</a>

        
            <span class="name">GOPostedService</span><span class="signature">(
    service_name=&#39;Undefined&#39;,
    group_id=0,
    service_type=&#39;Undefined&#39;,
    interval_start=0,
    interval_duration=0,
    power=0,
    ramp=0,
    price=0
)</span>
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">service_name</span><span class="o">=</span><span class="s2">&quot;Undefined&quot;</span><span class="p">,</span> <span class="n">group_id</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">service_type</span><span class="o">=</span><span class="s2">&quot;Undefined&quot;</span><span class="p">,</span> <span class="n">interval_start</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                 <span class="n">interval_duration</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">power</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ramp</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">price</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">service_name</span> <span class="o">=</span> <span class="n">service_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">group_id</span> <span class="o">=</span> <span class="n">group_id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">service_type</span> <span class="o">=</span> <span class="n">service_type</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">interval_start</span> <span class="o">=</span> <span class="n">interval_start</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">interval_duration</span> <span class="o">=</span> <span class="n">interval_duration</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">power</span> <span class="o">=</span> <span class="n">power</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ramp</span> <span class="o">=</span> <span class="n">ramp</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">price</span> <span class="o">=</span> <span class="n">price</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="kc">False</span>
</pre></div>

        </details>

    

                            </div>
                            <div id="GOPostedService.get_service_name" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#GOPostedService.get_service_name">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">get_service_name</span><span class="signature">(self)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">get_service_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">service_name</span>
</pre></div>

        </details>

    

                            </div>
                            <div id="GOPostedService.get_group_id" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#GOPostedService.get_group_id">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">get_group_id</span><span class="signature">(self)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">get_group_id</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">group_id</span>
</pre></div>

        </details>

    

                            </div>
                            <div id="GOPostedService.get_service_type" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#GOPostedService.get_service_type">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">get_service_type</span><span class="signature">(self)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">get_service_type</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">service_type</span>
</pre></div>

        </details>

    

                            </div>
                            <div id="GOPostedService.get_interval_start" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#GOPostedService.get_interval_start">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">get_interval_start</span><span class="signature">(self)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">get_interval_start</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">interval_start</span>
</pre></div>

        </details>

    

                            </div>
                            <div id="GOPostedService.get_interval_duration" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#GOPostedService.get_interval_duration">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">get_interval_duration</span><span class="signature">(self)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">get_interval_duration</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">interval_duration</span>
</pre></div>

        </details>

    

                            </div>
                            <div id="GOPostedService.get_power" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#GOPostedService.get_power">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">get_power</span><span class="signature">(self)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">get_power</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">power</span>
</pre></div>

        </details>

    

                            </div>
                            <div id="GOPostedService.get_price" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#GOPostedService.get_price">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">get_price</span><span class="signature">(self)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">get_price</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">price</span>
</pre></div>

        </details>

    

                            </div>
                            <div id="GOPostedService.get_status" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#GOPostedService.get_status">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">get_status</span><span class="signature">(self)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">get_status</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span>
</pre></div>

        </details>

    

                            </div>
                            <div id="GOPostedService.set_status" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#GOPostedService.set_status">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">set_status</span><span class="signature">(self, new_status)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">set_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_status</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">new_status</span>
</pre></div>

        </details>

    

                            </div>
                            <div id="GOPostedService.get_service_message_data" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#GOPostedService.get_service_message_data">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">get_service_message_data</span><span class="signature">(self)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">get_service_message_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the attribute names and values in dictionary form for use by the message wrapper (GOOutputInterface).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">service_message_data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;service_name&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">service_name</span><span class="p">,</span>
            <span class="s2">&quot;group_id&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">group_id</span><span class="p">,</span>
            <span class="s2">&quot;service_type&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">service_type</span><span class="p">,</span>
            <span class="s2">&quot;interval_start&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">interval_start</span><span class="p">,</span>
            <span class="s2">&quot;interval_duration&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">interval_duration</span><span class="p">,</span>
            <span class="s2">&quot;power&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">power</span><span class="p">,</span>
            <span class="s2">&quot;ramp&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">ramp</span><span class="p">,</span>
            <span class="s2">&quot;price&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">price</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">service_message_data</span>
</pre></div>

        </details>

            <div class="docstring"><p>Returns the attribute names and values in dictionary form for use by the message wrapper (GOOutputInterface).</p>
</div>


                            </div>
                </section>
                <section id="instantiate_callback_classes">
                            <div class="attr function"><a class="headerlink" href="#instantiate_callback_classes">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">instantiate_callback_classes</span><span class="signature">(simulation_id, gapps_object, edmCore)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">instantiate_callback_classes</span><span class="p">(</span><span class="n">simulation_id</span><span class="p">,</span> <span class="n">gapps_object</span><span class="p">,</span> <span class="n">edmCore</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Instantiates the callback classes.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">global</span> <span class="n">edmMeasurementProcessor</span>
    <span class="n">edmMeasurementProcessor</span> <span class="o">=</span> <span class="n">EDMMeasurementProcessor</span><span class="p">()</span>
    <span class="n">edmCore</span><span class="o">.</span><span class="n">gapps_session</span><span class="o">.</span><span class="n">subscribe</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">simulation_output_topic</span><span class="p">(</span><span class="n">edmCore</span><span class="o">.</span><span class="n">sim_mrid</span><span class="p">),</span> <span class="n">edmMeasurementProcessor</span><span class="p">)</span>
    <span class="k">global</span> <span class="n">edmTimekeeper</span>
    <span class="n">edmTimekeeper</span> <span class="o">=</span> <span class="n">EDMTimeKeeper</span><span class="p">(</span><span class="n">edmCore</span><span class="p">)</span>
    <span class="n">edmCore</span><span class="o">.</span><span class="n">gapps_session</span><span class="o">.</span><span class="n">subscribe</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">simulation_log_topic</span><span class="p">(</span><span class="n">edmCore</span><span class="o">.</span><span class="n">sim_mrid</span><span class="p">),</span> <span class="n">edmTimekeeper</span><span class="p">)</span>
</pre></div>

        </details>

            <div class="docstring"><p>Instantiates the callback classes.</p>
</div>


                </section>
    </main>
</body>
</html>